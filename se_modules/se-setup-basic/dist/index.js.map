{"version":3,"file":"index.js","sources":["../src/prompt.js","../src/menu.js","../src/inputrules.js","../src/keymap.js","../src/extension.js","../src/index.js"],"sourcesContent":["const prefix = \"simpleeditor-prompt\"\n\nexport function openPrompt(options) {\n  let wrapper = document.body.appendChild(document.createElement(\"div\"))\n  wrapper.className = prefix\n\n  let mouseOutside = e => { if (!wrapper.contains(e.target)) close() }\n  setTimeout(() => window.addEventListener(\"mousedown\", mouseOutside), 50)\n  let close = () => {\n    window.removeEventListener(\"mousedown\", mouseOutside)\n    if (wrapper.parentNode) wrapper.parentNode.removeChild(wrapper)\n  }\n\n  let domFields = []\n  for (let name in options.fields) domFields.push(options.fields[name].render())\n\n  let submitButton = document.createElement(\"button\")\n  submitButton.type = \"submit\"\n  submitButton.className = prefix + \"-submit\"\n  submitButton.textContent = \"OK\"\n  let cancelButton = document.createElement(\"button\")\n  cancelButton.type = \"button\"\n  cancelButton.className = prefix + \"-cancel\"\n  cancelButton.textContent = \"Cancel\"\n  cancelButton.addEventListener(\"click\", close)\n\n  let form = wrapper.appendChild(document.createElement(\"form\"))\n  if (options.title) form.appendChild(document.createElement(\"h5\")).textContent = options.title\n  domFields.forEach(field => {\n    form.appendChild(document.createElement(\"div\")).appendChild(field)\n  })\n  let buttons = form.appendChild(document.createElement(\"div\"))\n  buttons.className = prefix + \"-buttons\"\n  buttons.appendChild(submitButton)\n  buttons.appendChild(document.createTextNode(\" \"))\n  buttons.appendChild(cancelButton)\n\n  let box = wrapper.getBoundingClientRect()\n  wrapper.style.top = ((window.innerHeight - box.height) / 2) + \"px\"\n  wrapper.style.left = ((window.innerWidth - box.width) / 2) + \"px\"\n\n\n\n  //ORIG:\n    // let submit = () => {\n    //   let params = getValues(options.fields, domFields)\n    //   if (params) {\n    //     close()\n    //     options.callback(params)\n    //   }\n    // }\n\n  // NEW:\n    // test filelist\n    let inputFile = document.createElement(\"input\")\n    inputFile.type = \"file\"\n    inputFile.multiple = true;\n    form.appendChild(inputFile);\n    \n    // submit     \n    let submit = () => {\n      let params = getValues(options.fields, domFields)\n      if (params) {\n        close()\n        //console.error(\"can we loop?\", params, inputFile.files);\n        for (var i = 0; i < inputFile.files.length; i++) {\n          options.callback(inputFile.files[i]);\n        };\n        \n\n        // options.callback(params)\n        // params.src = \"http://192.168.1.24/~dogma/_sites/kniznytrh.sk/_design/local/images/f6157e788777e51efb1d7b62ff7c59d4_137051724133.jpg\";\n        // options.callback(params)\n        // params.src = \"http://192.168.1.24/~dogma/_sites/kniznytrh.sk/_design/local/images/7f65dbe904dfc91ce3a173409dd3a580_137051716147.jpg\";\n        // options.callback(params)\n      }\n    }\n\n  form.addEventListener(\"submit\", e => {\n    e.preventDefault()\n    submit()\n  })\n\n  form.addEventListener(\"keydown\", e => {\n    if (e.keyCode == 27) {\n      e.preventDefault()\n      close()\n    } else if (e.keyCode == 13 && !(e.ctrlKey || e.metaKey || e.shiftKey)) {\n      e.preventDefault()\n      submit()\n    } else if (e.keyCode == 9) {\n      window.setTimeout(() => {\n        if (!wrapper.contains(document.activeElement)) close()\n      }, 500)\n    }\n  })\n\n  let input = form.elements[0]\n  if (input) input.focus()\n}\n\nfunction getValues(fields, domFields) {\n  let result = Object.create(null), i = 0\n  for (let name in fields) {\n    let field = fields[name], dom = domFields[i++]\n    let value = field.read(dom), bad = field.validate(value)\n    if (bad) {\n      reportInvalid(dom, bad)\n      return null\n    }\n    result[name] = field.clean(value)\n  }\n  return result\n}\n\nfunction reportInvalid(dom, message) {\n  // FIXME this is awful and needs a lot more work\n  let parent = dom.parentNode\n  let msg = parent.appendChild(document.createElement(\"div\"))\n  msg.style.left = (dom.offsetLeft + dom.offsetWidth + 2) + \"px\"\n  msg.style.top = (dom.offsetTop - 5) + \"px\"\n  msg.className = \"simpleeditor-invalid\"\n  msg.textContent = message\n  setTimeout(() => parent.removeChild(msg), 1500)\n}\n\n// ::- The type of field that `FieldPrompt` expects to be passed to it.\nexport class Field {\n  // :: (Object)\n  // Create a field with the given options. Options support by all\n  // field types are:\n  //\n  // **`value`**`: ?any`\n  //   : The starting value for the field.\n  //\n  // **`label`**`: string`\n  //   : The label for the field.\n  //\n  // **`required`**`: ?bool`\n  //   : Whether the field is required.\n  //\n  // **`validate`**`: ?(any) → ?string`\n  //   : A function to validate the given value. Should return an\n  //     error message if it is not valid.\n  constructor(options) { this.options = options }\n\n  // render:: (state: EditorState, props: Object) → dom.Node\n  // Render the field to the DOM. Should be implemented by all subclasses.\n\n  // :: (dom.Node) → any\n  // Read the field's value from its DOM node.\n  read(dom) { return dom.value }\n\n  // :: (any) → ?string\n  // A field-type-specific validation function.\n  validateType(_value) {}\n\n  validate(value) {\n    if (!value && this.options.required)\n      return \"Required field\"\n    return this.validateType(value) || (this.options.validate && this.options.validate(value))\n  }\n\n  clean(value) {\n    return this.options.clean ? this.options.clean(value) : value\n  }\n}\n\n// ::- A field class for single-line text fields.\nexport class TextField extends Field {\n  render() {\n    let input = document.createElement(\"input\")\n    input.type = \"text\"\n    input.placeholder = this.options.label\n    input.value = this.options.value || \"\"\n    input.autocomplete = \"off\"\n    return input\n  }\n}\n\n\n// ::- A field class for dropdown fields based on a plain `<select>`\n// tag. Expects an option `options`, which should be an array of\n// `{value: string, label: string}` objects, or a function taking a\n// `ProseMirror` instance and returning such an array.\nexport class SelectField extends Field {\n  render() {\n    let select = document.createElement(\"select\")\n    this.options.options.forEach(o => {\n      let opt = select.appendChild(document.createElement(\"option\"))\n      opt.value = o.value\n      opt.selected = o.value == this.options.value\n      opt.label = o.label\n    })\n    return select\n  }\n}\n","import {blockTypeItem, joinUpItem, liftItem, undoItem, redoItem, icons, MenuItem} from \"se-menu-basic\" //+wrapItem , Dropdown, DropdownSubmenu, selectParentNodeItem ?\nimport {NodeSelection} from \"prosemirror-state\"\nimport {toggleMark} from \"prosemirror-commands\" \nimport {wrapInList} from \"prosemirror-schema-list\"\nimport {TextField, openPrompt} from \"./prompt\"\n\n// Helpers to create specific types of items\n\nfunction canInsert(state, nodeType) {\n  // console.warn(nodeType);\n  let $from = state.selection.$from\n  for (let d = $from.depth; d >= 0; d--) {\n    let index = $from.index(d)\n    if ($from.node(d).canReplaceWith(index, index, nodeType)) return true\n  }\n  return false\n}\n\nfunction markApplies(doc, ranges, type) {\n  for (let i = 0; i < ranges.length; i++) {\n    let {$from, $to} = ranges[i]\n    let can = $from.depth == 0 ? doc.type.allowsMarkType(type) : false\n    doc.nodesBetween($from.pos, $to.pos, node => {\n      if (can) return false\n      can = node.inlineContent && node.type.allowsMarkType(type)\n    })\n    if (can) return true\n  }\n  return false\n}\n\nfunction canInsertMark(state, markType) {\n  \n  // Check excludes\n    let $marks = state.selection.$from.marks();\n    // loop selection marks and check if this mark.excludes markType except self because we want to keep toggle for some marks (b/u/i)\n    for (var i = 0; i < $marks.length; i++) {\n      //console.log(\"\\->\",$marks[i].type.name, markType.name, $marks[i].type.excludes(markType));\n      if ($marks[i].type.name!=markType.name && $marks[i].type.excludes(markType)) {\n        return false;\n      }\n    }    \n  // Check if can apply\n    let {empty, $cursor, ranges} = state.selection    \n    if ((empty && !$cursor) || !markApplies(state.doc, ranges, markType)) return false\n\n  // NEW plus \n    if (!empty) {      \n      let $aMarks = state.selection.$from.marksAcross(state.selection.$from);\n      //console.log(\"state.selection\", $aMarks)\n      if ($aMarks!=null) {\n        for (var i = 0; i < $aMarks.length; i++) {\n          //console.log(\"\\->\",$marks[i].type.name, markType.name, $marks[i].type.excludes(markType));\n          if ($aMarks[i].type.name!=markType.name && $aMarks[i].type.excludes(markType)) {\n            return false;\n          }\n        } \n      }\n    }\n\n  // Can\n    return true\n}\n\n// CUSTOM\nexport function canInsertBlock(state, nodeType) {\n  //console.warn(nodeType);\n  let $from = state.selection.$from\n  for (let d = $from.depth; d >= 0; d--) {\n    let index = $from.index(d)    \n    if (typeof $from.node(d).type.spec.marks != \"undefined\") { \n      //console.info(\"\\t->\",$from.node(d).type.spec,nodeType.name);\n      if ($from.node(d).type.spec.marks.indexOf(nodeType.name)==-1) {\n        return false;\n      } else {\n        return true;\n      }\n    } else if ($from.node(d).type.name != \"doc\") {\n      //console.log(\"\\t->\",$from.node(d).type.name)\n      return true\n    }\n  }\n  return false\n}\n\nfunction insertImageItem(nodeType) {\n  return new MenuItem({\n    title: \"Insert image\",\n    label: \"Image\",\n    enable(state) { \n      return canInsert(state, nodeType) \n    },\n    run(state, _, view) {\n      let {from, to} = state.selection, attrs = null\n      if (state.selection instanceof NodeSelection && state.selection.node.type == nodeType)\n        attrs = state.selection.node.attrs\n      openPrompt({\n        title: \"Insert image\",\n        fields: {\n          src: new TextField({label: \"Location\", required: true, value: attrs && attrs.src}),\n          title: new TextField({label: \"Title\", value: attrs && attrs.title}),\n          alt: new TextField({label: \"Description\",\n                              value: attrs ? attrs.alt : state.doc.textBetween(from, to, \" \")})\n        },\n        //NEW:\n        callback(file) {          \n             // A fresh object to act as the ID for this upload\n              let id = {};\n\n            // Replace the selection with a placeholder\n              //console.log(\"add placeholder here: \")          \n              let linkKey = view.state.config.pluginsByKey[\"extension$\"];\n\n\n              let tr = view.state.tr;\n              let pos_ = tr.selection.from;\n              tr.setMeta(linkKey, {add: {id, pos: pos_}})\n              \n              view.dispatch(tr)\n              view.focus()\n\n            // test on upload complete add src\n              \n              // setTimeout( function() {\n              //     let pos = linkKey.spec.imagePlaceholder(view.state, id, linkKey);\n              //     // If the content around the placeholder has been deleted, drop\n              //     // the image\n              //     if (pos == null) return\n              //     // Otherwise, insert it at the placeholder's position, and remove\n              //     // the placeholder\n              //       console.log(\"id\",id,attrs.src);\n              //       // On success replace \n              //         // view.dispatch(view.state.tr\n              //         //               .replaceWith(pos, pos, nodeType.create({src: attrs.src}))\n              //         //               .setMeta(linkKey, {remove: {id}}))\n              //       // On failure, just clean up the placeholder\n              //         // view.dispatch(view.state.tr.setMeta(linkKey, {remove: {id}}))\n              // }, 3000);\n\n              uploadFile(file).then(function (url) {\n                var pos = linkKey.spec.imagePlaceholder(view.state, id, linkKey);\n                // If the content around the placeholder has been deleted, drop\n                // the image\n                if (pos == null) { return }\n                // Otherwise, insert it at the placeholder's position, and remove\n                // the placeholder\n                view.dispatch(view.state.tr\n                              .replaceWith(pos, pos, nodeType.create({src: url}))\n                              .setMeta(linkKey, {remove: {id: id}}));\n              }, function () {\n                // On failure, just clean up the placeholder\n                view.dispatch(view.state.tr.setMeta(linkKey, {remove: {id: id}}));\n              });          \n            \n        }\n        //ORIG:\n        // callback(attrs) {\n        //   view.dispatch(view.state.tr.replaceSelectionWith(nodeType.createAndFill(attrs)))\n        //   view.focus()\n        // }\n\n      })\n    }\n  })\n}\n\n// This is just a dummy that loads the file and creates a data URL.\n// You could swap it out with a function that does an actual upload\n// and returns a regular URL for the uploaded file.\nfunction uploadFile(file) {\n  var reader = new FileReader;\n  return new Promise(function (accept, fail) {\n    reader.onload = function () { return accept(reader.result); };\n    reader.onerror = function () { return fail(reader.error); };\n    // Some extra delay to make the asynchronicity visible\n    setTimeout(function () { \n      // TEST\n      var s = Math.round((Math.random() * 1));\n      console.log(\"test success/fail: \", s)\n      if (s==0) {\n      return fail(reader.error);\n      }\n      // ORIG\n      return reader.readAsDataURL(file); \n    }, 1500);\n  })\n}\n\nfunction cmdItem(cmd, options) {\n  let passedOptions = {\n    label: options.title,\n    run: cmd\n  }\n  for (let prop in options) passedOptions[prop] = options[prop]\n  if ((!options.enable || options.enable === true) && !options.select)\n    passedOptions[options.enable ? \"enable\" : \"select\"] = state => cmd(state)\n\n  return new MenuItem(passedOptions)\n}\n\nexport function markActive(state, type) {\n  let {from, $from, to, empty} = state.selection\n  if (empty) return type.isInSet(state.storedMarks || $from.marks())\n  else return state.doc.rangeHasMark(from, to, type)\n}\n\nfunction markItem(markType, options) {\n  let passedOptions = {\n    active(state) { return markActive(state, markType) },\n    select: toggleMark(markType) && ( state => canInsertMark(state, markType) ), //if this is present blocktype will be removed if not applicable\n    // enable: true\n    enable(state) { \n      return canInsertMark(state, markType);\n      // return true;\n    }\n  }\n  for (let prop in options) passedOptions[prop] = options[prop]\n  return cmdItem(toggleMark(markType), passedOptions)\n}\n\nfunction linkItem(markType) {\n  return new MenuItem({\n    title: \"Ctrl+Shift+l\",\n    icon: icons.link,\n    active(state) { return markActive(state, markType) },\n    select: toggleMark(markType) && ( state => ((!state.selection.empty && canInsertBlock(state, markType))  // selection\n          || (canInsertBlock(state, markType) && markActive(state, markType) )) ), //if this is present blocktype will be removed if not applicable\n    enable(state) { \n      // ORIG:\n        //return !state.selection.empty \n      // NEW:\n        //console.warn(\"can insert link?\", (!state.selection.empty &&canInsertBlock(state, markType)));\n        //return (!state.selection.empty &&canInsertBlock(state, markType))\n        return ((!state.selection.empty && canInsertBlock(state, markType))  // selection\n          || (canInsertBlock(state, markType) && markActive(state, markType) ) // active link can be viewed also if there is empty selection and cursor is inside\n          )\n    },\n    // lib: prosemirror-menu - https://github.com/prosemirror/prosemirror-menu)\n    run(state, dispatch, view, domEvent) {      \n      // NEW\n        // find plugin\n        let linkKey = state.config.pluginsByKey[\"extension$\"];\n        // check if has link\n        // console.log(\"has link:\")\n        if (markActive(state, markType)) {\n          // console.log(\"yes\")\n          // remove link\n          linkKey.spec.removeLink(view);\n          return true\n        }\n        // Open edit dialog      \n        linkKey.spec.openDialog(view);\n      \n          \n      // ORIG\n        /*\n        if (markActive(state, markType)) {\n          toggleMark(markType)(state, dispatch)\n          return true\n        }\n        openPrompt({\n          title: \"Create a link\",\n          fields: {\n            href: new TextField({\n              label: \"Link target\",\n              required: true\n            }),\n            title: new TextField({label: \"Title\"})\n          },\n          callback(attrs) {\n            toggleMark(markType, attrs)(view.state, view.dispatch)\n            view.focus()\n          }\n        })\n        */\n    }\n  })\n}\n\nfunction wrapListItem(nodeType, options) {\n  return cmdItem(wrapInList(nodeType, options.attrs), options)\n}\n\n// :: (Schema) → Object\n// Given a schema, look for default mark and node types in it and\n// return an object with relevant menu items relating to those marks:\n//\n// **`toggleStrong`**`: MenuItem`\n//   : A menu item to toggle the [strong mark](#schema-basic.StrongMark).\n//\n// **`toggleEm`**`: MenuItem`\n//   : A menu item to toggle the [emphasis mark](#schema-basic.EmMark).\n//\n// **`toggleCode`**`: MenuItem`\n//   : A menu item to toggle the [code font mark](#schema-basic.CodeMark).\n//\n// **`toggleLink`**`: MenuItem`\n//   : A menu item to toggle the [link mark](#schema-basic.LinkMark).\n//\n// **`insertImage`**`: MenuItem`\n//   : A menu item to insert an [image](#schema-basic.Image).\n//\n// **`wrapBulletList`**`: MenuItem`\n//   : A menu item to wrap the selection in a [bullet list](#schema-list.BulletList).\n//\n// **`wrapOrderedList`**`: MenuItem`\n//   : A menu item to wrap the selection in an [ordered list](#schema-list.OrderedList).\n//\n// **`wrapBlockQuote`**`: MenuItem`\n//   : A menu item to wrap the selection in a [block quote](#schema-basic.BlockQuote).\n//\n// **`makeParagraph`**`: MenuItem`\n//   : A menu item to set the current textblock to be a normal\n//     [paragraph](#schema-basic.Paragraph).\n//\n// **`makeCodeBlock`**`: MenuItem`\n//   : A menu item to set the current textblock to be a\n//     [code block](#schema-basic.CodeBlock).\n//\n// **`makeHead[N]`**`: MenuItem`\n//   : Where _N_ is 1 to 6. Menu items to set the current textblock to\n//     be a [heading](#schema-basic.Heading) of level _N_.\n//\n// **`insertHorizontalRule`**`: MenuItem`\n//   : A menu item to insert a horizontal rule.\n//\n// The return value also contains some prefabricated menu elements and\n// menus, that you can use instead of composing your own menu from\n// scratch:\n//\n// **`insertMenu`**`: Dropdown`\n//   : A dropdown containing the `insertImage` and\n//     `insertHorizontalRule` items.\n//\n// **`typeMenu`**`: Dropdown`\n//   : A dropdown containing the items for making the current\n//     textblock a paragraph, code block, or heading.\n//\n// **`fullMenu`**`: [[MenuElement]]`\n//   : An array of arrays of menu elements for use as the full menu\n//     for, for example the [menu bar](https://github.com/prosemirror/prosemirror-menu#user-content-menubar).\nexport function buildMenuItems(schema) {\n  let r = {}, type\n  if (type = schema.marks.strong)\n    r.toggleStrong = markItem(type, {title: \"Cmd+b\", icon: icons.strong})\n  if (type = schema.marks.em)\n    r.toggleEm = markItem(type, {title: \"Cmd+i\", icon: icons.em})\n  if (type = schema.marks.underline)\n    r.toggleUnderline = markItem(type, {title: \"Cmd+u\", icon: icons.underline})\n  if (type = schema.marks.code)\n    r.toggleCode = markItem(type, {title: \"Cmd+`\", icon: icons.code})\n  if (type = schema.marks.link)\n    r.toggleLink = linkItem(type)\n\n  if (type = schema.nodes.image)\n    r.insertImage = insertImageItem(type)\n  if (type = schema.nodes.bullet_list)\n    r.wrapBulletList = wrapListItem(type, {\n      title: \"Ctrl+Shift+8\",\n      icon: icons.bulletList\n    })\n  if (type = schema.nodes.ordered_list)\n    r.wrapOrderedList = wrapListItem(type, {\n      title: \"Ctrl+Shift+9\",\n      icon: icons.orderedList\n    })\n  if (type = schema.nodes.blockquote) {\n    // WRAP\n    // r.wrapBlockQuote = wrapItem(type, {\n    //   title: \"Wrap in block quote\",\n    //   icon: icons.blockquote\n    // })\n    // CONVERT\n    r.makeBlockQuote = blockTypeItem(type, {\n      title: \"Ctrl+Shift+>\",\n      icon: icons.blockquote\n    }, schema.nodes.paragraph)\n  }\n  if (type = schema.nodes.paragraph)\n    r.makeParagraph = blockTypeItem(type, {\n      title: \"Ctrl+Shift+0\",\n      label: \"Plain\"\n    })\n  if (type = schema.nodes.code_block)\n    r.makeCodeBlock = blockTypeItem(type, {\n      title: \"Cmd+Shift+\\\\\",\n      label: \"Code\"\n    }, schema.nodes.paragraph)\n  if (type = schema.nodes.heading)\n    /*\n    for (let i = 2; i <= schema.nodes.heading.spec.parseDOM.length; i++)    // i==2 if h1 is set to h2 because only 1 title is allowed\n      r[\"makeHead\" + (i-1)] = blockTypeItem(type, {                         // -1 so we adress correct heading commant\n        title: \"Ctrl+Shift+\" + (i-1),                                       // -1 so we adress correct heading commant       \n        // label: \"Level \" + (i-1),                                         // -1 so we adress correct heading commant\n        icon: icons[\"heading\"+ (i-1)],                                      // -1 so we adress correct heading commant\n        attrs: {level: (i)}                                                 //LEGACY (title is now handled only with schema), BEFORE WE HAD TO: +1 if h1 is missing in the heading node spec\n      }, schema.nodes.paragraph)\n    */\n    for (let i = 1; i <= schema.nodes.heading.spec.parseDOM.length; i++)\n      r[\"makeHead\" + (i)] = blockTypeItem(type, {                         \n        title: \"Ctrl+Shift+\" + (i),                                       \n        // label: \"Level \" + (i),                                         \n        icon: icons[\"heading\"+ (i)],                                      \n        attrs: {level: (i+1)}                                               //+1 if h1 is missing in the heading node spec\n      }, schema.nodes.paragraph)\n  if (type = schema.nodes.horizontal_rule) {\n    let hr = type\n    r.insertHorizontalRule = new MenuItem({\n      title: \"Insert horizontal rule\",\n      label: \"Horizontal rule\",\n      // ORIG:\n        //enable(state) { return canInsert(state, hr) },\n      // NEW:\n      enable(state) { return canInsertBlock(state, hr) },\n      run(state, dispatch) { dispatch(state.tr.replaceSelectionWith(hr.create())) }\n    })\n  }\n\n  // ORIG:\n    // let cut = arr => arr.filter(x => x)\n    // r.insertMenu = new Dropdown(cut([r.insertImage, r.insertHorizontalRule]), {label: \"Insert\"})\n    // r.typeMenu = new Dropdown(cut([r.makeParagraph, r.makeCodeBlock, r.makeHead1 && new DropdownSubmenu(cut([\n    //   r.makeHead1, r.makeHead2, r.makeHead3, r.makeHead4, r.makeHead5, r.makeHead6\n    // ]), {label: \"Heading\"})]), {label: \"Type...\"})\n\n    // r.inlineMenu = [cut([r.toggleStrong, r.toggleEm, r.toggleUnderline, r.toggleCode, r.toggleLink])]\n    // r.blockMenu = [cut([r.wrapBulletList, r.wrapOrderedList, r.makeBlockQuote, joinUpItem,\n    //                     liftItem, selectParentNodeItem])]\n \n    // r.fullMenu = r.inlineMenu.concat([[r.insertMenu, r.typeMenu]], [[undoItem, redoItem]], r.blockMenu)\n  \n  // NEW:\n    let cut = arr => arr.filter(x => x)\n\n    r.typeMenu = [cut([r.makeHead1, r.makeHead2, r.makeHead3, r.makeHead4, r.makeHead5, r.makeHead6])]\n    r.inlineMenu = [cut([r.toggleStrong, r.toggleEm, r.toggleUnderline, r.toggleCode, r.toggleLink])]\n    \n    r.blockMenu = [cut([r.wrapBulletList, r.wrapOrderedList, r.makeBlockQuote, joinUpItem,\n                        liftItem])]\n  \n    \n    // TEST (img)\n    //r.insertMenu = new Dropdown(cut([r.insertImage, r.insertHorizontalRule]), {label: \"Insert\"})\n    //r.fullMenu = r.inlineMenu.concat([[r.insertMenu]], r.typeMenu, r.blockMenu)\n\n    // VALID:\n    if (isIOS()) {\n      r.fullMenu = r.inlineMenu.concat(r.typeMenu, [[undoItem, redoItem]], r.blockMenu)\n    } else {\n      r.fullMenu = r.inlineMenu.concat(r.typeMenu, r.blockMenu)\n    }\n\n  return r\n}\n\nfunction isIOS() {\n      if (typeof navigator == \"undefined\") return false\n      let agent = navigator.userAgent\n      return !/Edge\\/\\d/.test(agent) && /AppleWebKit/.test(agent) && /Mobile\\/\\w+/.test(agent)\n}\n","import {inputRules, wrappingInputRule, textblockTypeInputRule,\n        smartQuotes, emDash, ellipsis, InputRule} from \"prosemirror-inputrules\"\n\n// : (NodeType) → InputRule\n// Given a blockquote node type, returns an input rule that turns `\"> \"`\n// at the start of a textblock into a blockquote.\nexport function blockQuoteRule(nodeType) {\n  //return wrappingInputRule(/^\\s*>\\s$/, nodeType) // wrap in \n  return textblockTypeInputRule(/^\\s*>\\s$/, nodeType) // change to\n}\n\n// : (NodeType) → InputRule\n// Given a list node type, returns an input rule that turns a number\n// followed by a dot at the start of a textblock into an ordered list.\nexport function orderedListRule(nodeType) {\n  return wrappingInputRule(/^(\\d+)\\.\\s$/, nodeType, match => ({order: +match[1]}),\n                           (match, node) => node.childCount + node.attrs.order == +match[1])\n}\n\n// : (NodeType) → InputRule\n// Given a list node type, returns an input rule that turns a bullet\n// (dash, plush, or asterisk) at the start of a textblock into a\n// bullet list.\nexport function bulletListRule(nodeType) {\n  return wrappingInputRule(/^\\s*([-+*])\\s$/, nodeType)\n}\n\n// : (NodeType) → InputRule\n// Given a code block node type, returns an input rule that turns a\n// textblock starting with three backticks into a code block.\nexport function codeBlockRule(nodeType) {\n  return textblockTypeInputRule(/^```$/, nodeType)\n}\n\n// : (NodeType, number) → InputRule\n// Given a node type and a maximum level, creates an input rule that\n// turns up to that number of `#` characters followed by a space at\n// the start of a textblock into a heading whose level corresponds to\n// the number of `#` signs.\nexport function headingRule(nodeType, maxLevel) {\n  return textblockTypeInputRule(new RegExp(\"^(#{1,\" + maxLevel + \"})\\\\s$\"),   \n                                nodeType, match => ({level: (match[1].length+1) })) // +1 because only one h1 is allowed\n}\n\n// keepp traling whitespace\n// const keepTrailingSpace = new InputRule(/\\S$/, (state, match) => {\n//   if (!state.selection.empty && match.length === 1) {\n//     const {from, to} = state.selection\n\n//     const matchedWhitespace = state.doc.textBetween(from, to).match(/\\s+$/)\n//     if (matchedWhitespace && matchedWhitespace.length === 1) {\n//       const tr = state.tr\n//       return tr.insertText(match[0] + matchedWhitespace[0])\n//                .setSelection(new TextSelection(tr.doc.resolve(from + 1), tr.doc.resolve(from + 1)))\n//     }\n//   }\n\n//   return null\n// })\n\n/**\n * Convert textblock to mark\n * @param {string}    RegExp    Regular expresion to test text\n * @param {object}    markType  Schema Mark\n * @param {object}    getAttrs  Optional params to select attributes values\n */\nfunction MarkInputRule(regexp, markType, getAttrs) {\n  return new InputRule(regexp, (state, match, start, end) => {\n      \n    // Resolve marked\n    let $start = state.doc.resolve(start)\n    let attrs = getAttrs instanceof Function ? getAttrs(match) : getAttrs\n\n    // Check if we can apply mark\n    if (!$start.parent.type.allowsMarkType(markType)) return null\n        \n    // Exclude matching for the end of the textblock\n    const oCloseFix = (match[5] == undefined)?0:1;    \n    const oTextString = match[0].toString().substring(0,match[0].length-1-oCloseFix);\n    if (oCloseFix==1 && (end-start-1)!=oTextString.length) {\n      // comming from the end\n      return null;\n    } \n    if (oCloseFix==0 && (end-start)!=oTextString.length) {\n      // comming from the end with space only\n      return null;\n    }\n\n    // Mark specific updates\n    let oAttr = {};\n    switch (markType.name) {\n      case \"link\":\n        oAttr = (attrs.type==\"email\") ? { href: \"mailto:\"+oTextString } : { href: oTextString, target: \"_blank\" };\n      break;\n    }\n    \n    // Create Mark\n    const oMark = markType.create(oAttr);\n    const oTrgString = match[6];\n    const oPos = {\n      from: start,\n      to: end\n    }\n\n    // Create transaction\n    let tr =  state.tr;\n    tr.removeMark(oPos.from, oPos.to-oCloseFix, markType)\n    tr.addMark(oPos.from, oPos.to-oCloseFix, oMark)\n    tr.insertText(oTrgString,oPos.to)\n\n    // Return transaction\n    return tr;\n  })\n}\n\n// : (NodeType) → InputRule\n// Given a code block node type, returns an input rule that turns a\n// textblock matching links regex into a link mark.\nexport function linkRule(markType, opt_enter_) {  \n  \n  if (opt_enter_) {\n    // with space after\n    return MarkInputRule(/(?:(?:(https|http|ftp)+):\\/\\/)?(?:\\S+(?::\\S*)?(@))?(?:(?:([a-z0-9][a-z0-9\\-]*)?[a-z0-9]+)(?:\\.(?:[a-z0-9\\-])*[a-z0-9]+)*(?:\\.(?:[a-z]{2,})(:\\d{1,5})?))(?:\\/[^\\s]*)?(\\.|,|;)$/i,   \n                                  markType, match => ({type: ((match[2]=='@')?\"email\":\"uri\") }))\n  } else {\n    // with space after = has issues with link at the end of parahraph \"www.google.com; d\"\n    return MarkInputRule(/(?:(?:(https|http|ftp)+):\\/\\/)?(?:\\S+(?::\\S*)?(@))?(?:(?:([a-z0-9][a-z0-9\\-]*)?[a-z0-9]+)(?:\\.(?:[a-z0-9\\-])*[a-z0-9]+)*(?:\\.(?:[a-z]{2,})(:\\d{1,5})?))(?:\\/[^\\s]*)?(\\.|,|;)?(\\s)$/i,   \n                                  markType, match => ({type: ((match[2]=='@')?\"email\":\"uri\") }))\n  }\n\n  // with multiple after - we need only space and optionaly enter\n    // return MarkInputRule(/(?:(?:(https|http|ftp)+):\\/\\/)?(?:\\S+(?::\\S*)?(@))?(?:(?:([a-z0-9][a-z0-9\\-]*)?[a-z0-9]+)(?:\\.(?:[a-z0-9\\-])*[a-z0-9]+)*(?:\\.(?:[a-z]{2,})(:\\d{1,5})?))(?:\\/[^\\s]*)?(\\s|\\?)$/i,   \n    //                               markType, match => ({type: ((match[2]=='@')?\"email\":\"uri\") })) \n\n  // TEST CASES\n    /*\n    https://www.google.com\n    http://www.google.com\n    www.google.com\n    htt://www.google.com\n    ://www.google.com http://www.google.com www.google.com doc.google.com\n    vec.gooogl.com\n    ftp://wewe.sk \n    not\n    123-231.dasd a.sk\n    some@email.com \n    .asdasdls.sk \n    http://aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.randomstring.\n    */\n   \n  // OTHER - optionaly we can attempt to change also pasted links (see: https://github.com/ProseMirror/prosemirror/issues/90#issuecomment-284593797)\n}\n\n\n// : (Schema) → Plugin\n// A set of input rules for creating the basic block quotes, lists,\n// code blocks, and heading.\nexport function buildInputRules(schema) {\n  // let rules = smartQuotes.concat(ellipsis, emDash, keepTrailingSpace), type\n  let rules = smartQuotes.concat(ellipsis, emDash), type\n  if (type = schema.nodes.blockquote) rules.push(blockQuoteRule(type))\n  if (type = schema.nodes.ordered_list) rules.push(orderedListRule(type))\n  if (type = schema.nodes.bullet_list) rules.push(bulletListRule(type))\n  if (type = schema.nodes.code_block) rules.push(codeBlockRule(type))\n  if (type = schema.nodes.heading) rules.push(headingRule(type, schema.nodes.heading.spec.parseDOM.length))\n  if (type = schema.marks.link) rules.push(linkRule(type))\n  return inputRules({rules})\n}\n\n\n","import {TextSelection} from \"prosemirror-state\"\nimport {setBlockType, chainCommands, toggleMark, exitCode,\n        joinUp, joinDown, lift, selectParentNode} from \"prosemirror-commands\"\nimport {wrapInList, splitListItem, liftListItem, sinkListItem} from \"prosemirror-schema-list\"\nimport {undo, redo} from \"prosemirror-history\"\nimport {undoInputRule} from \"prosemirror-inputrules\"\n\n// import {findWrapping, liftTarget, canSplit, ReplaceAroundStep} from \"prosemirror-transform\"\nimport {Slice, Fragment} from \"prosemirror-model\"\n\nimport {canInsertBlock,markActive} from \"./menu\"\nimport {linkRule} from \"./inputrules\"\n\nconst mac = typeof navigator != \"undefined\" ? /Mac/.test(navigator.platform) : false\n\n// :: (Schema, ?Object) → Object\n// Inspect the given schema looking for marks and nodes from the\n// basic schema, and if found, add key bindings related to them.\n// This will add:\n//\n// * **Mod-b** for toggling [strong](#schema-basic.StrongMark)\n// * **Mod-i** for toggling [emphasis](#schema-basic.EmMark)\n// * **Mod-`** for toggling [code font](#schema-basic.CodeMark)\n// * **Ctrl-Shift-0** for making the current textblock a paragraph\n// * **Ctrl-Shift-1** to **Ctrl-Shift-Digit6** for making the current\n//   textblock a heading of the corresponding level\n// * **Ctrl-Shift-Backslash** to make the current textblock a code block\n// * **Ctrl-Shift-8** to wrap the selection in an ordered list\n// * **Ctrl-Shift-9** to wrap the selection in a bullet list\n// * **Ctrl->** to wrap the selection in a block quote\n// * **Enter** to split a non-empty textblock in a list item while at\n//   the same time splitting the list item\n// * **Mod-Enter** to insert a hard break\n// * **Mod-_** to insert a horizontal rule\n// * **Backspace** to undo an input rule\n// * **Alt-ArrowUp** to `joinUp`\n// * **Alt-ArrowDown** to `joinDown`\n// * **Mod-BracketLeft** to `lift`\n// * **Escape** to `selectParentNode`\n//\n// You can suppress or map these bindings by passing a `mapKeys`\n// argument, which maps key names (say `\"Mod-B\"` to either `false`, to\n// remove the binding, or a new key name string.\nexport function buildKeymap(schema, mapKeys) {\n  let keys = {}, type\n  function bind(key, cmd) {\n    if (mapKeys) {\n      let mapped = mapKeys[key]\n      if (mapped === false) return\n      if (mapped) key = mapped\n    }\n    keys[key] = cmd\n  }\n  \n\n\n  bind(\"Mod-z\", undo)\n  bind(\"Shift-Mod-z\", redo)\n  // ORIG:\n    //bind(\"Backspace\", undoInputRule)\n  // NEW (if list item has child list - lift the list and merge it with parent if the cursor is at the first postion)\n    bind(\"Backspace\",(state, dispatch) => {\n\n        // SPECIAL CASES:\n          let $from = state.selection.$from\n          \n          /*          \n          // IE BACKSPACE HACK\n          let $to = state.selection.$to\n          if ($from.sameParent($to) && $from.parent.inlineContent) {\n            if ($from.pos == $to.pos) { // Deletion\n              // IE11 sometimes weirdly moves the DOM selection around after\n              // backspacing out the first element in a textblock\n              //if (browser.ie && browser.ie_version <= 11) {    \n              //if ($from.parentOffset==1 || ($from.nodeBefore != null && $from.nodeBefore.nodeSize == 1 )) {\n              if ($from.textOffset==0 || $from.textOffset==1) { // 0 for delete key (deleteContentForward); 1 for backspace key (deleteContentBackward)\n                  console.log(\"KEYMAP Backspace\", $from.parentOffset, $from, $to, view);\n              }\n            }\n          }\n          */\n         \n          for (let d = $from.depth; d >= 0; d--) {\n            let index = $from.index(d)\n            let node = $from.node(d)\n\n            // Get Node at Cursor            \n            if(node.type.name == \"list_item\") {\n                // Catch cursor at start of ListItem that has Child List Group\n                let {$from, $to} = state.selection\n                let range = $from.blockRange($to, node => node.childCount && node.firstChild.type == schema.nodes.list_item)\n                if (range) {   \n                  // DEPRECATED - we can face this in any depth\n                  // if ($from.node(range.depth - 1).type == schema.nodes.list_item) { \n                  //   // Inside a parent list              \n                  //     console.info(\"inside child list\");\n                  // } else \n                  if (state.selection.empty && node.childCount > 1 \n                              && state.selection.$cursor.parentOffset == 0\n                              && range.startIndex == 0\n                              && (state.selection.$cursor.nodeAfter==null || state.selection.$cursor.nodeAfter.nodeSize == node.firstChild.content.size)\n                              ) {  \n                    // Inside Outer list node with child at 1st position\n                      // console.info(\"parent list to esc\");\n                      // console.log(\"\\t-> from\", $from)\n                      // console.log(\"\\t-> range\", $from)\n                      // console.log(\"\\t-> node\", node)\n                      // console.log(\"\\t-> startIndex\", range) // ok\n                      // console.log(\"\\t-> parent node\", $from.node(d-1))\n                      // console.log(\"\\t-> parent node\", $from.node(d-1))\n                      // console.log(\"\\t-> state\", state)\n                      // console.log(\"\\t-> cursor\", state.selection.$cursor) \n                      //console.log(\"\\t-> copmare nodeAfter vs node size - node size: \", node.firstChild.content.size)\n                      //console.log(\"\\t-> copmare nodeAfter vs node size - nodeAfter size: \", state.selection.$cursor.nodeAfter.nodeSize)\n                      // call prosemirror-schema-list method to escape the list\n                        \n                    // CALL CMD\n                      if (state.selection.$cursor.nodeAfter!=null) {\n                        //console.warn(\"===> CURSOR AT 1st POS with content after\");\n                        let cmd_ = liftListItem(node.type)\n                        return cmd_(state, dispatch)\n                      } else if (index==0) {\n                        //console.warn(\"===> CURSOR AT 1st POS with no content after AND at the 1st paragraph of the LI item (index == 0)\", index);\n                        let cmd_ = liftListItem(node.type); //node.type); //schema.nodes.list_item)\n                        return cmd_(state, dispatch)\n                      } else {\n                        // console.warn(\"cursor is at 1st pos but not the 1st paragraph\", index)\n                      }\n                  }\n\n                }\n            }\n            // else if (node.type.name == \"other type\") {}            \n          }\n         \n        // BAU - this is only reverting inputrules\n          return undoInputRule(state, dispatch)\n    })\n   \n  // if (!mac) bind(\"Mod-y\", redo)\n  bind(\"Mod-y\", redo)\n\n  bind(\"Alt-ArrowUp\", joinUp)\n  bind(\"Alt-ArrowDown\", joinDown)\n  bind(\"Mod-BracketLeft\", lift)\n  bind(\"Escape\", selectParentNode)\n\n  if (type = schema.marks.strong)\n    bind(\"Mod-b\", toggleMark(type))\n  if (type = schema.marks.em)\n    bind(\"Mod-i\", toggleMark(type))\n  if (type = schema.marks.underline)\n    bind(\"Mod-u\", toggleMark(type))\n  if (type = schema.marks.code)\n    bind(\"Mod-`\", toggleMark(type))\n\n  if (type = schema.nodes.bullet_list)\n    bind(\"Shift-Ctrl-8\", wrapInList(type))\n  if (type = schema.nodes.ordered_list)\n    bind(\"Shift-Ctrl-9\", wrapInList(type))\n  if (type = schema.nodes.blockquote) {\n    //bind(\"Ctrl->\", wrapIn(type))      // wrap existing element in blockquote\n    bind(\"Ctrl->\", setBlockType(type,null, schema.nodes.paragraph))  // change existing element to blockquote\n  }\n  if (type = schema.nodes.hard_break) {\n    let br = type, cmd = chainCommands(exitCode, (state, dispatch) => {\n      dispatch(state.tr.replaceSelectionWith(br.create()).scrollIntoView())\n      return true\n    })\n    bind(\"Mod-Enter\", cmd)\n    bind(\"Shift-Enter\", cmd)\n    if (mac) bind(\"Ctrl-Enter\", cmd)\n  }\n  \n // if (type = schema.nodes.list_item || type = schema.nodes.figcaption) {\n    bind(\"Enter\",(state, dispatch, view) => {\n        \n        // PROCESS Enter\n        // DODO: [key-events] Move Custom events to exten handleDOMevents handler\n        \n          // current selection       \n            let $from = state.selection.$from\n          \n          // check text matches\n            \n            let nodeBefore = $from.nodeBefore;\n            let opt_tr_ = null;\n            \n            // VIDEO, \n            // e.g.: https://youtu.be/hHW1oY26kxQ or https://www.youtube.com/watch?v=hHW1oY26kxQ\n            // e.g.: https://vimeo.com/325639357 or ...\n              \n\n              if (  \n                  $from.parent && nodeBefore!=null && nodeBefore.isText && dispatch\n                  && $from.parent.type.name == \"paragraph\"\n                  && $from.node(-1).canReplaceWith($from.index(-1), $from.indexAfter(-1), state.schema.nodes.figure)\n                ) {\n                  \n                  //console.warn(\"can add figure\");\n                  \n                  let node_text = $from.parent.textContent.substring(0,$from.parentOffset); //nodeBefore.text;\n                  //console.log(\"video match: \", node_text, nodeBefore.text);\n\n                  // YOUTUBE find match\n                    const youtube_regex = /^(?:\\s+)?(?:https:\\/\\/www\\.|https:\\/\\/|http:\\/\\/www\\.|http:\\/\\/|www\\.)?(?:youtube\\.com\\/(?:[^\\/]+\\/.+\\/|(?:v|e(?:mbed)?)\\/|.*[?&]v=)|youtu\\.be\\/)([^\"&?\\/ ]{11})(?:\\s|\\.|,|;)?$/i;\n                    let video_matches = (node_text).match(youtube_regex);\n                    if (video_matches!=null){\n                      video_matches[\"type\"] = \"youtube\";\n                    } else {\n                      const vimeo_regex = /^(?:\\s+)?(?:https:\\/\\/www\\.|https:\\/\\/|http:\\/\\/www\\.|http:\\/\\/|www\\.)?(?:vimeo.com)\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^\\/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|)(\\d+)(?:$|\\/|\\?)?$/i;\n                      video_matches = (node_text).match(vimeo_regex);\n                      if (video_matches!=null){\n                        video_matches[\"type\"] = \"vimeo\";\n                      }\n                    }\n\n\n                    if (video_matches!=null){\n                      //console.log(\"video match: \", video_matches['type'], video_matches[1]);\n                      // Get replacement position\n                        let pPos = { from: $from.start(), to: $from.end()}       \n\n                      \n                      // WT/ CUT\n\n                        // Get content after\n                          let wrap_cut = Fragment.from($from.node(0).cut($from.pos,$from.end())); \n                        // create new content node\n                          let wrap_paste = Fragment.empty; //state.schema.nodes.paragraph.createAndFill();\n                        // Loop cuttted fragment\n                          const addchildren = (node, pos) => {                          \n                            if (pos>1) {\n                              // console.log(\"\\tnode\",node,pos);\n                              wrap_paste = wrap_paste.append(Fragment.from(node));\n                              return false;\n                            }\n                          }\n                          wrap_cut.descendants(addchildren);\n                        // Create fragment from new p node and and cutted content \n                          wrap_paste = Fragment.from(state.schema.nodes.paragraph.create(null,wrap_paste));\n                        // Create video fragment and \n                            let wrap_video = null;\n                            let attr_style = null;\n                            let attr_src = null;\n                            switch(video_matches[\"type\"]) {\n                              case \"youtube\":\n                                attr_style = \"padding-top:56.17021276595745%\";\n                                attr_src = \"//www.youtube.com/embed/\"+video_matches[1];\n                              break;\n                              case \"vimeo\":\n                                attr_style = \"padding-top:46.91489361702128%\";\n                                attr_src = \"//player.vimeo.com/video/\"+video_matches[1]+\"?byline=0&amp;portrait=0\";\n                              break;\n                            }\n                            wrap_video = Fragment.from(state.schema.nodes.figure.create(null, Fragment.from(state.schema.nodes.div.create({style:attr_style,src:attr_src}))));\n                        // Append cutted content  to fragment with video\n                          wrap_video = wrap_video.append(wrap_paste);                        \n                        // Dispatch\n                          opt_tr_ = state.tr;\n                          if ($from.pos==$from.end()) {\n                            opt_tr_.replaceRange(pPos.from, pPos.to,new Slice(wrap_video,0,0) );// 1,1 = to next block; 0,0 = to new empty block (has issues at the end of doc)\n                          } else {\n                            opt_tr_.replaceRange(pPos.from, pPos.to,new Slice(wrap_video,1,1) );// 1,1 = to next block; 0,0 = to new empty block (has issues at the end of doc)\n                          }        \n\n                          opt_tr_.setSelection(state.selection.constructor.near(opt_tr_.doc.resolve(pPos.from+1)))\n\n                          dispatch(opt_tr_.scrollIntoView())\n                          return true;\n\n                      // WO/ CUT \n                        \n                        // let frag_ = Fragment.from(state.schema.nodes.horizontal_rule.create());      \n                        // frag_ = frag_.append(Fragment.from(state.schema.nodes.paragraph.create()));  // add empty paragraph\n                        // // Dispatch\n                        // opt_tr_ = state.tr;\n                        // opt_tr_.replaceRange(pPos.from, pPos.to, new Slice(frag_, 0, 0) );// 1,1 = to next block; 0,0 = to new empty block (has issues at the end of doc)\n                        // opt_tr_.setSelection(state.selection.constructor.near(opt_tr_.doc.resolve(pPos.from)))\n                        // dispatch(opt_tr_.scrollIntoView());\n                        // // do not process other cases\n                        // return true;\n                    }\n\n              }\n\n            // LINK\n\n              if ($from.parent && $from.parent.type.allowsMarkType(state.schema.marks.link) && nodeBefore!=null && nodeBefore.isText && dispatch) { // fromBeforeNode.type.name==\"text\") {\n                  // link rule\n                  const link_regex = linkRule(state.schema.marks.link,true).match;\n                  let link_matches_fix = 0;\n                  let link_matches = (nodeBefore.text).match(link_regex);\n                  if (link_matches==null) {\n                    link_matches = (nodeBefore.text+\".\").match(link_regex);              \n                  } else {\n                    link_matches_fix = 1;\n                  }\n                  if (link_matches!=null) {\n                    // we have mathc and can add link\n                      const oLinkString = link_matches[0].toString().substring(0,link_matches[0].length-1);\n                      const link_start = $from.pos-oLinkString.length-link_matches_fix; //$from.parentOffset+link_matches.index;\n                      const link_end = $from.pos-link_matches_fix; //link_matches[0] - 1;                                \n                      const oAttr = (link_matches[2]=='@') ? { href: \"mailto:\"+oLinkString } : { href: oLinkString, target: \"_blank\" };\n                      const oLink = state.schema.marks.link.create(oAttr);\n                      //console.warn(\"linkrule match: \", link_matches,$from, link_start, link_end);  \n                    // Add to transition\n                      opt_tr_ = state.tr\n                      .removeMark(link_start, link_end, state.schema.marks.link)\n                      .addMark(link_start, link_end, oLink)\n                  }\n                }\n          \n          // special cases\n            for (let d = $from.depth; d >= 0; d--) {\n              let index = $from.index(d)    \n              let node = $from.node(d)\n              if (node.type.name==\"list_item\" && $from.parent.content.size != 0) {\n                  // console.error(\"split list-item - can delete next paragraph if done in nested list !!!\", node, $from, node.firstChild.content.size);\n                  let split_ = splitListItem(node.type, opt_tr_);\n                  return split_(state, dispatch);\n              } else if (node.type.name==\"figcaption\") {\n                  // console.log(\"escape figcaption\");\n                  let cmd_ = EscapeOut(node.type, false, opt_tr_); // true = cut the figure content to new p; false = just escape to new p; \n                                                          // KEEP FALSE so we are not confused when trying to joing text back after we attempted to add line break. ALSO they can accidentaly lift out the caption. \n                                                          // If schema figcaption content is inline*, we can hard break the lines\n                  return cmd_(state, dispatch)               \n              }\n\n            }\n\n            // Image, Embed\n              if ($from.parent && $from.parent.type.name == \"figure\") {\n                \n                // Move to figcaption or split figure\n                  // let cmd_ = EscapeOut($from.parent.type, false, opt_tr_);\n                  // return cmd_(state, dispatch)  \n                  \n                  opt_tr_ = state.tr;\n                  let posSel = null;\n                  let posNear = null;\n                  let nodeAfterParent = null;                \n\n                  // Check last node\n                  if (state.selection.empty) {\n                    // Gap cursors - BAU (split figure)                  \n                    return false;\n                  } else if ($from.parent.lastChild!==null && $from.parent.lastChild.type.name == \"figcaption\") {                    \n                    // Move selection to figcaption\n                      posSel = ($from.after($from.depth)-$from.parent.lastChild.nodeSize-1); \n                      posNear = state.selection.constructor.near(opt_tr_.doc.resolve(posSel));\n                  } else {\n                    // Move to next/new paragraph\n                    posSel = ($from.after($from.depth)-1);\n                    nodeAfterParent = opt_tr_.doc.nodeAt(posSel+1);                    \n                    if (nodeAfterParent===null) {\n                      // We are at the end of document\n                      // Add paragraph\n                      let last_node = Fragment.from(state.schema.nodes.paragraph.create());\n                      opt_tr_.insert(posSel+1,last_node); //insert(pos: number, content: Fragment | Node | [Node]) → this\n                      dispatch(opt_tr_);\n                      // Create selection\n                      posNear = view.state.selection.constructor.near(view.state.tr.doc.resolve(posSel));\n                      view.dispatch(view.state.tr.setSelection(posNear).scrollIntoView());\n                      return true;\n                    } else {\n                      posNear = state.selection.constructor.near(opt_tr_.doc.resolve(posSel));\n                    \n                    }\n                  }                  \n\n                  // Set selection                  \n                  opt_tr_.setSelection(posNear);\n                  dispatch(opt_tr_.scrollIntoView());\n                  return true;\n\n              }\n\n            // Any matches left \n            if (opt_tr_!=null) {\n              // dispatch and leave native enter to follow (i.e. not return value)\n              //console.log(\"dispatch.....\")\n              dispatch(opt_tr_);\n            }\n\n    })\n // }\n  if (type = schema.nodes.list_item) {\n    //bind(\"Enter\", splitListItem(type))\n    bind(\"Mod-[\", liftListItem(type))\n    bind(\"Mod-]\", sinkListItem(type))\n    bind(\"Tab\",(state, dispatch) => {\n      \n      // Process TAB\n      \n          // Check in which node  \n          let $from = state.selection.$from          \n          for (let d = $from.depth; d >= 0; d--) {\n            let index = $from.index(d)    \n            let node = $from.node(d)\n\n            // LI\n            if (node.type.name==\"list_item\") {              \n              let {$from, $to} = state.selection\n              let range = $from.blockRange($to, node => node.childCount && node.firstChild.type == schema.nodes.list_item)\n              if (range) {\n                  // BE AWARE of !state.selection.empty\n                  // if (state.selection.empty) {\n                  //   console.info(\"we are in the li so whatever position (singListItem will handle the reuqest): \",state.selection.$cursor.pos, state.selection.$cursor.parentOffset);\n                  // }\n                  let cmd_ = sinkListItem(node.type)\n                  cmd_(state, dispatch) // do not return  (block native tab )\n                  return true;\n              }\n            }\n\n            // OTHER\n          \n          }\n    \n      // Block native with true;\n        return true;\n\n    })\n  }\n  if (type = schema.nodes.paragraph)\n    bind(\"Shift-Ctrl-0\", setBlockType(type))\n  if (type = schema.nodes.code_block)\n    bind(\"Shift-Ctrl-\\\\\", setBlockType(type, null, schema.nodes.paragraph))\n  if (type = schema.nodes.heading) {\n    // console.info(\" schema.nodes.heading \", schema.nodes.heading.spec.parseDOM.length);\n    for (let i = 1; i <= schema.nodes.heading.spec.parseDOM.length; i++) {\n      bind(\"Shift-Ctrl-\" + i, setBlockType(type, {level: i+1}, schema.nodes.paragraph))  // +1 because only one h1 is allowed\n    }\n  }\n  if (type = schema.nodes.horizontal_rule) {\n    let hr = type\n    bind(\"Mod-_\", (state, dispatch) => {\n      dispatch(state.tr.replaceSelectionWith(hr.create()).scrollIntoView())\n      return true\n    })\n  }\n\n\n  // NEW (LINK) - Mod-l not working in safari\n  if (type = schema.marks.link) {\n    bind(\"Shift-Ctrl-l\", (state, dispatch, view) => {\n        if ((!state.selection.empty && canInsertBlock(state, schema.marks.link))  // selection\n          || (canInsertBlock(state, schema.marks.link) && markActive(state, schema.marks.link) ) // active link can be viewed also if there is empty selection and cursor is inside\n          ) {\n          let linkKey = state.config.pluginsByKey[\"extension$\"];\n          // console.log(\"pluginsByKey\",state.config.pluginsByKey)\n          linkKey.spec.openDialog(view);\n          //console.log(\"linkKey\",linkKey,view);        \n        }\n        // console.log(\"is markActive\", );\n        return true;\n    });\n  }\n\n  return keys\n}\n\nfunction EscapeOut(itemType, opt_cut_, opt_tr_) {\n  return function(state, dispatch) {\n    let {$from, $to} = state.selection\n    let range = $from.blockRange($to, node => node.childCount)\n    if (!range) {\n      return false\n    }\n    if (!dispatch) return true\n    if ($from.node(range.depth - 1).type == itemType) // Inside a parent list\n      // return EscapeToOuter(state, dispatch, itemType, range)\n      //console.log(\"inside itemType - not supported\")\n      return false;\n    else // Outer list node\n      //console.log(\"lift out to doc\")\n      return EscapeOutOf(state, dispatch, range, opt_cut_, opt_tr_)\n  }\n}\n\nfunction EscapeOutOf(state, dispatch, range, opt_cut_, opt_tr_) {\n    let {$from, $to, node} = state.selection\n    if ((node && node.isBlock) || $from.depth < 2 || !$from.sameParent($to)) return false\n    let grandParent = $from.node(-1)    \n    let pPos = null;\n    if (grandParent.type != state.schema.nodes.doc) {\n      // TEST\n        // console.log(\"state.selection\", $from.start());\n        // let parent_ = state.doc.resolve($from.start());\n        // console.warn('get pos of doc', $from, parent_)\n        // console.warn('$from.before(-1)', $from.before(-1))\n        // console.warn('parent_.before(-1)', parent_.before(-1))\n      // POSITION AFTER FIGURE\n        pPos = state.doc.resolve($to.after(1));\n    } else {\n      // not tested\n      pPos = $to;\n      return false;\n    }\n\n    if (dispatch) {\n\n      if (opt_cut_) {\n        // CUT to NEW BLOCK\n        \n          // cut content node\n            let wrap_cut = Fragment.from($from.node(0).cut($from.pos,$from.end())); \n          // create new content node\n            let wrap_paste = Fragment.empty; //state.schema.nodes.paragraph.createAndFill();\n          // Loop cuttted fragment\n            const addchildren = (node, pos) => {\n              // console.log(\"\\tnode\",node,pos);\n              if (pos>2) {\n                wrap_paste = wrap_paste.append(Fragment.from(node));\n                return false;\n              }\n            }\n            wrap_cut.descendants(addchildren);\n          // Create fragment from new p node\n            wrap_paste = Fragment.from(state.schema.nodes.paragraph.create(null,wrap_paste));\n            //console.log(\"wrap\", wrap, wrap_paste);\n          \n          // Add \n            let tr = opt_tr_ || state.tr;\n            if ($from.pos==$from.end()) {\n              tr.replace(pPos.pos, pPos.pos,new Slice(wrap_paste,0,0) );// 1,1 = to next block; 0,0 = to new empty block (has issues at the end of doc)\n            } else {\n              tr.replace(pPos.pos, pPos.pos,new Slice(wrap_paste,1,1) );// 1,1 = to next block; 0,0 = to new empty block (has issues at the end of doc)\n            }        \n            tr.setSelection(state.selection.constructor.near(tr.doc.resolve(pPos.pos)))\n            tr.delete($from.pos, $from.end())\n            dispatch(tr.scrollIntoView())\n\n      } else {\n        // JUST ESCAPE TO NEW P BLOCK\n          \n          if ($to.pos==$to.end()) {\n            // only at the end of node so it feels more native\n\n            let frag_ = Fragment.from(state.schema.nodes.paragraph.create());        \n            let tr = opt_tr_ || state.tr;\n            tr.replace(pPos.pos, pPos.pos, new Slice(frag_, 0, 0) );// 1,1 = to next block; 0,0 = to new empty block (has issues at the end of doc)\n            tr.setSelection(state.selection.constructor.near(tr.doc.resolve(pPos.pos)))\n            dispatch(tr.scrollIntoView())\n        }\n\n      }\n    }\n    return true\n}","import {Plugin,PluginKey,TextSelection} from \"prosemirror-state\"\nimport {Decoration, DecorationSet} from \"prosemirror-view\"\nimport {Slice, Fragment} from \"prosemirror-model\"\nimport {getIcon,icons} from \"se-menu-basic\"\nimport {toggleMark} from \"prosemirror-commands\"\n\n// ***********************************************\n// ************** Plugin Key Class ***************\n// ***********************************************\n\t\n/**\n * A key is used to tag plugins in a way that makes it possible to find them, given an editor state. Assigning a key does mean only one plugin of that type can be active in a state.\n * Docs: https://prosemirror.net/docs/ref/#state.PluginKey\n * @type {PluginKey}\n */\nconst extensionPluginKey = new PluginKey(\"extension\")\n\n/**\n * [createExtension description]\n * @param  {class} \tscheme \t\t\tDocument schema\n * @param  {class} \tmenuPlugin\t\tPlugin handling editor menu\n * @param  {class} \tuploaderClass  \tExternall Class responsible for handling upload\n * @return {class}            \t\tPlugin\n */\nexport function extensionPlugin(schema, menuPlugin, uploaderClass) {\t\n\n\t// ***********************************************\n\t// ************** Plugin Core Class **************\n\t// ***********************************************\t\n\t\n\t/**\n\t * Core class for Extension class\n\t * @type {pluginCoreClass}\n\t */\n\tlet pluginCore = new pluginCoreClass(schema, menuPlugin, uploaderClass)\t\n\n\n\t// ***********************************************\n\t// ***************** Plugin Class ****************\n\t// ***********************************************\t\n\t\n\t/**\n\t * Article Plugin - Create a plugin.\n\t * Plugins bundle functionality that can be added to an editor. They are part of the editor state and may influence that state and the view that contains it.\n\t * Docs: https://prosemirror.net/docs/ref/#state.Plugin\n\t * @param {Object} \tPluginSpec (https://prosemirror.net/docs/ref/#state.PluginSpec)\n\t * @return {Class}  Pluging\n\t */\n\tlet pluginClass = new Plugin(\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t            \n\t\t\t\t\t\t\t          \t/**\n\t\t\t\t\t\t\t          \t * Plugin Spec Key\n\t\t\t\t\t\t\t          \t * Can be used to make this a keyed plugin. You can have only one plugin with a given key in a given state, but it is possible to access the plugin's configuration and state through the key, without having access to the plugin instance object.\n\t\t\t\t\t\t\t          \t * A key is used to tag plugins in a way that makes it possible to find them, given an editor state. Assigning a key does mean only one plugin of that type can be active in a state.\n\t\t\t\t\t\t\t          \t * Docs: https://prosemirror.net/docs/ref/#state.PluginSpec.key\n\t\t\t\t\t\t\t          \t * @type {Class}\tPluginKey (https://prosemirror.net/docs/ref/#state.PluginKey). E.g. new PluginKey(\"extension\"), // must be constant so it will remain the same across all instances\n\t\t\t\t\t\t\t          \t */\n\t\t\t\t\t\t\t            key: extensionPluginKey, \n\t\t\t\t\t\t\t            \n\t\t\t\t\t\t    \t\t\t/**\n\t\t\t\t\t\t    \t\t\t * Plugin Spec State\n\t\t\t\t\t\t    \t\t\t * Allows a plugin to define a state field, an extra slot in the state object in which it can keep its own data.\n\t\t\t\t\t\t    \t\t\t * A plugin spec may provide a state field (under its state property) of this type, which describes the state it wants to keep. Functions provided here are always called with the plugin instance as their this binding.\n\t\t\t\t\t\t    \t\t\t * Docs: https://prosemirror.net/docs/ref/#state.PluginSpec.state\n\t\t\t\t\t\t    \t\t\t * @type {Interface}\tStateField interface (https://prosemirror.net/docs/ref/#state.StateField)\n\t\t\t\t\t\t    \t\t\t */\n\t\t\t\t\t\t    \t\t\tstate: {\n\t\t\t\t\t\t    \t\t\t\t/**\n\t\t\t\t\t\t    \t\t\t\t * Initialize the value of the field. config will be the object passed to EditorState.create. Note that instance is a half-initialized state instance, and will not have values for plugin fields initialized after this one.\n\t\t\t\t\t\t    \t\t\t\t * Docs: https://prosemirror.net/docs/ref/#state.StateField.init\n\t\t\t\t\t\t    \t\t\t\t * @param  {Object} config   \tObject passed to EditorState.create (https://prosemirror.net/docs/ref/#state.EditorState%5Ecreate)\n\t\t\t\t\t\t    \t\t\t\t * @param  {Class} \tinstance \tEditor State - The state of a ProseMirror editor is represented by an object of this type. A state is a persistent data structure—it isn't updated, but rather a new state value is computed from an old one using the apply method.\n\t\t\t\t\t\t    \t\t\t\t * @return {Class}          \tDecorationSet - A collection of decorations, organized in such a way that the drawing algorithm can efficiently use and compare them. This is a persistent data structure—it is not modified, updates create a new value. (https://prosemirror.net/docs/ref/#view.DecorationSet)\n\t\t\t\t\t\t    \t\t\t\t */\n\t\t\t\t\t\t\t\t\t\t    init(config, instance) { \n\t\t\t\t\t\t\t\t\t\t    \treturn DecorationSet.empty \n\t\t\t\t\t\t\t\t\t\t    },\n\t\t\t\t\t\t\t\t\t\t    /**\n\t\t\t\t\t\t\t\t\t\t     * Apply the given transaction to this state field, producing a new field value. Note that the newState argument is again a partially constructed state does not yet contain the state from plugins coming after this one.\n\t\t\t\t\t\t\t\t\t\t     * Docs: https://prosemirror.net/docs/ref/#state.StateField.apply\n\t\t\t\t\t\t\t\t\t\t     * @param  {Class} \ttr       \t\tTransaction - An editor state transaction, which can be applied to a state to create an updated state.\n\t\t\t\t\t\t\t\t\t\t     * @param  {Class} \tset      \t\tDecorationSet - A collection of decorations, organized in such a way that the drawing algorithm can efficiently use and compare them. This is a persistent data structure—it is not modified, updates create a new value. (https://prosemirror.net/docs/ref/#view.DecorationSet)\n\t\t\t\t\t\t\t\t\t\t     * @param  {Class} oldState \t\tEditor State - The state of a ProseMirror editor is represented by an object of this type. A state is a persistent data structure—it isn't updated, but rather a new state value is computed from an old one using the apply method.\n\t\t\t\t\t\t\t\t\t\t     * @param  {Class} newStatePartial \tEditor State (partially constructed) - The state of a ProseMirror editor is represented by an object of this type. A state is a persistent data structure—it isn't updated, but rather a new state value is computed from an old one using the apply method.\n\t\t\t\t\t\t\t\t\t\t     * @return {Class}          \t\tDecorationSet - A collection of decorations, organized in such a way that the drawing algorithm can efficiently use and compare them. This is a persistent data structure—it is not modified, updates create a new value. (https://prosemirror.net/docs/ref/#view.DecorationSet)\n\t\t\t\t\t\t\t\t\t\t     */\n\t\t\t\t\t\t\t\t\t\t    apply(tr, set, oldState, newStatePartial) {\t\t\t\t\t\t\t\t\t\t    \t\n\n\n\t\t\t\t\t\t\t\t\t\t\t\t// Adjust decoration positions to changes made by the transaction\n\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.map(tr.mapping, tr.doc\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonRemove: decoSpec => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Cancel Upload\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof decoSpec.name != \"undefined\" && decoSpec.name == \"imageUpload\") { // if (typeof decoSpec.id != \"undefined\" && typeof decoSpec.id.uploader != \"undefined\") {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpluginCore.uploader(null, null, decoSpec);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\t\t\t\t\t\t// See if the transaction has meta actions\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet action = tr.getMeta(this);\n\n\t\t\t\t\t\t\t\t\t\t\t\t// Apply changes per requested action\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (action && action.add) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Upload placeholder - add DOM for upload placeholder (SVG)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Default dimensions\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget_width = 550;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget_height = 550;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Target Element Source:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// let widget_html = \t\"<svg width=\\\"\"+widget_width+\"px\\\" height=\\\"\"+widget_height+\"px\\\" viewBox=\\\"0 0 \"+widget_width+\" \"+widget_height+\"\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\"> \\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \t\t\t\t\t    <g id=\\\"Page-1\\\" stroke=\\\"none\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\"> \\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \t\t\t\t\t        <rect id=\\\"Rectangle-1\\\" fill=\\\"#EEEEEE\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"\"+widget_width+\"\\\" height=\\\"\"+widget_height+\"\\\"></rect> \\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \t\t\t\t\t    </g> \\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \t\t\t\t\t</svg> \\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \t\t\t\t\t\";\t\t\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Create SVG\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget.setAttribute(\"style\",\"display: none;\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget.setAttribute(\"viewBox\", \"0 0 \"+widget_width+\" \"+widget_height+\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget.setAttribute(\"version\",\"1.1\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget.setAttribute(\"xmlns\",\"http://www.w3.org/2000/svg\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget.setAttribute(\"xmlns:xlink\",\"http://www.w3.org/1999/xlink\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget_group = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget_rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget_rect.setAttributeNS(null,\"x\",0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget_rect.setAttributeNS(null,\"y\",0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget_rect.setAttributeNS(null,\"width\",widget_width);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget_rect.setAttributeNS(null,\"height\",widget_height);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget_rect.setAttributeNS(null,\"fill\",\"transparent\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget_rect.setAttributeNS(null,\"stroke\",\"0\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget_group.appendChild(widget_rect);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    widget.appendChild(widget_group);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Create Widget Decoration\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet deco = Decoration.widget(action.add.pos, widget, {id: action.add.id, name: \"imageUpload\", stopEvent: evt => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// stop all\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} } );\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add to set\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//console.log(\"editor add deco: \", deco);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.add(tr.doc, [deco])\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.open) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Upload placeholder - add DOM wrapper for upload placeholder\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet deco = Decoration.node(action.open.pos.from, action.open.pos.to, {class: 'simpleeditor-figure-build'},{id: action.open.id, name: \"figwrap\" });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.add(tr.doc, [deco])\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.close && action.removeAll) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Upload placeholder - remove DOM wrapper for upload placeholder and close figure\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(set.find(null, null, spec => spec.id == action.close.id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(set.find(null, null, spec => (spec.name == action.removeAll.name &&  spec.id.uploader == action.removeAll.uploader )))\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.close) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Upload placeholder - remove DOM wrapper for upload placeholder\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(set.find(null, null, spec => spec.id == action.close.id))\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.preview) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Upload placeholder - update DOM preview for upload placeholder\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Find placeholder\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet pset = set.find(null, null, spec => spec.id == action.preview.id);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (pset.length!=0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Vars\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget_svg = pset[0].type.toDOM;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget_rect = widget_svg.childNodes[0].childNodes[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet svgw, svgh;\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Radians for the rotations we want to adress\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet rotation = {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// img: 1 8 3 6\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 1: 0, //'rotate(0deg)',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t3: 180 * (Math.PI/180), //'rotate(180deg)',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t6: 90 * (Math.PI/180), //'rotate(90deg)',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t8: 270 * (Math.PI/180) //'rotate(270deg)'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// img-mirror: 2 7 4 5\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// DODO: [upload-preview] correct mirror image\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Do we have image data from filereader\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.preview.dim!=null) {\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Data Image received\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Flip dimensions if image is sideways\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.preview.dim[2]==8 || action.preview.dim[2]==6 || action.preview.dim[2]==7 || action.preview.dim[2]==5) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        \tsvgw = action.preview.dim[1];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvgh = action.preview.dim[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        } else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        \tsvgw = action.preview.dim[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvgh = action.preview.dim[1];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SVG - set viewbox and height to source size (width will be evaluated after max-height takes place)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.setAttribute(\"viewBox\",\"0 0 \"+svgw+\" \"+svgh+\"\");\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.setAttribute(\"height\",svgh);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// RECT - set width and height so we the aspect ration is predetermined\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_rect.setAttribute(\"width\",svgw);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_rect.setAttribute(\"height\",svgh);\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t // SVG - remove display none from the svg so we can get bounding rectangle of the 1st child (rect)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.removeAttribute(\"style\");\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Correct dimension to size we are actually showing in the window\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (widget_svg.childNodes[0].getBoundingClientRect) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Test values\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// var bBox = widget_svg.getBBox();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log( widget_svg.getBoundingClientRect(), bBox, widget_svg.childNodes[0].getBoundingClientRect(), widget_svg.childNodes[0].childNodes[0], widget_rect.getBBox());\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// GET resize dimensions from Rectangle (it keeps the aspect ratio)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet brect = widget_svg.childNodes[0].getBoundingClientRect(); //must be 1st child to get correct rectangle\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Update width and height we are going to use for the svg and rotation\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvgw = brect.width;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvgh = brect.height;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Do we have valid dimensions\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (svgw!=0 && svgw!=0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// we have valid dimensions\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SVG - correct viewbox and height \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.setAttribute(\"viewBox\",\"0 0 \"+svgw+\" \"+svgh+\"\");\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.setAttribute(\"height\",svgh);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// RECT - correct width and height for the rectangle\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_rect = widget_svg.childNodes[0].childNodes[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_rect.setAttribute(\"width\",svgw);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_rect.setAttribute(\"height\",svgh);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// IMAGE BG - set background image\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.preview.src) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SVG - background style\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.style.backgroundRepeat = \"no-repeat\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.style.backgroundPosition = \"center\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.style.backgroundSize = \"contain\";\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Get the source\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet bg_src = action.preview.src;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Do we need to rotate the source\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (rotation[action.preview.dim[2]]) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// We need to rotate the image preview\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Create image element to hold the source we draw to canvas\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar image_canvas = new Image();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timage_canvas.src = action.preview.src;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Onload draw to canvas and rotate\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timage_canvas.onload = function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Source loadad\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Is valid\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ('naturalHeight' in this) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t            if (this.naturalHeight + this.naturalWidth === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                this.onerror();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t                return;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t            }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        } else if (this.width + this.height == 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t            this.onerror();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t            return;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        }\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Get Sizes (twice the source)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar cw = 2*svgw;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar ch = 2*svgh;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Create Canvas\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar canvas = document.createElement('canvas');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcanvas.setAttribute(\"width\", cw);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcanvas.setAttribute(\"height\", ch);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Get position\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar x = canvas.width / 2;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar y = canvas.height / 2;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Get Image size (flip according to rotation)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.preview.dim[2]==8 || action.preview.dim[2]==6 || action.preview.dim[2]==7 || action.preview.dim[2]==5) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        \tcw = 2*svgh;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tch = 2*svgw;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar width = cw;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar height = ch;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Get the drawing context and rotate image\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar context = canvas.getContext('2d');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontext.translate(x, y);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontext.rotate(rotation[action.preview.dim[2]]);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontext.drawImage(this, -width / 2, -height / 2, width, height);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontext.rotate(-rotation[action.preview.dim[2]]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontext.translate(-x, -y);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Get rotated image\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbg_src = canvas.toDataURL();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add image to svg background\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.style.backgroundImage = \"url(\"+bg_src+\")\";\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Cleanup\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbg_src = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timage_canvas = null;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timage_canvas.onerror = function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Source not loaded - set not rotated version\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.style.backgroundImage = \"url(\"+bg_src+\")\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// No need to rotate\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.style.backgroundImage = \"url(\"+bg_src+\")\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// No image data received\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// RECT - set background color\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_rect.setAttribute(\"fill\",\"#EEE\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SVG - remove display none from the svg so we can get bounding rectangle\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.removeAttribute(\"style\");\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// DIM from window\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (widget_svg.childNodes[0].getBoundingClientRect) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet brect = widget_svg.childNodes[0].getBoundingClientRect();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvgw = brect.width;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvgh = brect.height;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (svgw!=0 && svgw!=0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.setAttribute(\"viewBox\",\"0 0 \"+svgw+\" \"+svgh+\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.setAttribute(\"height\",svgh);\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_rect.setAttribute(\"width\",svgw);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_rect.setAttribute(\"height\",svgh);\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add progress bar\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Vars\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar p_width_ = svgw;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar p_stroke_ = 4; \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar p_height_ = p_stroke_;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar p_dash_ = p_width_; \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// SOURCE:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \"<svg width=\\\"\"+p_width_+\"\\\" height=\\\"\"+p_height_+\"\\\" viewBox=\\\"0 0 \"+(p_width_)+\" \"+(p_height_)+\"\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xml:space=\\\"preserve\\\" style=\\\"position: absolute;z-index: 1; margin: 0; display: block; left: 0;right: 0;bottom: 0;\\\"> \\\n\t\t\t\t\t\t\t                                                //     <path d=\\\" M 0,\"+(p_stroke_/2)+\" h \"+(p_width_)+\"\\\" fill=\\\"transparent\\\" stroke-dasharray=\\\"\"+p_dash_+\"\\\" stroke-dashoffset=\\\"0\\\" style=\\\" stroke-dashoffset: \"+p_dash_+\";transition: stroke-dashoffset 1s linear; stroke: #ff6766; stroke-width: \"+p_stroke_+\"px;\\\"></path> \\\n\t\t\t\t\t\t\t                                                // </svg>\";\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// PRG bar background - working but not needed\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// let widget_prg_bg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// widget_prg_bg.setAttributeNS(null,\"d\",\"M 0,\"+(svgh-(p_stroke_/2))+\" h \"+(p_width_)+\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// widget_prg_bg.setAttributeNS(null,\"fill\",\"transparent\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// widget_prg_bg.setAttributeNS(null,\"stroke-dasharray\",p_dash_);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// widget_prg_bg.setAttributeNS(null,\"stroke-dashoffset\",\"0\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// widget_prg_bg.setAttributeNS(null,\"style\",\"stroke: #e6e6e6b3; stroke-width: \"+p_stroke_+\"px;\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// widget_svg.appendChild(widget_prg_bg);\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// PRG bar\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget_prg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_prg.setAttributeNS(null,\"d\",\"M 0,\"+(svgh-(p_stroke_/2))+\" h \"+(p_width_)+\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_prg.setAttributeNS(null,\"fill\",\"transparent\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_prg.setAttributeNS(null,\"stroke-dasharray\",p_dash_);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_prg.setAttributeNS(null,\"stroke-dashoffset\",\"0\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_prg.setAttributeNS(null,\"class\",\"simpleeditor-progressbar\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_prg.setAttributeNS(null,\"style\",\"stroke-dashoffset: \"+p_dash_+\";transition: stroke-dashoffset 1s linear; stroke-width: \"+p_stroke_+\"px;\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget_svg.appendChild(widget_prg);\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.progress) {\n\n\t\t\t\t\t\t         \t\t\t\t\t\t// Upload placeholder - update DOM progress for upload placeholder\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet pset = set.find(null, null, spec => spec.id == action.progress.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (pset.length!=0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet widget_svg = pset[0].type.toDOM;\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (widget_svg && action.progress.value!=null) {\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar prgbar = widget_svg.childNodes[1];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (prgbar) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar l = prgbar.getTotalLength();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar val = action.progress.value*100;\n\t\t\t\t\t\t\t                                            if (isNaN(val)) {\n\t\t\t\t\t\t\t                                                val = 100; \n\t\t\t\t\t\t\t                                            }\n\t\t\t\t\t\t\t                                            if (val < 0) { val = 0;}\n\t\t\t\t\t\t\t                                            if (val > 100) { val = 100;}\n\t\t\t\t\t\t\t                                            var pct = ((100-val)/100)*l;\n\t\t\t\t\t\t\t                                            prgbar.style.strokeDashoffset = pct;\n\t\t\t\t\t\t                                        \t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.update) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Upload placeholder - update\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// This rely on referenced update\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet deco_update = set.find(null, null, spec => spec.id == action.update.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (deco_update.length>0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeco_update[0].spec.id.url = action.update.url;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log(\"set\", deco_update);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// // set = set.remove(set.find(null, null, spec => spec.id == action.update.id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// // set = set.add(tr.doc, deco_update)\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.removeAll) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Upload placeholder - remove all\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.removeAll == null) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = DecorationSet.empty;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(set.find(null, null, spec => (spec.name == action.removeAll.name &&  spec.id.uploader == action.removeAll.uploader )))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.remove) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Upload placeholder - remove\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.remove == null) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = DecorationSet.empty;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(set.find(null, null, spec => spec.id == action.remove.id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.videoSource) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove Block menu\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet remove_decorations = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet decorations = set.find(null, null, spec => spec.name == \"blockMenu\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < decorations.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove event listeners to prevent memory leaks\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet el_ = decorations[i].type.toDOM || null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (el_!==null) {\n\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tlet el_child_ = null;\n\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tfor (var j = el_.childNodes.length - 1; j >= 0; j--) {\n\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t \tel_child_ = el_.childNodes[j];\n\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t \tif (el_child_.tagName == \"BUTTON\") {\n\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t \t\tel_child_.removeEventListener('mousedown',pluginCore.fnCallback_blockMenu);\n\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t \t}\n\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t};\n\t\t\t\t\t\t\t\t                  \t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add to array \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tremove_decorations.push(decorations[i]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (remove_decorations.length!=0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(remove_decorations);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tremove_decorations = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add video source decoration (called from Block menu)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet videoSource_id = {};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet deco_videoSource = Decoration.node(action.videoSource.pos.from, action.videoSource.pos.to, {class: 'simpleeditor-embed-node'},{id: videoSource_id, name: \"videoSource\" });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.add(tr.doc, [deco_videoSource])\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && (action.blockMenu || action.emptyNode || action.selectedEmptyNode || action.figureCaption)) {\n\t\t\t\t\t\t\t\t\t\t    \t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Array of decoration that will be added to current set\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet deco_ = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add empty node decoration\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.emptyNode) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet deco_emptyNode = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet emptyNode_id_ = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (Array.isArray(action.emptyNode)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < action.emptyNode.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temptyNode_id_ = new Date().getTime()+i; //action.emptyNode[i].id; -> for some reason this is not passed to node decoration so we need to create new unique id because decorations are compered by 3rd parameter (https://prosemirror.net/docs/ref/#view.Decoration^node^spec)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeco_emptyNode = Decoration.node(action.emptyNode[i].pos.from, action.emptyNode[i].pos.to, {class: \"simpleeditor-empty-node\"},{id: emptyNode_id_, name: \"emptyNode\"});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeco_.push(deco_emptyNode);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temptyNode_id_ = new Date().getTime(); //action.emptyNode[i].id;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeco_emptyNode = Decoration.node(action.emptyNode.pos.from, action.emptyNode.pos.to, {class: \"simpleeditor-empty-node\"},{id: emptyNode_id_, name: \"emptyNode\"});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeco_.push(deco_emptyNode);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add selected empty node decoration\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.selectedEmptyNode) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet selectedEmptyNode_id = {};\n\t\t\t\t\t\t\t\t\t\t                    let deco_selectedEmptyNode = Decoration.node(action.selectedEmptyNode.pos.from-1, action.selectedEmptyNode.pos.to-1, {class: 'simpleeditor-empty-node-selected'},{id: selectedEmptyNode_id, name: \"selectedEmptyNode\"});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add to array\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeco_.push(deco_selectedEmptyNode);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add figure caption placeholer node decoration\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.figureCaption) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ADD WIDGET FIGCAPTION\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Create DOM\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet fnCallback_cap = function(e) {\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// stop event so we don't fuckup range and focus \n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// dom\t                  \t\t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\tlet el_ = e.currentTarget; //e.target;\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// let pel_ = el_.parentNode; \n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// remove listener\t                  \t\t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\tel_.removeEventListener('mousedown',fnCallback_cap);\t                  \t\t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// call trans\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\tthis.aTrans = { \"insertCaption\": [el_.pos] };\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\tthis.mFixView(this.view);\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// focus\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// pel_.lastChild.focus();\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t} \n\t\t\t\t\t\t\t\t\t\t                  \t\t\tlet figcap_el = document.createElement(\"figcaption\");\n\t\t\t\t\t\t\t\t\t\t                  \t\t\tfigcap_el.setAttribute(\"class\", \"simpleeditor-empty-node\");\n\t\t\t\t\t\t\t\t\t\t                  \t\t\tfigcap_el.appendChild(document.createTextNode(\"\"));\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t// figcap_el.pos = pos+node.nodeSize-1;\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t// figcap_el.addEventListener('mousedown', fnCallback_cap.bind(pluginCore));\n\t\t\t\t\t\t\t\t\t\t                  \t\t\tfigcap_el.addEventListener('mousedown', pluginCore.fnCallback_figureCaption.bind(pluginCore,action.figureCaption.pos.from));\n\n\t\t\t\t\t\t\t\t\t\t                  \t\t// Add to decoration\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet figureCaption_key = new Date().getTime(); // Widgets are compared by key (https://prosemirror.net/docs/ref/#view.Decoration^widget^spec.key)\n\t\t\t\t\t\t\t\t\t\t\t\t                    let deco_figureCaption = Decoration.widget(action.figureCaption.pos.from, figcap_el, {key: figureCaption_key.toString(), name: \"figureCaption\" , side: -1, ignoreSelection: true, stopEvent: evt => {\n\t\t\t\t\t\t\t\t\t\t\t\t                    \t// stop all - https://prosemirror.net/docs/ref/#view.Decoration^widget^spec.stopEvent\n\t\t\t\t\t\t\t\t\t\t\t\t                    \treturn true;\n\t\t\t\t\t\t\t\t\t\t\t\t                    } })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeco_.push(deco_figureCaption);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Block Menu\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (action.blockMenu) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Find other empty paragraph decorations\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet has_other_decoration = set.find(null, null, spec => spec.name == \"videoSource\");\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Has other decoration in empty paragraph\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (has_other_decoration.length==0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// ADD WIDGET BLOCK MENU\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// FF issue with cursor not showing when added to new paragraph !!!\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// https://bugs.chromium.org/p/chromium/issues/detail?id=977991\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=1175495\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// See also: \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// https://github.com/ProseMirror/prosemirror/issues/1069\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// https://github.com/ProseMirror/prosemirror/issues/991\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// We will need to wait until this is resolved.\n  \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove duplicates\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(set.find(null, null, spec => spec.name == \"blockMenu\"));\n\n\t\t\t\t\t\t\t\t\t\t                        \t// Create menu wrapper\n\t\t\t\t\t\t\t\t\t\t\t                        \tlet menu_tt_el = document.createElement(\"div\");\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\tmenu_tt_el.setAttribute(\"class\", \"simpleeditor-menu-tooltip\");\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t//menu_tt_el.setAttribute(\"tabindex\",\"-1\");\n\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t// Create buttons\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// IMG button\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tlet el_img = document.createElement(\"button\");\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t//el_img.setAttribute(\"tabindex\",\"-1\");\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tel_img.appendChild(getIcon(icons.image,\"simpleeditor-menu-tooltip-icon\"));\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tmenu_tt_el.appendChild(el_img);\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t// external uploader callback\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tpluginCore.uploader(el_img, pluginCore.fnCallback_upload.bind(pluginCore, {from: action.blockMenu.pos.from, to: action.blockMenu.pos.to}));\n\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// Video button\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tlet el_vid = document.createElement(\"button\");\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t//el_vid.setAttribute(\"tabindex\",\"-1\");\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tel_vid.appendChild(getIcon(icons.video,\"simpleeditor-menu-tooltip-icon\"));\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tel_vid.addEventListener('mousedown', pluginCore.fnCallback_blockMenu.bind(pluginCore,\"replaceWithVideoDecoration\",{from: action.blockMenu.pos.from-1, to: action.blockMenu.pos.from+1}));\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tmenu_tt_el.appendChild(el_vid);\t\t\t\t                  \t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t// HR button\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tlet el_hr = document.createElement(\"button\");\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t// el_hr.setAttribute(\"tabindex\",\"-1\");\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tel_hr.appendChild(getIcon(icons.hr,\"simpleeditor-menu-tooltip-icon\"));\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tel_hr.addEventListener('mousedown', pluginCore.fnCallback_blockMenu.bind(pluginCore,\"replaceWithHr\",(action.blockMenu.pos.from+1)));\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tmenu_tt_el.appendChild(el_hr);\t\t\t\t                  \t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t// Add to decoration\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\tlet blockMenu_key = new Date().getTime(); // Widgets are compared by key (https://prosemirror.net/docs/ref/#view.Decoration^widget^spec.key)\n\t\t\t\t\t\t\t\t\t\t\t\t\t                    let deco_blockMenu = Decoration.widget(action.blockMenu.pos.from, menu_tt_el, {key: blockMenu_key.toString(), name: \"blockMenu\" , side: -1, ignoreSelection: true, stopEvent: evt => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t                    \t// stop all - https://prosemirror.net/docs/ref/#view.Decoration^widget^spec.stopEvent\n\t\t\t\t\t\t\t\t\t\t\t\t\t                    \treturn true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t                    } })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeco_.push(deco_blockMenu);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t                // Add class to animate menu wrapper after short delay (handled by CSS)\n\t\t\t\t\t\t\t\t\t\t\t\t\t               \t\tsetTimeout(function(){ \n\t\t\t\t\t\t\t\t\t\t\t\t\t               \t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t               \t\t\t\tmenu_tt_el.setAttribute(\"class\", \"simpleeditor-menu-tooltip focus\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t               \t\t\t} catch(e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t               \t\t\t\t// console.warn(\"DOM element might be already removed\", e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t               \t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t               \t\t}, 500);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add decoration to current set\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (deco_.length!=0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.add(tr.doc, deco_);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (action && action.blurRemove) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove selectedEmptyNode decoration onBlur (be aware that if they might be re-added unless view.hasFocus() is checked)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(set.find(null, null, spec => spec.name == \"selectedEmptyNode\"));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove decorations\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet el_ = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet remove_decorations = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet decorations = set.find(null, null, spec => spec.name != null);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < decorations.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tswitch (decorations[i].spec.name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase \"blockMenu\":\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove event listeners to prevent memory leaks\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel_ = decorations[i].type.toDOM || null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (el_!==null) {\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tlet el_child_ = null;\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\tfor (var j = el_.childNodes.length - 1; j >= 0; j--) {\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t \tel_child_ = el_.childNodes[j];\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t \tif (el_child_.tagName == \"BUTTON\") {\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t \t\tel_child_.removeEventListener('mousedown',pluginCore.fnCallback_blockMenu);\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t \t}\n\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add to remove array\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tremove_decorations.push(decorations[i]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase \"videoSource\":\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase \"selectedEmptyNode\":\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add to remove array\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tremove_decorations.push(decorations[i]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase \"figureCaption\":\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove event listeners to prevent memory leaks\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel_ = decorations[i].type.toDOM || null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (el_!==null) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel_.removeEventListener('mousedown',pluginCore.fnCallback_figureCaption);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add to remove array\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tremove_decorations.push(decorations[i]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase \"emptyNode\":\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// For cases where the node for decoration might have been already removed from DOM\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Update state to look at most recent nodes while looking for dom element\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpluginCore.view.updateState(newStatePartial);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Find DOM node\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel_ = pluginCore.view.nodeDOM(decorations[i].from) || null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove only if DOM is element and has some text content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (el_!=null && el_.nodeType==1 && el_.textContent.length != 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add to remove array\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tremove_decorations.push(decorations[i]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove decorations\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (remove_decorations.length!=0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tset = set.remove(remove_decorations);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t// Return updated set\n\t\t\t\t\t\t\t\t\t\t\t\treturn set\n\t\t\t\t\t\t\t\t\t\t    }\n\n\t\t\t\t\t\t\t\t\t\t    // More methods - https://prosemirror.net/docs/ref/#state.StateField\n\t\t\t\t\t\t\t\t\t\t    /*\n\t\t\t\t\t\t\t\t\t\t    toJSON: ?⁠fn(value: T) → any\n\t\t\t\t\t\t\t\t\t\t\tConvert this field to JSON. Optional, can be left off to disable JSON serialization for the field.\n\t\t\t\t\t\t\t\t\t\t\tfromJSON: ?⁠fn(config: Object, value: any, state: EditorState) → T\n\t\t\t\t\t\t\t\t\t\t\tDeserialize the JSON representation of this field. Note that the state argument is again a half-initialized state.\n\t\t\t\t\t\t\t\t\t\t     */\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t            \n\t\t\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t\t\t * Plugin Spec Transaction to filter\n\t\t\t\t\t\t\t\t\t\t * When present, this will be called before a transaction is applied by the state, allowing the plugin to cancel it (by returning false).\n\t\t\t\t\t\t\t\t\t\t * Docs: https://prosemirror.net/docs/ref/#state.PluginSpec.filterTransaction\n\t\t\t\t\t\t\t\t\t\t * @param  {Object} transaction \tTransaction before applied to state (https://prosemirror.net/docs/ref/#state.Transaction)\n\t\t\t\t\t\t\t\t\t\t * @param  {[type]} state       \tEditorState before supplied transaction (https://prosemirror.net/docs/ref/#state.EditorState)\n\t\t\t\t\t\t\t\t\t\t * @return {Boolean}             \tTrue - pass the transaction, False - Cancel the transaction\n\t\t\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\t\t\t// filterTransaction: (transaction, state) => {\n\t\t\t\t\t\t\t\t\t\t// \tconsole.error(\"\\t catch transaction before it is applied =>\", transaction);\n\t\t\t\t\t\t\t\t\t\t// \t// Pass\n\t\t\t\t\t\t\t\t\t\t// \treturn true;\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t// \t// Block\n\t\t\t\t\t\t\t\t\t\t// \treturn false;\n\t\t\t\t\t\t\t\t\t\t// },\n\t\t\t\t\t\t\t            \n\t\t\t\t\t\t\t            /**\n\t\t\t\t\t\t\t             * Plugin Spec Transactions to append\n\t\t\t\t\t\t\t             * Allows the plugin to append another transaction to be applied after the given array of transactions. When another plugin appends a transaction after this was called, it is called again with the new state and new transactions—but only the new transactions, i.e. it won't be passed transactions that it already saw.\n\t\t\t\t\t\t\t             * Docs: https://prosemirror.net/docs/ref/#state.PluginSpec.appendTransaction\n\t\t\t\t\t\t\t             * @param  {Object} transactions \tTransaction to alter (https://prosemirror.net/docs/ref/#state.Transaction)\n\t\t\t\t\t\t\t             * @param  {[type]} oldState     \tEditorState before supplied transaction (https://prosemirror.net/docs/ref/#state.EditorState)\n\t\t\t\t\t\t\t             * @param  {[type]} newState     \tEditorState after supplied transaction (https://prosemirror.net/docs/ref/#state.EditorState)\n\t\t\t\t\t\t\t             * @return {Void}              \t\tTransaction altered (https://prosemirror.net/docs/ref/#state.Transaction)\n\t\t\t\t\t\t\t             */\n\t\t\t\t\t\t\t            appendTransaction: (transactions, oldState, newState) => {\n\t\t\t\t\t\t\t\t\t\t    \n\t\t\t\t\t\t\t\t\t\t    // Do we have any changes in the queue\n\t\t\t\t\t\t\t\t\t\t    const tr_haveSteps = transactions.some((element) => element.docChanged === true); // OR: transactions.some((element) => element.steps.length > 0);\n\t\t\t\t\t\t\t\t\t\t    \t\t\t\t\t\t\t\t\t\t    \n\n\t\t\t\t\t\t\t\t\t\t    // Get transaction object that will be altered. Work with new state transactions.\n\t\t\t\t\t\t\t\t\t\t    let tr = newState.tr\n\n\t\t\t\t\t\t\t\t\t\t    // Transaction that will be appended\n\t\t\t\t\t\t\t\t\t\t    let tr_updates = {};\n\n\t\t\t\t\t\t\t\t\t\t    // If some changes has happend, they might have producted new state with invalid nodes and decoration - eval fixes\n\t\t\t\t\t\t\t\t\t\t\t    \n\t\t\t\t\t\t\t\t\t\t\t    if (tr_haveSteps===true) {\n\t\t\t\t\t\t\t\t\t\t\t\t    \n\n\t\t\t\t\t\t\t\t\t\t\t    \t// Eval fixes and decorations (we need to try to get rid of this iterator)\t\t\t\t\t\t\t\t\t\t\t\t    \n\t\t\t\t\t\t\t\t\t\t\t\t    let tr_updates_fromRange = {};\n\n\t\t\t\t\t\t\t\t\t\t\t\t    // Get Update for affected positions\n\t\t\t\t\t\t\t\t\t\t\t    \tfor (var i = transactions.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\t\t\t\t\t    \t\tfor (var j = transactions[i].steps.length - 1; j >= 0; j--) {\n\t\t\t\t\t\t\t\t\t\t\t\t    \t\ttransactions[i].steps[j].getMap().forEach(function(oldStart, oldEnd, newStart, newEnd) {\n\t\t\t\t\t\t\t\t\t\t\t\t    \t\t\t// Get Updates for the new nodes\n\t\t\t\t\t\t\t\t\t\t\t\t    \t\t\t\ttr_updates_fromRange = pluginCore.getViewUpdates(newState,newStart,newEnd);\t\n\t\t\t\t\t\t\t\t\t\t\t\t    \t\t\t// Merge identified changes\n\t\t\t\t\t\t\t\t\t\t\t\t\t    \t\t\tfor (var key in tr_updates_fromRange) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        if (tr_updates.hasOwnProperty(key)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        \ttr_updates[key] = tr_updates[key].concat(tr_updates_fromRange[key]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        } else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        \ttr_updates[key] = tr_updates_fromRange[key];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t\t\t\t\t\t    \t\t});\n\t\t\t\t\t\t\t\t\t\t\t    \t\t}\n\t\t\t\t\t\t\t\t\t\t\t    \t};\t\t\t\t\t\t\t\t\t\t\t\t  \n\n\t\t\t\t\t\t\t\t\t\t\t  \t}\n\n\t\t\t\t\t\t\t\t\t\t  \t// Eval Selection change\t\t\t\t\t\t\t\t\t\t  \t\t\n\n\t\t\t\t\t\t\t\t\t  \t\t\t// Get Selections from new State\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet {from, $from, to, empty} = newState.selection;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t// TEST: do we have valid selection?\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.error(\"newState check selection\", $from, empty, $from.parent.childCount, $from.start($from.depth));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// let from_tr = newState.tr.selection.from;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.log(\"compare selections: \", from, from_tr, (from===from_tr))\n\n\t\t\t\t\t\t\t\t\t\t\t\t// Add decoration for selection\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (empty && $from.parent != null  && $from.parent.childCount === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Selected class - only if view has focus so we don't break blur transactions. Limit to specific nodes (empty LI trigger issues on delete enter)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (pluginCore.view.hasFocus() && ($from.parent.type.name == \"title\" || $from.parent.type.name == \"figcaption\")) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof tr_updates['setMeta'] == \"undefined\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttr_updates['setMeta'] = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttr_updates['setMeta'].push({key: \"selectedEmptyNode\", pos: {from: from, to: from + $from.parent.nodeSize}});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Block Menu - add block menu to 1st level paragraphs\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($from.depth == 1 && $from.parent.type.name == \"paragraph\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof tr_updates['setMeta'] == \"undefined\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttr_updates['setMeta'] = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttr_updates['setMeta'].push({key: \"blockMenu\", pos: {from: from, to: from + $from.parent.nodeSize}});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!empty && $from.parent != null  && $from.parent.type.name == \"figure\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Figure content selected\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($from.parent.lastChild!=null && $from.parent.lastChild.type.name!=\"figcaption\") {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Image/Embed selected in figure without caption\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Test last position in the figure where we want to append caption decoration\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// let last_fig_postion = $from.after($from.depth) - 1; //($from.before($from.depth) + $from.parent.nodeSize - 1); //(from - $from.parentOffset + $from.parent.nodeSize - 2)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// console.warn(\"selected: \", $from, from, $from.parentOffset, (from - $from.parentOffset + $from.parent.nodeSize - 2), last_fig_postion);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof tr_updates['setMeta'] == \"undefined\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttr_updates['setMeta'] = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttr_updates['setMeta'].push({key: \"figureCaption\", pos: {from: ($from.after($from.depth)-1), to: ($from.after($from.depth)) }});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\t\t\t\t\t// Append if anything has been detected\t\t\t\t\t\t\t\t\t\t\t    \n\n\t\t\t\t\t\t\t\t\t\t\t    // Append if anything has been detected\n\t\t\t\t\t\t\t\t\t\t\t    if (tr_updates.constructor === Object && Object.keys(tr_updates).length !== 0) {\t\t\t\t\t    \t\n\n\t\t\t\t\t\t\t\t\t\t\t    \t// Alter tr object. Append updates to requested transaction\n\t\t\t\t\t\t\t\t\t\t\t    \ttr = pluginCore.appendTransactions(newState, tr_updates, tr);\t\t\t\t\t\t\t\t\t\t\t\t    \t\n\n\t\t\t\t\t\t\t\t\t\t\t    \t// Pass to new state\n\t\t\t\t\t\t\t\t\t\t\t    \t\treturn tr;\n\t\t\t\t\t\t\t\t\t\t\t    }\n\n\t\t\t\t\t\t\t\t\t\t  \t// Don't alter requested transaction\n\t\t\t\t\t\t\t\t\t\t  \t\t\n\t\t\t\t\t\t\t\t\t\t  \t\t// no return value\n\t\t\t\t\t\t\t\t\t\t  \t\t\n\t\t\t\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\t            /**\n\t\t\t\t\t\t\t             * Plugin Spec properties \n\t\t\t\t\t\t\t             * The view props added by this plugin. Props that are functions will be bound to have the plugin instance as their this binding.\n\t\t\t\t\t\t\t             * Docs: https://prosemirror.net/docs/ref/#state.PluginSpec.props\n\t\t\t\t\t\t\t             * @type {Object}\n\t\t\t\t\t\t\t             */\n\t\t\t\t\t\t\t            props: {\n\t\t\t\t\t\t\t            \t\n\t\t\t\t\t\t\t            \t/**\n\t\t\t\t\t\t\t            \t * A set of document decorations to show in the view.\n\t\t\t\t\t\t\t            \t * Docs: https://prosemirror.net/docs/ref/#view.EditorProps.decorations\n\t\t\t\t\t\t\t            \t * @param  {Class}\tstate \tEditor State - The state of a ProseMirror editor is represented by an object of this type. A state is a persistent data structure—it isn't updated, but rather a new state value is computed from an old one using the apply method.\n\t\t\t\t\t\t\t            \t * @return {Class}          DecorationSet - A collection of decorations, organized in such a way that the drawing algorithm can efficiently use and compare them. This is a persistent data structure—it is not modified, updates create a new value. (https://prosemirror.net/docs/ref/#view.DecorationSet)\n\t\t\t\t\t\t\t            \t */\n\t\t\t\t\t\t\t\t\t        decorations(state) {\n\n\t\t\t\t\t\t\t\t\t        \t/**\n\t\t\t\t\t\t\t\t\t        \t * Extract the plugin's state field from an editor state.\n\t\t\t\t\t\t\t\t\t        \t * Docs: https://prosemirror.net/docs/ref/#state.Plugin.getState\n\t\t\t\t\t\t\t\t\t        \t */\n\t\t\t\t\t\t\t\t\t\t\t\treturn this.getState(state);\n\n\t\t\t\t\t\t\t\t\t        },\n\n\t\t\t\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t\t\t\t * Can be an object mapping DOM event type names to functions that handle them. Such functions will be called before any handling ProseMirror does of events fired on the editable DOM element. Contrary to the other event handling props, when returning true from such a function, you are responsible for calling preventDefault yourself (or not, if you want to allow the default behavior).\n\t\t\t\t\t\t\t\t\t\t\t * Docs: https://prosemirror.net/docs/ref/#view.EditorProps.handleDOMEvents\n\t\t\t\t\t\t\t\t\t\t\t * @type {Object}\n\t\t\t\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\t\t\t\thandleDOMEvents: {\n\t\t\t\t\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t\t\t\t\t * Mouseover - Open link tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t * @param  {Class} \toView \tAn editor view manages the DOM structure that represents an editable document. Its state and behavior are determined by its props.\n\t\t\t\t\t\t\t\t\t\t\t\t * @param  {Event} \te     \tDom Event\n\t\t\t\t\t\t\t\t\t\t\t\t * @return {Boolean}       \tWhen returning true from such a function, you are responsible for calling preventDefault yourself (or not, if you want to allow the default behavior).\n\t\t\t\t\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\t\t\t\t\tmouseover(view, e) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Has mark defined in this class and as well as the schema - block native event\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( ! view.state.schema.marks.link) { return false; }\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Find DOM link from event bubble\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet link = pluginCore._mIsLinkFromDomEvent(view,e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Check if hover matches the link and open tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ( link ) { \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Show dialog\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpluginCore.mShowTooltip(view,link); \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Pass native event\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn true; \n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Pass native event\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t\t\t\t\t * onFocusout - Remove placeholder decorations\n\t\t\t\t\t\t\t\t\t\t\t\t * @param  {Class} \toView \tAn editor view manages the DOM structure that represents an editable document. Its state and behavior are determined by its props.\n\t\t\t\t\t\t\t\t\t\t\t\t * @param  {Event} \te     \tDom Event\n\t\t\t\t\t\t\t\t\t\t\t\t * @return {Boolean}       \tWhen returning true from such a function, you are responsible for calling preventDefault yourself (or not, if you want to allow the default behavior).\n\t\t\t\t\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\t\t\t\t\tfocusout(view, e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Get current selection\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet {$from, empty} = view.state.selection;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t// iOS focusout doesn't refer to button (e.relatedTarget) so we need to hard code the check for placeholder nodes\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($from.parent.type.name == \"title\" || $from.parent.type.name == \"figcaption\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Check if we are empty node\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (empty && $from.parent != null  && $from.parent.childCount === 0) {\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove placeholder decorations\n\t\t\t\t\t\t\t\t\t\t\t            \tview.dispatch(view.state.tr.setMeta(this, {blurRemove: {id:{}}}));\n\t\t\t\t\t\t\t\t\t\t\t            }\n\t\t\t\t\t\t\t\t\t\t        \t}\n\n\t\t\t\t\t        \t\t\t\t\t\t// Pass native event\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\n    \t\t\t\t\t\t\t\t\t\t\t},\n    \t\t\t\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t\t\t\t\t * onFocusin - Add placeholder decorations\n\t\t\t\t\t\t\t\t\t\t\t\t * @param  {Class} \toView \tAn editor view manages the DOM structure that represents an editable document. Its state and behavior are determined by its props.\n\t\t\t\t\t\t\t\t\t\t\t\t * @param  {Event} \te     \tDom Event\n\t\t\t\t\t\t\t\t\t\t\t\t * @return {Boolean}       \tWhen returning true from such a function, you are responsible for calling preventDefault yourself (or not, if you want to allow the default behavior).\n\t\t\t\t\t\t\t\t\t\t\t\t */\n    \t\t\t\t\t\t\t\t\t\t\tfocusin(view, e) {\n\n    \t\t\t\t\t\t\t\t\t\t\t\t// Get current selection\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet {from, $from, empty} = view.state.selection;\t\t\t\t\t\t\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// iOS focusin doesn't refer to button (e.target) so we need to hard code the check for placeholder nodes\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($from.parent.type.name == \"title\" || $from.parent.type.name == \"figcaption\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Check if we are empty node\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (empty && $from.parent != null  && $from.parent.childCount === 0) {\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Add placeholder decoration\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tview.dispatch(view.state.tr.setMeta(this, {selectedEmptyNode: {id:{},pos:{from: from, to: from + $from.parent.nodeSize} }}));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t        \t\t\t\t\t\t\n\t\t\t\t\t        \t\t\t\t\t\t// Pass native event\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\n    \t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t// Other Dom Events\t\t\t      \n\t\t\t\t\t\t\t\t\t\t\t\t// ,mouseout(oView, e) {\t\n\t\t\t\t\t\t\t\t\t\t\t\t// \t// Has mark defined in this class and as well as the schema\n\t\t\t\t\t\t\t\t\t\t\t\t// \tif ( ! oView.state.schema.marks.link) { return false; }\n\n\t\t\t\t\t\t\t\t\t\t\t\t// \t// check if hover  matches the link\n\t\t\t\t\t\t\t\t\t\t\t\t// \tif ( pluginCore._mIsLinkFromDomEvent(oView,e) ) { \n\n\t\t\t\t\t\t\t\t\t\t\t\t// \t\tpluginCore.linkTooltipOpen = e.target; \n\n\t\t\t\t\t\t\t\t\t\t\t\t// \t\treturn true; \n\t\t\t\t\t\t\t\t\t\t\t\t// \t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t// \tpluginCore._mCloseTooltip(oView,e);\n\n\t\t\t\t\t\t\t\t\t\t\t\t// \treturn true;\n\t\t\t\t\t\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t\t\t\t\t    // dragover: start,\n\t\t\t\t\t\t\t\t\t\t\t    // dragenter: start,\n\t\t\t\t\t\t\t\t\t\t\t    // drop(view) {\n\t\t\t\t\t\t\t\t\t\t\t    //   clear()\n\t\t\t\t\t\t\t\t\t\t\t    //   if (plugin.getState(view.state))\n\t\t\t\t\t\t\t\t\t\t\t    //     view.dispatch(view.state.tr.setMeta(plugin, false))\n\t\t\t\t\t\t\t\t\t\t\t    // },\n\t\t\t\t\t\t\t\t\t\t\t    // dragleave(view, e) {\n\t\t\t\t\t\t\t\t\t\t\t    //   if (e.target == view.dom && plugin.getState(view.state)) {\n\t\t\t\t\t\t\t\t\t\t\t    //     clear()\n\t\t\t\t\t\t\t\t\t\t\t    //     // Can't be synchronous because this is also fired when the drag goes onto a child element,\n\t\t\t\t\t\t\t\t\t\t\t    //     // and we can't tell from the event whether that's the case.\n\t\t\t\t\t\t\t\t\t\t\t    //     leaving = setTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t    //       view.dispatch(view.state.tr.setMeta(plugin, false))\n\t\t\t\t\t\t\t\t\t\t\t    //       leaving = null\n\t\t\t\t\t\t\t\t\t\t\t    //     }, 50)\n\t\t\t\t\t\t\t\t\t\t\t    //   }\n\t\t\t\t\t\t\t\t\t\t\t    // }\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t// Other handlers\n\t\t\t\t\t\t\t\t\t\t      \t\n\n\t\t\t\t\t\t\t\t\t          \t// Docs: https://prosemirror.net/docs/ref/#view.EditorProps\n\n\t\t\t\t\t\t\t\t\t\t\t\t// handlePaste(view, event, slice) {\n\t\t\t\t\t\t\t\t\t\t\t\t// slice = unwrapContentFromTableCellsIfSelectionIsInTable(slice, view.state);\n\t\t\t\t\t\t\t\t\t\t\t\t// ....\n\t\t\t\t\t\t\t\t\t\t\t\t// dispatch(state.tr.replaceSelection(slice));\n\t\t\t\t\t\t\t\t\t\t\t\t// return true;\n\t\t\t\t\t\t\t\t\t\t\t\t// },\n\t\t\t\t\t\t\t\t\t\t\t\t// handleDrop(view, event, slice, moved) {\n\t\t\t\t\t\t\t\t\t\t\t\t// slice = unwrapContentFromTableCellsIfSelectionIsInTable(slice, view.state);\n\t\t\t\t\t\t\t\t\t\t\t\t// ....\n\t\t\t\t\t\t\t\t\t\t\t\t// // work out where the dropPos is and whether to\n\t\t\t\t\t\t\t\t\t\t\t\t// // replace or insert slice based off `moved` \n\t\t\t\t\t\t\t\t\t\t\t\t// ....\n\t\t\t\t\t\t\t\t\t\t\t\t// dispatch(state.tr.doSomethingWith(slice));\n\t\t\t\t\t\t\t\t\t\t\t\t// return true;\n\t\t\t\t\t\t\t\t\t\t\t\t// },\n\t\t\t\t\t\t\t\t\t\t\t\t// handlePaste: ?⁠fn(view: EditorView, event: dom.Event, slice: Slice) → bool\n\t\t\t\t\t\t\t\t\t\t\t\t// handlePaste(view, event, slice) {\n\t\t\t\t\t\t\t\t\t\t\t\t// \t// SCHEMA workaround\n\t\t\t\t\t\t\t\t\t\t\t\t// \t// we need convert div to p if doesn't have valid iframe\n\t\t\t\t\t\t\t\t\t\t\t\t// \tconsole.info(\"handlePaste\", view, event, slice);\n\t\t\t\t\t\t\t\t\t\t\t\t// \t//oTrans.setBlockType(oTransactions['setBlockType'][i]+1, oTransactions['setBlockType'][i]+1, oView.state.schema.nodes.heading, {level: 2})\n\t\t\t\t\t\t\t\t\t\t\t\t// \treturn false; // pass // true: block paste\n\t\t\t\t\t\t\t\t\t\t\t\t// },\n\t\t\t\t\t\t\t\t\t\t\t\t// handleDrop: ?⁠fn(view: EditorView, event: dom.Event, slice: Slice, moved: bool) → bool\n\t\t\t\t\t\t\t\t\t\t\t\t// Called when something is dropped on the editor. moved will be true if this drop moves from the current selection (which should thus be deleted).\n\n\t\t\t\t\t\t\t\t\t    },\t\t\t    \n\t\t\t\t\t\t\t\t\t    \n\t\t\t\t\t\t\t\t\t    /**\n\t\t\t\t\t\t\t\t\t     * Plugin Spec View \n\t\t\t\t\t\t\t\t\t     * When the plugin needs to interact with the editor view, or set something up in the DOM, use this field. The function will be called when the plugin's state is associated with an editor view.\n\t\t\t\t\t\t\t\t\t     * Docs: // https://prosemirror.net/docs/ref/#state.PluginSpec.view\n\t\t\t\t\t\t\t\t\t     * @param  {Object} EditorView \tEditorView - An editor view manages the DOM structure that represents an editable document. Its state and behavior are determined by its props\n\t\t\t\t\t\t\t\t\t     * @return {Object}       \t\tShould return an object with the following optional properties: update: ?⁠fn(view: EditorView, prevState: EditorState), destroy: ?⁠fn() - docs: https://prosemirror.net/docs/ref/#state.PluginSpec.view^returns\n\t\t\t\t\t\t\t\t\t     */\n\t\t\t\t\t\t\t            view(EditorView) {\n\t\t\t\t\t\t\t            \t\t\t\t// Pass Editor View to pluginCore class. It will remain the same unless we inject other view to core.\n\t\t\t\t\t\t\t            \t\t\t\t\tpluginCore.view = EditorView;\n\t\t\t\t\t\t\t            \t\t\t\t// Set the Editor View DOM to pluginCore class - NOT NEEDED\n\t\t\t\t\t\t\t            \t\t\t\t\t// pluginCore.aDomEdit = EditorView.dom;\n\t\t\t\t\t\t\t            \t\t\t\t// Return Plugin View Class\n\t\t\t\t\t\t\t                            \treturn new pluginViewClass(EditorView, pluginCore) \n\t\t\t\t\t\t\t            }\t            \n\t\t\t\t\t\t\t            \n\n\t\t\t\t\t\t\t            // Other methods for the plugin - https://prosemirror.net/docs/ref/#state.Plugin\n\t\t\t\t\t\t\t\t            /*\n\t\t\t\t\t\t\t\t\t            spec: Object -> void (The plugin's spec object)\n\t\t\t\t\t\t\t\t\t\t\t\tgetState(state: EditorState) → any (Extract the plugin's state field from an editor state)\n\t\t\t\t\t\t\t\t            */\n\t\t\t\t\t\t\t            \n\t\t\t\t\t\t\t            /**\n\t\t\t\t\t\t\t             * Pluging Spec Custom methods\n\t\t\t\t\t\t\t             * Custom method extending plugin so we can reach Core methods\n\t\t\t\t\t\t\t             * This is approach is not per documentation so we might want to refactor or remove these methods\n\t\t\t\t\t\t\t             */\n\t\t\t\t\t\t\t            \n\t\t\t\t\t\t\t\t            /**\n\t\t\t\t\t\t\t\t             * Open Link Edit dialog\n\t\t\t\t\t\t\t\t             * External call to plugin core from:\n\t\t\t\t\t\t\t\t             * \t\t1. menu.js::linkItem \n\t\t\t\t\t\t\t\t             * \t\t2. keymap.js:399\n\t\t\t\t\t\t\t\t             * Command puts state, fnDispatch, view, domEvent but not all are passed here (lib: prosemirror-menu - https://github.com/prosemirror/prosemirror-menu)\n\t\t\t\t\t\t\t\t             * @param  {Class} \tstate    \tEditorState\n\t\t\t\t\t\t\t\t             * @param  {Class} \tdispatch \tTransaction\n\t\t\t\t\t\t\t\t             * @param  {Class} \tview     \tEditorView\n\t\t\t\t\t\t\t\t             * @param  {Event} \tdomEvent \tEvent that triggered the command\n\t\t\t\t\t\t\t\t             * @return {Boolean} \t        Command success\n\t\t\t\t\t\t\t\t             */\n\t\t\t\t\t\t\t\t            ,openDialog(state, dispatch, view, domEvent) {\n\t\t\t\t\t\t\t\t            \tpluginCore._mCloseTooltip();\n\t\t\t\t\t\t\t\t\t\t\t\tpluginCore._mCloseDialog(true); //set link\n\t\t\t\t\t\t\t\t            \tpluginCore.mShowDialog(state, dispatch, view);\t\t            \t\n\t\t\t\t\t\t\t\t            \treturn true;\n\t\t\t\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t\t            /**\n\t\t\t\t\t\t\t\t             * Remove Link \n\t\t\t\t\t\t\t\t             * External call to plugin core from:\n\t\t\t\t\t\t\t\t             * \t\t1. menu.js::linkItem \n\t\t\t\t\t\t\t\t             * Command puts state, fnDispatch, view, domEvent but not all are passed here (lib: prosemirror-menu - https://github.com/prosemirror/prosemirror-menu)\n\t\t\t\t\t\t\t\t             * @param  {Class} \tstate    \tEditorState\n\t\t\t\t\t\t\t\t             * @param  {Class} \tdispatch \tTransaction\n\t\t\t\t\t\t\t\t             * @param  {Class} \tview     \tEditorView\n\t\t\t\t\t\t\t\t             * @param  {Event} \tdomEvent \tEvent that triggered the command\n\t\t\t\t\t\t\t\t             * @return {Boolean} \t        Command success\n\t\t\t\t\t\t\t\t             */\n\t\t\t\t\t\t\t\t            ,removeLink(state, dispatch, view, domEvent) {\n\t\t\t\t\t\t\t\t            \tpluginCore._mCloseTooltip();\n\t\t\t\t\t\t\t\t\t\t\t\tpluginCore._mCloseDialog(true);\n\t\t\t\t\t\t\t\t\t\t\t\tpluginCore.mUnlink(state, dispatch, view);\n\t\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t            }\n\t\t\t\t\t\t\t\t            /**\n\t\t\t\t\t\t\t\t             * Find Image Placeholder decoration (to by replaced with the uploaded image)\n\t\t\t\t\t\t\t\t             * External call to plugin core uploader callback:\n\t\t\t\t\t\t\t\t             * @param  {class} \tstate \tEditor State\n\t\t\t\t\t\t\t\t             * @param  {object}\tid    \tDecoration ID\n\t\t\t\t\t\t\t\t             * @param  {object} scope \tScope to lookup decoration (this pluginClass)\n\t\t\t\t\t\t\t\t             * @return {Integer|Null}   Decoration positon or null if not found\n\t\t\t\t\t\t\t\t             */\n\t\t\t\t\t\t\t\t            ,imagePlaceholder(state, id, scope) {\n\t\t\t\t\t\t\t\t\t\t\t  let decos = scope.getState(state)\n\t\t\t\t\t\t\t\t\t\t\t  let found = decos.find(null, null, spec => spec.id == id)\n\t\t\t\t\t\t\t\t\t\t\t  return found.length ? found[0].from : null\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t          \t}\n\t  \t\t\t\t\t\t\t)\n\n\t/**\n\t * Return Plugin\n\t */\n\treturn pluginClass\n                \n}\n\n\n// ***********************************************\n// ************** Plugin View Class **************\n// ***********************************************\n \n/**\n * Plugin Spec View Class\n * When the plugin needs to interact with the editor view, or set something up in the DOM, use this class. The function will be called when the plugin's state is associated with an editor view.\n * Docs: https://prosemirror.net/docs/ref/#state.PluginSpec.view\n * @return {Object}       Object with constructor and the following optional properties: update: ?⁠fn(view: EditorView, prevState: EditorState), destroy: ?⁠fn() - docs: https://prosemirror.net/docs/ref/#state.PluginSpec.view^returns\n */\nclass pluginViewClass\n{\n\t\t\n\t/**\n\t * Construct Extension Plugin view object\n\t * @param  {class} view Editor View\n\t * @param  {class} core Plugin Core class\n\t * @return {void}      \tSetup object represeting plugin view\n\t */\n\tconstructor(view, core) {\n\n\t\t// Variables to use while handling object methods interacting with editor view (update, destroy)\n\t\t\tthis.view = view;\n\t\t\tthis.core = core;\n\t\t\n\t\t// Add resize listener to window so we can handle resize directly in plugin core class\n\t\t\twindow.addEventListener('resize', this.core.fnWindwoResize.bind(this.core));\n\t\t\n\t\t// Focus view on load\n\t\t\n\t\t\t// This is still broken on iOS because Apple really doesn’t want you to focus input fields that the user hasn’t tapped on.\n\t\t\t// if (!this.core.isIOS()) {\n\t\t\t\t// This doesn't feel right\n\t\t\t\t//this.core.focus(\"start\");\n\t\t\t// }\n\t\t\t\n\t\t// Fix view on load\n\t\t\t\n\t\t\t// Eval fixes and decorations\n\t\t\tlet tr_updates = this.core.getViewUpdates(this.view.state);\t\n\t\t\t// Dispatch transaction if any corrections have been detected\n\t\t    if (tr_updates.constructor === Object && Object.keys(tr_updates).length !== 0) {\t\t    \t\n\t\t    \tlet transaction_ = this.core.appendTransactions(this.view.state, tr_updates, this.view.state.tr);\n\t\t\t\tthis.view.dispatch(transaction_);\n\t\t    }\n\n\t}\n\t\n\t/**\n\t * Called whenever the view's state is updated. For plugin it meands on every cursor interaction with Editor View\n\t * Docs: https://prosemirror.net/docs/ref/#state.PluginSpec.view^returns.update\n\t * @param  {Class} view      \tEditor Views\n\t * @param  {Class} lastState \tEditor State before\n\t * @return {Void}           \tExec changes\n\t */\n\tupdate(view,prevState) {\n\n\t\t\t// Close dialogs\n\t\t\t\tthis.core._mCloseTooltip();\n\t\t\t\tthis.core._mCloseDialog(true);\n\n\t\t\t// Close menu\n\t\t\t\tif (!this.view.state.selection.empty && typeof this.view.state.selection.node != \"undefined\" && (this.view.state.selection.node.type.name == \"image\" || this.view.state.selection.node.type.name == \"div\" || this.view.state.selection.node.type.name == \"svg\")  ) { \n\t\t\t\t\t// We can show custom node menu here in future. For now just close menu.\n\t\t\t\t\tthis.core.closeMenu();\n\t\t\t\t} else if (!this.view.state.selection.empty) {\n\t\t\t\t\t// Show Menu\n\t\t\t\t\tthis.core.showMenu(this.view);\n\t\t\t\t} else {\n\t\t\t\t\t// Close Menu\n\t\t\t\t\tthis.core.closeMenu();\n\t\t\t\t}\n\n\t\t\t// Done\n\t\t\t\treturn false;\n\n\t}\n\n\t/**\n\t * Called when the view is destroyed or receives a state with different plugins.\n\t * Docs: https://prosemirror.net/docs/ref/#state.PluginSpec.view^returns.destroy\n\t */\n\tdestroy()\n\t{\n\t\t// Garbage Collector\t\t\n\n\t\t\t// Get pluging by name (only way to access the plugin from this method)\n\t\t\t\tlet pluginByKey = this.view.state.config.pluginsByKey[\"extension$\"];\n\t\t\t\n\t\t\t// Do not build decorations anymore\n\t\t\t\tpluginByKey.props.decorations = function() { return null; }\t\t\t\t\n\n\t\t\t// Cancel uploads\n\t\t\t\t// Find upload placeholders \n\t\t\t\tlet decos =  pluginByKey.getState(this.view.state);\n\t\t\t\tlet uploads = decos.find(null, null, spec => spec.name == \"imageUpload\");\n\t\t\t\tif (uploads.length) {\n\t\t\t\t\t// Loop all placeholders\n\t\t\t\t\tfor (var i = uploads.length - 1; i >= 0; i--) {\t\t\t\t\n\t\t\t\t\t\t// Cancel upload by id\n\t\t\t\t\t\tthis.core.uploader(null, null, uploads[i].spec.id);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t// Close tooltips\n\t\t\t\tthis.core._mCloseTooltip()\n\t\t\t\tthis.core._mCloseDialog(true)\n\n\t\t\t// Null core view\n\t\t\t\tthis.core.view = null;\n\n\t\t\t// Remove window listeners\n\t\t\t\twindow.removeEventListener('resize',this.core.fnWindwoResize);\n\t\t\n\t}\n\n\t\n}\t\n\n\n// ***********************************************\n// ************* Plugin Core Class ***************\n// ***********************************************\n\n/**\n * Providing core functionality for extentsion plugin\n */\nclass pluginCoreClass\n{\n\t/**\n\t * Construct Class\n\t * @param  {class} \tscheme \t\t\tDocument schema\n\t * @param  {class} \tmenuPlugin\t\tPlugin handling editor menu\n\t * @param  {class} \tuploaderClass  \tExternall Class responsible for handling upload\n\t * @return {void}            \t\tPlugin Core Class\n\t */\n\tconstructor(schema, menuPlugin, uploaderClass) {\n\t\t\n\t\t// Variables to use within this class\n\t\t\t// this.aDomEdit = null; // Not needed. The editor dom is set from the view init plugin\n\t\t\tthis.view = null;\t// set in plugin view method\n\t\t\tthis.menuBar = menuPlugin.spec.getMenu();\n\t\t\tthis.uploader = uploaderClass;\n\t\t\t\n\t\t// Selection to work with while setting links\n\t\t\tthis.selection = null;\n\t\t\n\t\t// Dialog and Tooltip Style Classes\n\t\t\tthis.linkClassBottom = \"simpleeditor-tooltip-bottom\"\n\t\t    this.linkClassTop = \"simpleeditor-tooltip-top\"\n\n\t\t// Link menu\n\t\t\tthis.linkDialog = false;\n\t\t\tthis.initLinkDialog();\n\t\t\tthis.fnLinkDialogEvent = {};\n\t\t\n\t\t// Link tooltip DOM and vars\n\t\t\tthis.linkTooltip = document.createElement(\"div\")\n\t\t    this.linkTooltip.className = this.linkClassTop;\n\t\t    this.linkTooltipOpen = null;\n\t\t    this.linkTooltipTimer = null\n\t\t    this.fnLinkTooltipEventClick = {};\n\t\t\tthis.fnLinkTooltipEventOver = {};\n\t\t\tthis.fnLinkTooltipEventOut = {};\n\t\t\tthis.fnLinkTooltipOpenEventOut = {};\n\n\t}\n\n\t// ============================================\n\t// HELPERS\n\t// ============================================\n\t\n\t\t/**\n\t\t * Handle Window resize\n\t\t * @param  {Event} \te \tWindow resize event\n\t\t * @return {void}   \tHandle\n\t\t */\n\t\tfnWindwoResize(e) {\n\t\t\tthis._mCloseDialog(true); //set link\n\t\t\tthis.closeMenu();\n\t\t}\n\n\t\t/**\n\t\t * Determine if device is iOS - we should probably change this to is mobile since we need this only to determin menu UI for small touch screens.\n\t\t * @return {Boolean} Is/Isn't iOS\n\t\t */\n\t\tisIOS() {\n\t\t  if (typeof navigator == \"undefined\") return false\n\t\t  let agent = navigator.userAgent\n\t\t  return !/Edge\\/\\d/.test(agent) && /AppleWebKit/.test(agent) && /Mobile\\/\\w+/.test(agent)\n\t\t}\n\n\t\t/**\n\t\t * NOT USED. Find if element is in Editor DOM. For event target and releatedTarget we can use event.composedPath or event.path but those are not cross-browser supported.\n\t\t * @param  {Element} element DOM to check\n\t\t * @return {Boolean}         Is is editor\n\t\t */\n\t\t// inEditor(element) {\n\t\t//   while ((element = element.parentElement) && (this.view.dom !== element));\n\t\t//   return (element === this.view.dom);\n\t\t// }\n\n\t// ============================================\n\t// MENU Methods\n\t// ============================================\n\t\n\t\t/**\n\t\t * Display and position menu bar\n\t\t * @param  {class} view  \tEditor View\n\t\t * @return {view}      \t\tHandle request\n\t\t */\n\t\tshowMenu(view) {\n\t\t\t\n\t\t\t// Do we have any pending menu items available?\n\t\t\tif (this.menuBar.something) {\n\t\t\t\t// Yes, there are some available menu items\n\t\t\t\t\n\t\t\t\t\t// Set position\t\t\t\t\n\t\t\t\t\tif (this.isIOS()) {\n\t\t\t\t\t\t// Mobile\n\t\t\t\t\t\t// DODO: [mobile-menu] - This need new design approach. Preffered, fixed bottom position doesn't work because of virtual keyboard.\n\t\t\t\t\t\t\t// Fixed bottom (keyboard is overlapping menu)\n\t\t\t\t\t\t\t\t// this.menuBar.menu.style.position = \"fixed\";\n\t\t\t\t\t\t\t\t// this.menuBar.menu.style.top = \"auto\";\n\t\t\t\t\t\t\t\t// this.menuBar.menu.style.bottom = \"0px\";\n\t\t\t\t\t\t\t\t// this.menuBar.menu.style.left = \"50%\";\n\t\t\t\t\t\t\t\t// this.menuBar.menu.style.borderRadius = \"0px\";\n\t\t\t\t\t\t\t\t// this.menuBar.menu.style.textAlign = \"center\";\n\t\t\t\t\t\t\t\t// this.menuBar.menu.style.width = \"100%\";\n\t\t\t\t\t\t\t\t// this.menuBar.menu.style.display = \"\";\n\n\t\t\t\t\t\t\t// Float somewhere near\n\t\t\t\t\t\t\t\tlet hScroll = (window.pageYOffset || document.documentElement.scrollTop)  - (document.documentElement.clientTop || 0)\n\t\t\t\t\t\t\t\tthis.menuBar.menu.style.top = (hScroll+10)+\"px\";\n\t\t\t\t\t\t\t\tthis.menuBar.menu.style.left = \"50%\";\n\t\t\t\t\t\t\t\tthis.menuBar.menu.style.display = \"\";\n\n\t\t\t\t\t\t\t// Other\n\t\t\t\t\t\t\t\t// let menu_ = this.menuBar.menu;\n\t\t\t\t\t\t\t\t// let editor_ = this.menuBar.editor;\n\t\t\t\t\t\t\t\t// editor_.blur();\n\t\t\t\t\t\t\t\t// setTimeout(function(){ \n\t\t\t\t\t\t\t\t// \t// editor_.blur();\n\t\t\t\t\t\t\t\t// \t// menu_.blur();\n\t\t\t\t\t\t\t\t// \tmenu_.firstChild.focus();\n\t\t\t\t\t\t\t\t// \t// menu_.select();\n\t\t\t\t\t\t\t\t// }, 1500);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Desktop\n\t\t\t\t\t\t\tlet state = view.state;\n\t\t\t\t\t\t\tlet selection = state.selection;\n\t\t\t\t\t\t\tif (selection.from == selection.to) {\n\t\t\t\t\t\t\t\t// Link is at the begining\n\t\t\t\t\t\t\t\t// console.warn(\"Link is at the begining ??? what was the purpose of this\");\n\t\t\t\t\t\t\t\tlet selectionFrom = state.selection.$from;\n\t\t\t\t\t\t\t\tselection.from = selectionFrom.pos-selectionFrom.parentOffset;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Show DOM\n\t\t\t\t\t\t\tthis.menuBar.menu.style.display = \"\";\t\n\t\t\t\t\t\t\tthis._mPos(this.menuBar.menu, view, selection, true, true)\t\n\n\t\t\t\t\t}\n\n\t\t\t\t// Update Menu Bar state\n\t\t\t\t\tthis.menuBar.isOpen = true;\n\t\t\t}\n\t\t}\n\t\t\n\t\t/**\n\t\t * Hide and update menu bar state\n\t\t * @return {void} Handle request\n\t\t */\n\t\tcloseMenu() {\n\t\t\t// Hide menu DOM\n\t\t\tthis.menuBar.menu.style.display = \"none\";\n\t\t\t// Update Menu Bar state\n\t\t\tthis.menuBar.isOpen = false;\n\t\t}\n\n\t// ============================================\n\t// DECORATIONS AND VIEW UPDATES\n\t// ============================================\n\t\t\n\t\t/**\n\t\t * Iter over document and collect reuquired changes and/or decorations - KEEP THE LOOP as simple as possible\n\t\t * @param  {class}\t\tstate \t\tEditor State\n\t\t * @param  {integer} \tdiffFrom \tStart position (optional)\n\t\t * @param  {integer} \tdiffTo   \tEnd position (optional)\n\t\t * @return {object}          \t\tCollection of changes\n\t\t */\n\t\tgetViewUpdates(state, diffFrom, diffTo) {\t\t\t\t\n\n\t\t\t\t// Iteration counter (just for development purpose - we want to minimaze/remove iterations)\n\t\t\t\tlet cnt = 0;\n\n\t\t\t\t// Object to records required transactions\n\t\t\t\tconst oTransactions = {};\n\n\t\t\t\t// Selection variables\n\t\t\t\tlet {from, $from, to, empty} = state.selection\n\n\t\t\t\t// Iteration Callback\n\t\t\t\tconst converttitle = (node, pos) => {\n\t\t\t\t\t\n\t\t\t\t\t// Iteration count\n\t\t\t\t\tcnt++;\n\n\t\t\t\t\t// Remove (replace) all invalid H1 (Title) Nodes - we can have only one Title at the top of the document\n\t\t\t\t\t\t\n\t\t\t\t\t\t// EXISTING\n\t\t\t\t\t\t\t// Working in all cases (remove once tested with new schema as described below)\n\t\t\t\t\t\t\tif (pos!=0 && ( node.type.name == \"title\" || (node.type.name == \"heading\" && node.attrs.level==1) ) ) { \n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Convert to block\n\t\t\t\t\t\t\t\t\tif (typeof oTransactions['setBlockType'] == \"undefined\") {\n\t\t\t\t\t\t\t\t\t\toTransactions['setBlockType'] = [];\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\toTransactions['setBlockType'].push(pos);\t\t\t\t\t\t\t\t\t\n\t\t\t    \t\t\t\t\n\t\t\t    \t\t\t\t// Do not traverse child nodes\n\t\t\t    \t\t\t\t\treturn false;\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t// NEW\n\t\t\t\t\t\t\t// By changing schema specs for doc, title, heading we get only partial solution that break on pasted text and larger changes\n\t\t\t\t\t\t\t// DODO [title] Test after upgrading to latest lib\n\t\t\t\t\t\t\t// Might be a general issue. See: https://discuss.prosemirror.net/t/cut-and-paste-does-not-restore-the-document/2166/3\n\n\t\t\t\t\t// Check Nodes \n\n\t\t\t\t\t\t// Check if specific nodes are empty so we can apply placeholder decoration\n\t\t\t\t\t        if (node.type.name == \"figcaption\" || node.type.name == \"title\") { // || node.type.name == \"paragraph\") {\n\n\t\t\t\t\t            if (node.type.isBlock && node.childCount === 0 ) {\n\n\t\t\t\t\t            \t// Empty node\n\n\t\t\t\t\t                    if (typeof oTransactions['setMeta'] == \"undefined\") {\n\t\t\t\t\t\t\t\t\t\t\toTransactions['setMeta'] = [];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\toTransactions['setMeta'].push({key: \"emptyNode\", pos: {from: pos, to: (pos + node.nodeSize)}});\n\t\t\t\t\t            \n\t\t\t\t\t\t\t\t\t// Do not traverse child nodes\n\t\t\t                    \t\treturn false;\n\t\t\t\t\t            }\n\t\t\t\t\t        }\t\t\t\t\t\t\n\n\t\t\t\t\t\t// Check figure\n\t\t\t                if (node.type.name==\"figure\") {\n\t\t\t                \t\n\t\t\t                \t// Check if figcaption changed so we can set alt attribute on images (must be before other figure/figcaption transactions)\n\t\t\t\t                \tif (typeof oTransactions['catptionImgAlt'] == \"undefined\") {\n\t\t\t\t\t\t\t\t\t\toTransactions['catptionImgAlt'] = [];\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t}\t\t\t                \t\n\t\t\t\t                \toTransactions['catptionImgAlt'].push({from:pos,to:pos+node.nodeSize});\n\n\t\t\t                  \t// Remove figure that has only figcaption\n\t\t\t                  \tif (node.childCount!=0 && node.firstChild.type.name == \"figcaption\") {\n\t\t\t      \t\t\t\t\t\n\t\t\t      \t\t\t\t\t// console.warn(\"tr.delete is causing possition issue. we need to keep it here. we should reale do this with schema: \", node.nodeAt(0), {from:pos+1,to:pos+1+node.nodeAt(0).nodeSize});\n\n\t\t\t      \t\t\t\t\t/*\n\t\t\t      \t\t\t\t\t// Delete (is breaking history and failing end the end of the node)\n\t\t\t\t\t\t\t\t\t\tif (typeof oTransactions['delete'] == \"undefined\") {\n\t\t\t\t\t\t\t\t\t\t\toTransactions['delete'] = [];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t// DELTE FIGURE\n\t\t\t\t\t\t\t\t\t\t\t//oTransactions['delete'].push({from:pos,to:pos+node.nodeSize});\n\t\t\t\t\t\t\t\t\t\t// DELETE CAPTION\n\t\t\t\t\t\t\t\t\t\t\toTransactions['delete'].push({from:pos+1,to:pos+1+node.nodeAt(0).nodeSize});\n\n\t\t\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Do not traverse\n\t\t\t                  \t\treturn false;\n\n\t\t\t                  \t// Remove (Replace) empty figure\n\t\t\t                  \t} else if (node.childCount==0) {\t\t\t                  \t\t\n\n\t\t\t\t\t\t\t\t\t// Check if figure has any DOM placeholders (if not we can remove the figure)\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tlet keepFigure = false;\n\t\t\t\t\t\t\t\t\t\tlet linkKey = state.config.pluginsByKey[\"extension$\"];\n\t\t\t\t\t\t\t\t\t\tlet decos =  linkKey.getState(state);\n\t\t\t\t\t\t\t\t\t\tlet placeholders = decos.find(null, null, spec => spec.name == \"figwrap\" ); // console.log(\"this.core.view.state\", decos, uploads);\n\n\t\t\t\t\t\t\t\t\t\tif (placeholders.length!=0) {\n\t\t\t\t\t\t\t\t\t\t\t// all state decos are related to figure placeholders\n\t\t\t\t\t\t\t\t\t\t\tkeepFigure = true;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif (!keepFigure) { \n\t\t\t\t\t\t\t\t\t\t\t// console.log('remove figure'); // delete is  breaking history and causing errors\n\t\t\t\t\t\t\t\t\t\t\tif (typeof oTransactions['replaceWithParagraph'] == \"undefined\") {\n\t\t\t\t\t\t\t\t\t\t\t\toTransactions['replaceWithParagraph'] = [];\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\toTransactions['replaceWithParagraph'].push({from:pos,to:pos+node.nodeSize});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\n\n\t\t\t                  \t\t// Do not traverse child nodes\n\t\t\t                  \t\t\treturn false;\n\t\t\t                  \t} else {\t                  \t\t\n\t\t\t                  \t\t// Do traverse child nodes\n\t\t\t                  \t\t\treturn true;\n\t\t\t                  \t}\n\t\t\t                } else {\n\t\t\t                \t// Do not traverse child nodes\n\t\t\t                    \treturn false;\n\t\t\t                }\n\t\t\t\t}\n\n\t\t\t\t// Loop document nodes\n\t\t\t\t\tif (typeof diffFrom!==\"undefined\" && typeof diffTo!==\"undefined\") {\n\t\t\t\t\t\t// Range loop\n\t\t\t\t\t\tstate.doc.nodesBetween(diffFrom,diffTo,converttitle);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Full loop\n\t\t\t\t\t\tstate.doc.descendants(converttitle);\n\t\t\t\t\t}\n\n\t\t\t\t// Info (try to minimize the iteration)\n\t\t\t\t\t// console.log(\"=====================\")\n\t\t\t\t\t// console.log(\"\\t=>Iter size\", cnt);\n\t\t\t\t\t// console.log(\"=====================\")\t\t\t\t\t\n\n\t\t\t\t// Return changes to be appended transaction\n\t\t\t\t\treturn oTransactions;\n\n\t\t}\n\t\tappendTransactions(oState,oTransactions,oTrans)\n\t\t{\n\n\t\t\t\t// Replace transactions\n\t\t\t\t\n\t\t\t\t\tfor (var key in oTransactions) {\n\t\t\t\t\t\tswitch (key) {\n\t\t\t\t\t\t\tcase \"setBlockType\":\n\t\t\t\t\t\t\t\tfor (var i = 0; i < oTransactions['setBlockType'].length; i++) {\n\t\t\t\t\t\t\t\t\toTrans.setBlockType(oTransactions['setBlockType'][i]+1, oTransactions['setBlockType'][i]+1, oState.schema.nodes.heading, {level: 2})\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase \"replaceWithParagraph\":\n\t\t\t\t\t\t\t\tlet wrap_p = null;\n\t\t\t\t\t\t\t\tlet wrap_pos = {}\n\t\t\t\t\t\t\t\tfor (var i = 0; i < oTransactions['replaceWithParagraph'].length; i++) {\n\t\t\t\t\t\t\t\t\toTrans.replaceRangeWith(oTransactions['replaceWithParagraph'][i].from, oTransactions['replaceWithParagraph'][i].to, oState.schema.nodes.paragraph.create());\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\n\t\t\t\t// WE NEED TO AVOID DELETE transactions because they are breakin positions. Failed without workaround on paste whole text from https://www.jafholz.cz/produkty/sluzby/nabytkove-dilce. It breaks when we try to remove figcaption.\n\t\t\t\t/*\n\t\t\t\t\n\t\t\t\t\tvar minusPos = 0;\n\t\t\t\t\tif (typeof oTransactions['delete'] != \"undefined\") {\n\n\t\t\t\t\t\t// must be last trans because we are shifting positions\t\t\t\t\t\n\t\t\t\t\t\tfor (var i = 0; i < oTransactions['delete'].length; i++) {\n\n\t\t\t\t\t\t\t// Test if node is there\n\t\t\t\t\t\t\tlet $pos_d = oState.doc.resolve(oTransactions['delete'][i].from-minusPos); //, index = $pos_.index()\n\n\t\t\t\t\t\t\tconsole.warn(\"DELETE: is node still there? \", $pos_d, minusPos);\n\n\t\t\t\t\t\t\t\t// remove empty figure\n\t\t\t\t\t\t\t\toTrans.delete(oTransactions['delete'][i].from-minusPos, oTransactions['delete'][i].to-minusPos)\n\t\t\t\t\t\t\t\t//console.warn(\"rem:\",oTransactions['delete'][i].from, oTransactions['delete'][i].to, minusPos, oState.doc)\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// calc correction\n\t\t\t\t\t\t\t\tminusPos += oTransactions['delete'][i].to-oTransactions['delete'][i].from;\t\t\n\n\t\t      \t\t\t\t\t\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t*/\n\n\t\t\t\t// Update Image Alt from Figcaption\n\t\t\t\t\tif (typeof oTransactions['catptionImgAlt'] != \"undefined\") {\n\t\t\t\t\t\tlet cap_text = \"\";\n\t\t\t\t\t\tlet fig_imgs = [];\n\t\t\t\t\t\tlet img_el = null;\n\t\t\t\t\t\tfor (var i = 0; i < oTransactions['catptionImgAlt'].length; i++) {\n\t\t\t\t\t\t\t// Update caption for affected figure images\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Reset\n\t\t\t\t\t\t\t\tcap_text = \"\";\n\t\t\t\t\t\t\t\tfig_imgs = [];\n\t\t\t\t\t\t\t\timg_el = null;\n\n\t\t\t\t\t\t\t\t// Loop figure nodes\n\t\t\t\t\t\t\t\toState.doc.nodesBetween(oTransactions['catptionImgAlt'][i].from, oTransactions['catptionImgAlt'][i].to, function(oNode, oPos)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tswitch (oNode.type.name) {\n\t\t\t\t\t\t\t\t\t\tcase \"image\":\n\t\t\t\t\t\t\t\t\t\t\t// console.log(oNode);\n\t\t\t\t\t\t\t\t\t\t\tfig_imgs.push({pos:oPos,attrs:oNode.attrs,node:oNode});\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase \"figcaption\":\n\t\t\t\t\t\t\t\t\t\t\tif (String.prototype.trim) {\n\t\t\t\t\t\t\t\t\t\t      cap_text = oNode.textContent.trim();\n\t\t\t\t\t\t\t\t\t\t    } else {\n\t\t\t\t\t\t\t\t\t\t      // Since IE doesn't include non-breaking-space (0xa0) in their \\s\n\t\t\t\t\t\t\t\t\t\t      // character class (as required by section 7.2 of the ECMAScript spec),\n\t\t\t\t\t\t\t\t\t\t      // we explicitly include it in the regexp to enforce consistent\n\t\t\t\t\t\t\t\t\t\t      // cross-browser behavior.\n\t\t\t\t\t\t\t\t\t\t      // NOTE: We don't use String#replace because it might have side effects\n\t\t\t\t\t\t\t\t\t\t      // causing this function to not compile to 0 bytes.\n\t\t\t\t\t\t\t\t\t\t      cap_text =  /^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(oNode.textContent)[1];\n\t\t\t\t\t\t\t\t\t\t    };\n\t\t\t\t\t\t\t\t\t\t    if (cap_text.length==0)\t{\n\t\t\t\t\t\t\t\t\t\t    \tcap_text = null; // should remove alt\n\t\t\t\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase \"figure\":\n\t\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t});\t\n\n\t\t\t\t\t\t\t\t// Update Images\n\t\t\t\t\t\t\t\tif (fig_imgs.length>0) {\n\t\t\t\t\t\t\t\t\tfor (var j = fig_imgs.length - 1; j >= 0; j--) {\n\t\t\t\t\t\t\t\t\t\tif (fig_imgs[j].attrs.alt != cap_text) {\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t// Replacing src will flicker in Safari (Correct approach)\n\t\t\t\t\t\t\t\t\t\t\t\t//oTrans.setNodeMarkup(fig_imgs[j].pos, null, {src: fig_imgs[j].attrs.src, alt: cap_text});\t\t\n\t\t\t\t\t\t\t\t\t\t\t// Change DOM and update Node directly (not-recommended but flicker is an issue)\n\t\t\t\t\t\t\t\t\t\t\t\timg_el = this.view.nodeDOM(fig_imgs[j].pos) || null;\n\t\t\t\t\t\t\t\t\t\t\t\tif (img_el!==null) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (cap_text===null) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfig_imgs[j].node.attrs.alt = cap_text;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\timg_el.removeAttribute('alt');\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfig_imgs[j].node.attrs.alt = img_el.alt = cap_text;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t// Add FigCaption Node\n\t\t\t\t\tif (typeof oTransactions['insertCaption'] != \"undefined\") {\n\t\t\t\t\t\tlet wrap_cap = null;\n\t\t\t\t\t\tlet wrap_pos = null;\n\t\t\t\t\t\tfor (var i = 0; i < oTransactions['insertCaption'].length; i++) {\n\t\t\t\t\t\t\t// Add caption but cursor must be set in subsequesnt dispatch call\n\t\t\t\t\t\t\t\twrap_cap = new Slice(Fragment.from(oState.schema.nodes.figcaption.create()),0,0)\n\t\t\t\t\t\t\t\twrap_pos = oTransactions['insertCaption'][i];\n\t\t\t\t\t\t\t\toTrans.replace(wrap_pos, wrap_pos, wrap_cap);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Add HR Node\n\t\t\t\t\tif (typeof oTransactions['replaceWithHr'] != \"undefined\") {\n\t\t\t\t\t\tlet wrap_hr_pos = null;\n\t\t\t\t\t\tlet wrap_hr_ = null;\n\t\t\t\t\t\tfor (var i = 0; i < oTransactions['replaceWithHr'].length; i++) {\n\t\t\t\t\t\t\t//TEST: not needed to work with position\n\t\t\t\t\t\t\t\t//wrap_hr_pos = oTransactions['replaceWithHr'][i]-minusPos+plusPos;\t\n\t\t\t\t\t\t\t\t//// console.warn(\"replaceWithHr\",wrap_hr_pos, oState.selection)\n\t\t\t\t\t\t\t\t//oTrans.replaceRange(wrap_hr_pos, wrap_hr_pos, oState.schema.nodes.horizontal_rule.create());\n\t\t\t\t\t\t\t//OK: wo/ new p\n\t\t\t\t\t\t\t\t//oTrans.replaceSelectionWith(oState.schema.nodes.horizontal_rule.create());\n\t\t\t\t\t\t\t//NEW wt/ new p\n\t\t\t\t\t\t\t\twrap_hr_ = Fragment.empty;\n\t\t\t\t\t\t\t\twrap_hr_ = wrap_hr_.append(Fragment.from(oState.schema.nodes.horizontal_rule.create()))\n\t\t\t\t\t\t\t\twrap_hr_ = wrap_hr_.append(Fragment.from(oState.schema.nodes.paragraph.create()))\t\t\t\t\t\t \t\n\t\t\t\t\t\t\t \twrap_hr_ = new Slice(wrap_hr_,1,1);\n\t\t\t\t\t\t\t\toTrans.replaceSelection(wrap_hr_);\n\t\t\t\t\t\t\t\toTrans.scrollIntoView();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Add Decorations\n\t\t\t\t\tif (typeof oTransactions['setMeta'] != \"undefined\") {\n\t\t\t\t\t\tconst plugin = oState.config.pluginsByKey[\"extension$\"];\n\t\t\t\t\t\tconst setMeta_decos = oTransactions['setMeta'];\n\t\t\t\t\t\tlet setMeta_object = {}\n\t\t\t\t\t\tfor (var i = setMeta_decos.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\tlet id_ = setMeta_decos[i]['id'] || {};\n\t\t\t\t\t\t\t// in case key is already defined, create key array \n\t\t\t\t\t\t\tif (setMeta_object.hasOwnProperty(setMeta_decos[i]['key'])) {\n\t\t\t\t\t\t\t\tif (Array.isArray(setMeta_object[setMeta_decos[i]['key']])) {\n\t\t\t\t\t\t\t\t\tsetMeta_object[setMeta_decos[i]['key']].push({id_, pos:  setMeta_decos[i]['pos']});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsetMeta_object[setMeta_decos[i]['key']] = [setMeta_object[setMeta_decos[i]['key']],{id_, pos:  setMeta_decos[i]['pos']}];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetMeta_object[setMeta_decos[i]['key']] = {id_, pos:  setMeta_decos[i]['pos']};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// Add to transaction\n\t\t\t\t\t\toTrans.setMeta(plugin, setMeta_object);\n\t\t\t\t\t}\n\n\n\t\t\t\t// Add Text Selection\n\t\t\t\t\tif (typeof oTransactions['textSelection'] != \"undefined\") {\n\n\t\t\t\t\t\tlet newPos = oState.doc.resolve(oTransactions['textSelection']) || null;\n\t\t\t\t\t\tif (newPos!==null) {\n\t\t\t\t\t\t\tlet newSel = new TextSelection.between(newPos,newPos)\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\toTrans.setSelection(newSel);\n\t\t\t\t\t\t\t\toTrans.scrollIntoView();\n\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t//console.error(\"Selection doesn't point to valid position: \",err);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t// Return updated\n\t\t\t\t\treturn oTrans;\n\n\t\t}\n\n\n\t// ============================================\n\t// SET INI (and OTHER) FOCUS to the editor view - PENDING iOS because Apple really doesn’t want you to focus input fields that the user hasn’t tapped on.\n\t// ============================================\n\t\t\n\t\tfocus(position = null) {\n\t\t    if ((this.view.hasFocus() && position === null) || position === false) {\n\t\t      return\n\t\t    }\n\n\t\t    const { from, to } = this.resolveSelection(position)\t\t    \n\n\t\t    this.setSelection(from, to)\n\t\t    setTimeout(() => this.view.focus(), 0)\n\t\t}\n\t\tresolveSelection(position = null) {\n\t\t    \n\t\t\tconst selection = {\n\t\t      from: this.view.state.selection.from,\n\t\t      to: this.view.state.selection.to,\n\t\t    }\n\t\t    \n\t\t    if (selection && position === null) {\n\t\t      return selection\n\t\t    }\n\n\t\t    // Change this to find 1st text focusable node\n\t\t    if (position === 'start' || position === true) {\n\t\t    \t// Find 1st text focusable node\n\t\t    \t\t//console.warn(\"start - iter over doc to find first text focusable node position\", this.view.state.doc.firstChild);\n\t\t    \t\treturn {\n\t\t\t\t\t\tfrom: 1,\n\t\t\t\t\t\tto: 1,\n\t\t\t\t\t}\n\t\t    \t// Return position\n\t\t\t\t\t// return {\n\t\t\t\t\t// \tfrom: 0,\n\t\t\t\t\t// \tto: 0,\n\t\t\t\t\t// }\n\t\t    }\n\n\t\t    // Change this to find last text focusable node\n\t\t    if (position === 'end') {\n\t\t      \t// Get doc\n\t\t      \t\tconst { doc } = this.view.state\t\t     \n\t\t      \t// Find last text focusable node\n\t\t    \t\t// console.warn(\"end - iter over doc to find last text focusable node position\", this.view.state.doc.firstChild);\n\t\t    \t// Return position\n\t\t\t\treturn {\n\t\t\t\t\tfrom: doc.content.size,\n\t\t\t\t\tto: doc.content.size,\n\t\t\t\t}\n\t\t    }\n\n\t\t    return {\n\t\t      from: position,\n\t\t      to: position,\n\t\t    }\n\t\t \n\t\t}\n\t\tminMax(value = 0, min = 0, max = 0) {\n\t\t  return Math.min(Math.max(parseInt(value, 10), min), max)\n\t\t}\n\t\tsetSelection(from = 0, to = 0) {\n\t\t    const { doc, tr } = this.view.state;\n\t\t    const resolvedFrom = this.minMax(from, 0, doc.content.size)\n\t\t    const resolvedEnd = this.minMax(to, 0, doc.content.size)\n\t\t    const selection = TextSelection.create(doc, resolvedFrom, resolvedEnd)\n\t\t    const transaction = tr.setSelection(selection)\n\n\t\t    this.view.dispatch(transaction)\t\t    \n\t\t}\n\n\t// ============================================\n\t// BLOCK MENU HANDLER\n\t// ============================================\n\t\t\n\t\tfnCallback_blockMenu(type,arg,e) {\t\t\t\t                  \t\t\t\t\n\t\t\t// Stop event so we don't break range and focus \n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t// Remove all blockMenu listeners\n\t\t\t\t// Remove caller listener\n\t\t\t\t\t//e.target.removeEventListener('mousedown',this.fnCallback_blockMenu,type,arg);\n\t\t\t\t// Remove All block menu buttons' listeners to prevent memory leaks\n\t\t\t\t\tlet el_ = e.currentTarget.parentNode;\n\t\t\t\t\tlet el_child_ = null;\n\t\t\t\t\tfor (var i = el_.childNodes.length - 1; i >= 0; i--) {\n\t\t\t\t\t \tel_child_ = el_.childNodes[i];\n\t\t\t\t\t \tif (el_child_.tagName == \"BUTTON\") {\n\t\t\t\t\t \t\tel_child_.removeEventListener('mousedown',this.fnCallback_blockMenu);\n\t\t\t\t\t \t}\n\t\t\t\t\t };\n\n\t\t\t// Create transaction\n\t\t\t\tlet transaction_ = {};\n\t\t\t\tswitch (type) { \n\t\t\t\t\tcase \"replaceWithVideoDecoration\":\n\t\t\t\t\t// Add video source decorations\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\ttransaction_ = this.appendTransactions(this.view.state, {\"setMeta\":[{key: \"videoSource\", pos: arg}]}, this.view.state.tr);\n\t\t\t\t\t\tthis.view.dispatch(transaction_);\n\t\t\t\t\tbreak;\n  \t\t\t\tcase \"replaceWithHr\":\n      \t\t\t\t// Create and dispatch transaction\n      \t\t\t\t\ttransaction_ = this.appendTransactions(this.view.state, {\"replaceWithHr\":[arg]}, this.view.state.tr);\n      \t\t\t\t\tthis.view.dispatch(transaction_);\t\t\t\t\t\t\t\t\t\t\t\t\t                  \t\t\t\t\t\n  \t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t// Done (not needed becauase we are preventing default browser behavior anyway) \n\t\t\t\treturn true;\n\t\t} \n\n\n\t// ============================================\n\t// FIGCAPTION DECORATIN HANDLER\n\t// ============================================\n\t\t\n\t\tfnCallback_figureCaption(arg,e) {\t\n\n\t\t\t// Stop event so we don't break range and focus \n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t// Remove all blockMenu listeners\n\t\t\t\te.target.removeEventListener('mousedown',this.fnCallback_figureCaption,arg);\n\t\t\t// Create transactions\n\t\t\t\t// Add Figcaption Node\n\t\t\t\t\tlet transaction_ = this.appendTransactions(this.view.state, {\"insertCaption\":[arg]}, this.view.state.tr);\n\t\t\t\t\tthis.view.dispatch(transaction_);\n\t\t\t\t// Add text selection to new Node\n\t\t\t\t\tlet transaction__ = this.appendTransactions(this.view.state, {\"textSelection\": arg}, this.view.state.tr);\n\t\t\t\t\tthis.view.dispatch(transaction__);\n\t\t\t// Done (not needed becauase we are preventing default browser behavior anyway) \n\t\t\t\treturn true;\n\t\t}\n\n\t// ============================================\n\t// IMAGE HANDLER\n\t// ============================================\n\n\n\t\timagePreview(file) \n\t\t{\n\t\t\t\n\t\t  var reader = new FileReader;\n\t\t  return new Promise(function (accept, fail) {\n\t\t    reader.onload = function () { \n\t\t    \n\t\t    \t// Helpers\n\t\t\t    \tfunction _getOrientation(imageData) {\n\t\t\t    \t\t// https://jsfiddle.net/wunderbart/dtwkfjpg/\n\t\t\t\t\t\t// find orientation\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t//var view = new DataView(base64ToArrayBuffer(imageData));\n\t\t\t\t\t\t\tvar view = new DataView(imageData);\n\n\t\t\t\t\t\t    if (view.getUint16(0, false) != 0xFFD8) return (-2);\n\n\t\t\t\t\t\t    var length = view.byteLength,\n\t\t\t\t\t\t        offset = 2;\n\n\t\t\t\t\t\t    while (offset < length) {\n\t\t\t\t\t\t      var marker = view.getUint16(offset, false);\n\t\t\t\t\t\t      offset += 2;\n\n\t\t\t\t\t\t      if (marker == 0xFFE1) {\n\t\t\t\t\t\t        if (view.getUint32(offset += 2, false) != 0x45786966) {\n\t\t\t\t\t\t          return (-1);\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t        var little = view.getUint16(offset += 6, false) == 0x4949;\n\t\t\t\t\t\t        offset += view.getUint32(offset + 4, little);\n\t\t\t\t\t\t        var tags = view.getUint16(offset, little);\n\t\t\t\t\t\t        offset += 2;\n\n\t\t\t\t\t\t        for (var i = 0; i < tags; i++)\n\t\t\t\t\t\t          if (view.getUint16(offset + (i * 12), little) == 0x0112)\n\t\t\t\t\t\t            return (view.getUint16(offset + (i * 12) + 8, little));\n\t\t\t\t\t\t      }\n\t\t\t\t\t\t      else if ((marker & 0xFF00) != 0xFF00) break;\n\t\t\t\t\t\t      else offset += view.getUint16(offset, false);\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    return (-1);\n\t\t\t\t\t\t} catch(err){\n\t\t\t\t\t\t\treturn (-1);\n\t\t\t\t\t\t}\t\t\t\t    \t\n\t\t\t\t\t}\n\t\t\t\t\t//\n\t\t\t\t\tfunction _arrayBufferToBase64( buffer ) {\n\t\t\t\t\t  var binary = ''\n\t\t\t\t\t  var bytes = new Uint8Array( buffer )\n\t\t\t\t\t  var len = bytes.byteLength;\n\t\t\t\t\t  //console.error(\"len\",len);\n\t\t\t\t\t  for (var i = 0; i < len; i++) {\n\t\t\t\t\t    binary += String.fromCharCode( bytes[ i ] )\n\t\t\t\t\t  }\n\t\t\t\t\t  return window.btoa( binary );\n\t\t\t\t\t}\n\t\t\t\t\t//\n\t\t\t\t\t/*\n\t\t\t\t\tfunction _arrayBufferToBase64( buffer ) {\n\t\t\t\t\t  var binary = ''\n\t\t\t\t\t  var bytes = new Uint8Array( buffer )\n\t\t\t\t\t  var len = bytes.byteLength;\n\t\t\t\t\t  for (var i = 0; i < len; i++) {\n\t\t\t\t\t    binary += String.fromCharCode( bytes[ i ] )\n\t\t\t\t\t  }\n\t\t\t\t\t  return window.btoa( binary );\n\t\t\t\t\t}\n\t\t\t\t\tfunction getOrient(imageData) {\n\t\t\t\t\t\tvar base64img = \"data:\" + file.type + \";base64,\" + _arrayBufferToBase64(imageData);\n\t\t\t\t        var scanner = new DataView(imageData);\n\t\t\t\t        var idx = 0;\n\t\t\t\t        var value = 1; // Non-rotated is the default\n\t\t\t\t        if (imageData.length < 2 || scanner.getUint16(idx) != 0xFFD8) {\n\t\t\t\t            // Not a JPEG\n\t\t\t\t            return [base64img, value];\n\t\t\t\t        }\n\t\t\t\t        idx += 2;\n\t\t\t\t        var maxBytes = scanner.byteLength;\n\t\t\t\t        var littleEndian = false;\n\t\t\t\t        while (idx < maxBytes - 2) {\n\t\t\t\t            var uint16 = scanner.getUint16(idx, littleEndian);\n\t\t\t\t            idx += 2;\n\t\t\t\t            switch (uint16) {\n\t\t\t\t                case 0xFFE1: // Start of EXIF\n\t\t\t\t                    var endianNess = scanner.getUint16(idx + 8);\n\t\t\t\t                    // II (0x4949) Indicates Intel format - Little Endian\n\t\t\t\t                    // MM (0x4D4D) Indicates Motorola format - Big Endian\n\t\t\t\t                    if (endianNess === 0x4949) {\n\t\t\t\t                        littleEndian = true;\n\t\t\t\t                    }\n\t\t\t\t                    var exifLength = scanner.getUint16(idx, littleEndian);\n\t\t\t\t                    maxBytes = exifLength - idx;\n\t\t\t\t                    idx += 2;\n\t\t\t\t                    break;\n\t\t\t\t                case 0x0112: // Orientation tag\n\t\t\t\t                    // Read the value, its 6 bytes further out\n\t\t\t\t                    // See page 102 at the following URL\n\t\t\t\t                    // http://www.kodak.com/global/plugins/acrobat/en/service/digCam/exifStandard2.pdf\n\t\t\t\t                    value = scanner.getUint16(idx + 6, littleEndian);\n\t\t\t\t                    maxBytes = 0; // Stop scanning\n\t\t\t\t                    break;\n\t\t\t\t            }\n\t\t\t\t        }\n\t\t\t\t        return [base64img, value];\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\n\t\t\t\t// Get Orientation\n\t\t\t\t\tvar image_data = _getOrientation(reader.result); //getOrient(reader.result);  // img: 1 8 3 6; img-mirror: 2 7 4 5\n\n\t\t    \t// Return dimmensions\n\t\t\t    \t\n\t\t\t    \tvar image_sz = new Image();\n\t\t\t\t    image_sz.src = \"data:\" + file.type + \";base64,\" + _arrayBufferToBase64(reader.result); //_arrayBufferToBase64(reader.result); //image_data[0]; //reader.result;\n\t\t\t\t    image_sz.onload = function() {\n\t\t\t\t    \tif ('naturalHeight' in this) {\n\t\t\t\t            if (this.naturalHeight + this.naturalWidth === 0) {\n\t\t\t\t                this.onerror();\n\t\t\t\t                return;\n\t\t\t\t            }\n\t\t\t\t        } else if (this.width + this.height == 0) {\n\t\t\t\t            this.onerror();\n\t\t\t\t            return;\n\t\t\t\t        }\n\t\t\t\t        // access image size here \n\t\t\t\t        //console.log(\"WIDTH x HEIGHT; Orientation\", this.width, this.height, image_data);\n\t\t\t\t        var dim = [this.width, this.height, image_data];\n\t\t\t\t        image_sz = null;\t\n\n\t\t\t\t        return accept( dim );\n\t\t\t\t    };\n\t\t\t\t    image_sz.onerror = function() {\n\t\t\t\t        //display error\n\t\t\t\t        return accept( null );\n\t\t\t\t    };\n\t\t\t\t    \n\t\t\t\t// Return source\n\t\t    \t\t// return accept(reader.result);\n\t\t    \t\t// return accept(image_data[0]);\n\n\t\t    };\n\t\t    reader.onerror = function () { return fail(reader.error); };\n\t\t\t//return reader.readAsDataURL(file.slice(0, 64 * 1024)); \n\t\t\treturn reader.readAsArrayBuffer(file.slice(0, 64 * 1024)); // array buffer to get the orientation \n\t\t  })\n\t\t}\n\n\t\tfnCallback_upload(pos, action, data) \n\t\t{\n\n\t\t\t// Has View\n\t\t\t\tif (this.view==null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\n\t\t\t// Vars\n\t\t\t\tlet decos = [];\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Array of decorations to be found\n\t          \tlet oView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t          \tlet oTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t          \tlet oPos =  pos.from+1;  \t\t\t\t\t\t\t\t\t\t\t\t// Start position of the node widget is in (= oTrans.selection.from; for the 1st call)\n\t          \tlet oPosSel = pos.to; \t\t\t\t\t\t\t\t\t\t\t\t\t// End position of the node widget is in\n\t          \tlet linkKey = this.view.state.config.pluginsByKey[\"extension$\"];\t\t// This pluging            \t\t\n              \tlet id = {};\t\t\t\t\t\t\t\t \t\t\t\t\t\t\t// ID for this upload\n              \tlet wrap_img = null;\t\t\t\t\t\t\t\t\t\t\t\t\t// Fragment var we will use to build wrapper (figure+p)\n\n              \t// console.warn(\"pos (i.e. if sel is 100 we need 99,101)\", action, oTrans.selection.from, pos)\n              \t\n            // Select action\n\t\t\t\tswitch (action) {\n\t\t\t\t\tcase \"open\":\n\t\t\t\t\t\tid = \"figwrap_\"+data;\n\t\t\t\t\t\t// Build wrapper\n\t\t\t\t\t\twrap_img = Fragment.empty;\t\t\t\t\n\t\t\t\t\t\twrap_img = wrap_img.append(Fragment.from(oView.state.schema.nodes.figure.createAndFill()))\n\t\t\t\t\t\twrap_img = wrap_img.append(Fragment.from(oView.state.schema.nodes.paragraph.createAndFill()))\n\t\t\t\t\t\twrap_img = new Slice(wrap_img,0,0)\t\t\t\t\t\t\n\t\t\t\t\t\t// Correct 1st pos - SOMETIMES pos is offset by 1 (insert hr and than img). i.e. if sel is 100 we need 99,101\n\t\t\t\t\t\tpos.from = oTrans.selection.from-1;\n\t\t\t\t\t\tpos.to = oTrans.selection.from+1;\n\t\t\t\t\t\t// Add wrapper to transactions\n\t\t\t\t\t\tif (this.view==null) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\t\t\t\t\t\t\n\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t// View transactions\n\t          \t\t\toTrans.setMeta(linkKey, {open: {id, pos: pos}}) // to keep empty figure\n\t\t\t\t\t\toTrans.replaceRange(pos.from, pos.to, wrap_img); //oTrans.replaceSelection(wrap_img) doesn't work if hr is before widget node\n\t\t\t\t\t\t// Dispatch transcations\n\t\t\t\t\t\t\t// ORIG\n\t\t\t\t\t\t\t\t// oView.dispatch(oTrans);\n\t\t\t\t\t\t\t// NEW - go to new paragraph now\n\t\t\t\t\t\t\t\toView.dispatch(oTrans);\n\t\t\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t\t          \t\t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t\t\t\t\t\t\t\toTrans.setSelection(oView.state.selection.constructor.near(oView.state.tr.doc.resolve(oPosSel)));\n\t\t\t\t\t\t\t\toTrans.scrollIntoView();\n\t\t\t\t\t\t\t\toView.dispatch(oTrans);\n\t\t\t\t\t\t\t\toView.focus()\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"add\":\n\t\t\t\t\t\t// console.log(\"add\")\t\t\t\t\t\t\n\t\t\t\t\t\t// Add remove reference to id\n\t\t\t\t\t\tid.uploader = data.uploader;\n\t\t\t\t\t\tid.fileid = data.fileid;\n\t\t\t\t\t\t// Add decoration to transactions\n\t\t\t\t\t\tif (this.view==null) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\t\t\t\t\t\n\t\t\t\t\t\toTrans.setMeta(linkKey, {add: {id: id, pos: oPos}})\n\t\t\t\t\t\t// Dispatch \n\t\t\t\t\t\toView.dispatch(oTrans);\n\n\n\t\t\t\t\t\t// Preview, Dimensions\n\t\t\t\t\t\tthis.imagePreview(data.file).then(function (dim_) {\n\t\t\t\t\t\t\t//console.warn(\"READ OK\", this.view)\n\t\t\t\t\t\t\tif (this.view==null) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\n\t\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t\t\t\t\t\t\t// On Reader success\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar ppos = linkKey.spec.imagePlaceholder(oView.state, id, linkKey);\n\t\t\t                // If the content around the placeholder has been deleted, drop the image\n\t\t\t                if (ppos == null) { return }\t\n\t\t\t               \t// Add preview to transaction\t\t\t               \t\n\t\t\t                oTrans.setMeta(linkKey, {preview: {id: id, dim: dim_, src: URL.createObjectURL(data.file) }} )\n\t\t\t                \t// OLD\n\t\t\t                \t\t// oTrans.setSelection(oView.state.selection.constructor.near(oView.state.tr.doc.resolve(oPosSel))) // must re-focus at p after this async transaction\n\t\t\t                \t// NEW:\n\t\t\t                \t\toTrans.setSelection(oView.state.selection.constructor.near(oView.state.tr.doc.resolve(oPosSel))) // must re-focus at p after this async transaction\n\t\t\t                \t\toTrans.scrollIntoView();\n\t\t\t                \t\toView.focus()\n\t\t\t            \t// Dispatch \n\t\t\t\t\t\t\toView.dispatch(oTrans);\n\t\t\t\t\t\t}.bind(this), function () {\n\t\t\t\t\t\t\t// console.warn(\"READ FAIL\", this.view)\n\t\t\t\t\t\t\tif (this.view==null) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\n\t\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t\t\t\t\t\t\t// On Reader failure\n\t\t\t\t\t\t\t// On Reader success\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar ppos = linkKey.spec.imagePlaceholder(oView.state, id, linkKey);\n\t\t\t                // If the content around the placeholder has been deleted, drop the image\n\t\t\t                if (ppos == null) { return } \n\t\t\t\t\t\t\t// Add preview to transaction\t\t\t\t\t\t\t\n\t\t\t                oTrans.setMeta(linkKey, {preview: {id: id, dim: null }} )\n\t\t\t                \t//OLD: \n\t\t\t                \t\t// oTrans.setSelection(oView.state.selection.constructor.near(oView.state.tr.doc.resolve(oPosSel))) // must re-focus at p after this async transaction\n\t\t\t                \t// NEW:\n\t\t\t                \t\toTrans.setSelection(oView.state.selection.constructor.near(oView.state.tr.doc.resolve(oPosSel))) // must re-focus at p after this async transaction\n\t\t\t                \t\toTrans.scrollIntoView();\n\t\t\t                \t\toView.focus()\n\t\t\t            \t// Dispatch \n\t\t\t\t\t\t\toView.dispatch(oTrans);\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t}.bind(this));\n\n\t\t\t\t\t\t// Return id\n\t\t\t\t\t\treturn id;\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"progress\":\n\t\t\t\t\t\t\n\t\t\t\t\t\t//console.log(\"progress:\", data.id, data.value)\n\t\t\t\t\t\tif (this.view==null) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\t\t\t\t\t\t\n\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t\t\t\t\t\toView.dispatch(oView.state.tr.setMeta(linkKey, {progress: {id: data.id, value: data.value}}));\n\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"remove\":\n\n\t\t\t\t\t\tif (this.view==null) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t\t\t\t\t\toView.dispatch(oView.state.tr.setMeta(linkKey, {remove: {id: data.id}}));\n\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"update\":\n\n\t\t\t\t\t\t// console.log(\"update:\", data.id)\n\t\t\t\t\t\tif (this.view==null) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\n\n\t\t\t\t\t\t// Otherwise, insert it at the placeholder's position, and remove\n\t\t\t\t\t\t// the placeholder\n\t\t\t\t\t\t\n\t\t\t\t\t\t// preload url\n\t\t\t\t\t\tvar image_preload = new Image();\n\t\t\t\t\t    image_preload.src = data.url;\n\t\t\t\t\t    image_preload.onload = function(data_,event_) {\n\t\t\t\t\t    \tif (this.view==null) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t\t          \t\t\t\n\t\t\t\t\t    \tif ('naturalHeight' in image_preload) {\n\t\t\t\t\t            if (image_preload.naturalHeight + image_preload.naturalWidth === 0) {\n\t\t\t\t\t                image_preload.onerror();\n\t\t\t\t\t                return;\n\t\t\t\t\t            }\n\t\t\t\t\t        } else if (image_preload.width + image_preload.height == 0) {\n\t\t\t\t\t            image_preload.onerror();\n\t\t\t\t\t            return;\n\t\t\t\t\t        }\n\n\t\t\t\t\t        // Find decoration position\n\t\t\t\t\t        var ppos = linkKey.spec.imagePlaceholder(oView.state, data_.id, linkKey);\n\t\t\t\t\t\t\t\n\t\t\t\t\t        // console.warn(\"update preview\",data_,ppos);\n\t\t\t\t\t        // return;\n\n\t\t\t\t\t\t\tif (ppos == null) { \n\t\t\t\t\t\t\t\timage_preload.onerror();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// if (data.id.fileid > 0) {\n\t\t\t\t\t\t\t// \tconsole.error(\"fix img class if there are still svg placeholders\");\n\t\t\t\t\t\t\t// \treturn;\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t\n\t\t\t\t\t        // console.error(\"data.url - relative path, image_preload.src - absolute path\");\n\t\t\t\t\t        // console.error(\"data.url\", data.url);\n\t\t\t\t\t        // console.error(\"image_preload.src\", image_preload.src);\n\t\t\t\t\t    \t\n\t\t\t\t\t    \t// OLD - wrong position if there are mutpliple placeholders with multiple images\n\t\t\t\t\t\t    \t/*\n\t\t\t\t\t\t    \toView.dispatch(oView.state.tr\n\t\t\t\t\t\t\t      .replaceWith(ppos, ppos, oView.state.schema.nodes.image.create({src: data_.url})) //data.url - relative path, image_preload.src - absolute path\n\t\t\t\t\t\t\t      .setMeta(linkKey, {remove: {id: data_.id}}));\n\t\t\t\t\t\t    \t*/\n\t\t\t\t\t\t    // NEW - update only meta\n\t\t\t\t\t\t    \t// console.error(\"loaded but flickers...\", data_);\n\t\t\t\t\t\t    \t\n\t\t\t\t\t\t    \toView.dispatch(oView.state.tr\n\t\t\t\t\t\t\t      // .replaceWith(ppos, ppos, oView.state.schema.nodes.image.create({src: data_.url})) //data.url - relative path, image_preload.src - absolute path\n\t\t\t\t\t\t\t      .setMeta(linkKey, {update: {id: data_.id, url: data_.url}})); // might not be needed because url is already set by reference on the this decoration\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t    \timage_preload = null;\n\t\t\t\t\t    \t// Is this last image?\n\t\t\t\t\t    \tdecos = linkKey.getState(oView.state)\n\t\t\t\t\t\t\tlet figwrap = decos.find(null, null, spec => (spec.name == \"figwrap\" && spec.id == \"figwrap_\"+data_.id.uploader));\n\t\t\t\t\t    \tif (figwrap.length>0) {\n\t\t\t\t\t    \t\tthis.fnCallback_upload({from: figwrap[0].from, to: figwrap[0].to}, \"close\", data_.id.uploader);\n\t\t\t\t\t    \t}\n\t\t\t\t\t    }.bind(this, data);\n\t\t\t\t\t    image_preload.onerror = function(data_,event_) {\n\t\t\t\t\t        //display error\n\t\t\t\t\t        if (this.view==null) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t\t\t\t\t        oView.dispatch(oView.state.tr.setMeta(linkKey, {remove: {id: data_.id}}));\n\t\t\t\t\t        // Is this last image?\n\t\t\t\t\t    \tdecos = linkKey.getState(oView.state)\n\t\t\t\t\t\t\tlet figwrap = decos.find(null, null, spec => (spec.name == \"figwrap\" && spec.id == \"figwrap_\"+data_.id.uploader));\n\t\t\t\t\t    \tif (figwrap.length>0) {\n\t\t\t\t\t    \t\tthis.fnCallback_upload({from: figwrap[0].from, to: figwrap[0].to}, \"close\", data_.id.uploader);\n\t\t\t\t\t    \t}\n\t\t\t\t\t    }.bind(this, data);\t\t\t\t\t\t\n\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"close\":\n\t\t\t\t\t\tif (this.view==null) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Is the upload still in progress\n\t\t\t\t\t\tdecos = linkKey.getState(oView.state)\n\t\t\t\t\t\tlet pendingUploads = decos.find(null, null, spec => (spec.name == \"imageUpload\" && spec.id.uploader == data && typeof spec.id.url == \"undefined\"));\n\n\t\t\t\t\t\t// console.error(\"has pending uploads: \", pendingUploads);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (pendingUploads.length>0){\n\t\t\t\t\t\t\t// Uploads are still\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tlet completedUploads = decos.find(null, null, spec => (spec.name == \"imageUpload\" && spec.id.uploader == data));\n\n\t\t\t\t\t\t\tif (completedUploads.length>0) {\n\n\t\t\t\t\t\t\t\t//console.info(\"All uploaded we can now append images to document\",completedUploads, oPosSel);\n\n\t\t\t\t\t\t\t\t// DODO: [image-flicker] - Try to remove img flicker while replacing placeholders (see also: https://discuss.prosemirror.net/t/update-node-attributes-without-re-rendering-the-node/2416)\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Removing placeholders before add img reduces flicer \n\t\t\t\t\t\t\t\toTrans.setMeta(linkKey, {removeAll: {name: \"imageUpload\", uploader: data},close: {id:\"figwrap_\"+data}});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Add imgs\n\t\t\t\t\t\t\t\tfor (var i = completedUploads.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\t\t\t// WORKING\n\t\t\t\t\t\t\t\t\t\toTrans.replaceWith(completedUploads[i].from, completedUploads[i].to, oView.state.schema.nodes.image.create({src: completedUploads[i].spec.id.url})); //data.url - relative path, image_preload.src - absolute path\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// TEST (no render replacement)\n\t\t\t\t\t\t\t\t\t\t// oTrans.replaceSelectionWith(oView.state.schema.nodes.image.create({src: completedUploads[i].spec.id.url})); //data.url - relative path, image_preload.src - absolute path\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t// const transaction = view.state.tr.setNodeMarkup(getPos(), null, {src: node.attrs.src, width: outer.style.width} ).setSelection(view.state.selection);\n\t\t\t\t\t\t\t\t\t\t// oTrans.setSelection(this.view.state.selection);\n\t\t\t\t\t\t\t\t\t// Image has size 1 \n\t\t\t\t\t\t\t\t\t\t//oPosSel++;\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// // Dispatch\n\t\t\t\t\t\t\t\t//oView.dispatch(oTrans);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// NEW \n\t\t\t\t\t\t\t// Dispatch\n\t\t\t\t\t\t\t\toView.dispatch(oTrans);\n\t\t\t\t\t\t\t// Refocus\n\t\t\t\t\t\t\t\toView.focus()\n\n\t\t\t\t\t\t// ORIG - focus after upload comples\n\n\t\t\t\t\t\t/*\n\t\t\t\t\t\t\tid = \"figwrap_\"+data;\n\t\t\t\t\t\t\toView = this.view;\t\t\t\t\t\t\t\t\t\t\t\t\t// View we are at\n\t\t          \t\t\toTrans = this.view.state.tr;\t\t\t\t\t\t\t\t\t\t// View transactions\n\t\t\t\t\t\t\t// Remove fig decoration\n\t\t\t\t\t\t\t\toTrans.setMeta(linkKey, {close: {id:id}}) // to mark figure filled\n\t\t\t\t\t\t\t// Set selection to wrapper paragraph\n\t\t\t\t\t\t\t\toTrans.setSelection(oView.state.selection.constructor.near(oView.state.tr.doc.resolve(oPosSel)));\n\t\t\t\t\t\t\t// Dispatch\t\t\t\t\n\t\t\t\t\t\t\t\toView.dispatch(oTrans.scrollIntoView());\n\t\t\t\t\t\t\t// Focus view\n\t\t\t\t\t\t\t\toView.focus()\n\t\t\t\t\t\t*/\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\n\t\t\n\t\t//--------\n\n            // test on upload complete add src\n              \n              // setTimeout( function() {\n              //     let pos = linkKey.spec.imagePlaceholder(view.state, id, linkKey);\n              //     // If the content around the placeholder has been deleted, drop\n              //     // the image\n              //     if (pos == null) return\n              //     // Otherwise, insert it at the placeholder's position, and remove\n              //     // the placeholder\n              //       console.log(\"id\",id,attrs.src);\n              //       // On success replace \n              //         // view.dispatch(view.state.tr\n              //         //               .replaceWith(pos, pos, nodeType.create({src: attrs.src}))\n              //         //               .setMeta(linkKey, {remove: {id}}))\n              //       // On failure, just clean up the placeholder\n              //         // view.dispatch(view.state.tr.setMeta(linkKey, {remove: {id}}))\n              // }, 3000);\n\t\t\t\n\n\n\t\t}\n\n\t// ============================================\n\t// link stuff\n\t// ============================================\n\t\t\n\n\t\t// Only from interface method removeLink()\n\t\tmUnlink(oView, fn, oV)\n\t\t{\n\t\t\t// command puts oState, fnDispatch, oView\n\t\t\tif ( oV && oV.dispatch ) { oView = oV; }\n\n\t\t\t\n\t\t\t// NEW:\n\t\t\ttoggleMark(oView.state.schema.marks.link)(oView.state, oView.dispatch)\n          \treturn true\n\n          \t// OLD:\n          \t/*\n\t\t\tif ( ! this._mIsLink(oView, oPos) ) { return; }\n\n\t\t\tlet oPos = this._mGetMarkPos(oView.state, 'link');\n\t\t\t// if (oPos.from == oPos.to && !oView.state.selection.empty) {\n\t\t\tif (oPos.from == oPos.to) { // && !oView.state.selection.empty) {\n\t\t\t\t// link is at the begingng\n\t\t\t\tlet sFrom = oView.state.selection.$from;\n\t\t\t\toPos.from = sFrom.pos-sFrom.parentOffset;\n\t\t\t\t//console.log(\"fix get parent postion\", oPos.from, sFrom.parentOffset)\n\t\t\t}\n\t\t\tlet oTransaction = oView.state.tr.removeMark(oPos.from, oPos.to, oView.state.schema.marks.link);\n\t\t\toView.dispatch(oTransaction);\n\t\t\treturn true;\n\t\t\t*/\n\t\t}\n\t\t\n\n\t\t// Set link is call on _mCloseDialog(). \n\t\t// DO NOT CALL THIS DIRECTLY\n\t\tmSetLink(oView)\n\t\t{\n\t\t\t// Do we have something to mark\n\t\t\tif (this.selection==null || this.selection.from == this.selection.to) { return false;}\n\n\t\t\t// set selection\n\t\t\tlet oPos =  this.selection; //{ from: oState.selection.from, to: oState.selection.to };\n\t\t\t// get whole mark positions if selection is not empty\n\t\t\t// if (!oView.state.selection.empty) {\n\t\t\t// \tthis._mIsLink(oView) && ( oPos = this._mGetMarkPos(oView.state, 'link') );\n\t\t\t// }\n\n\t\t\tlet vUrl = this.linkDialog.i.value;\n\t\t\tif (String.prototype.trim) {\n\t\t      vUrl = vUrl.trim();\n\t\t    } else {\n\t\t      // Since IE doesn't include non-breaking-space (0xa0) in their \\s\n\t\t      // character class (as required by section 7.2 of the ECMAScript spec),\n\t\t      // we explicitly include it in the regexp to enforce consistent\n\t\t      // cross-browser behavior.\n\t\t      // NOTE: We don't use String#replace because it might have side effects\n\t\t      // causing this function to not compile to 0 bytes.\n\t\t      vUrl =  /^[\\s\\xa0]*([\\s\\S]*?)[\\s\\xa0]*$/.exec(vUrl)[1];\n\t\t    };\n\t\t\tlet oAttr = { href: vUrl };\n\t\t\t//this.linkDialog.isTarget.checked && (oAttr.target = \"_blank\");\n\t\t\toAttr.target = \"_blank\";\n\n\t\t\tlet oMarkType = oView.state.schema.marks.link;\n\t\t\t\n\t\t\tlet oTransaction = null;\n\t\t\tif (oAttr.href.length!=0) {\n\t\t\t\t// link type\n\t\t\t\t// let emlReg = new RegExp('^[+a-zA-Z0-9_.!#$%&\\'*\\\\/=?^`{|}~-]+@([a-zA-Z0-9-]+\\\\.)+[a-zA-Z0-9]{2,63}$');\n\t\t\t\t// if (emlReg.test(oAttr.href)) {\n\t\t\t\t// \toAttr.href = \"mailto:\"+oAttr.href;\n\t\t\t\t// }\n\n\t\t\t\t// remove and add link\n\t\t\t\toTransaction = oView.state.tr\n\t\t\t\t\t.removeMark(oPos.from, oPos.to, oMarkType)\n\t\t\t\t\t.addMark(oPos.from, oPos.to, oMarkType.create(oAttr))\n\t\t\t\t// dispatch\n\t\t\t\toView.dispatch(oTransaction);\n\t\t\t\t// set cursor at the end of the link\n\t\t\t\tthis._mSelect(oView,{ from: oPos.to, to: oPos.to},true);\t\n\n\t\t\t} else {\n\t\t\t\t// remove link\n\t\t\t\toTransaction = oView.state.tr\n\t\t\t\t\t.removeMark(oPos.from, oPos.to, oMarkType)\n\t\t\t\t// dispatch\n\t\t\t\toView.dispatch(oTransaction);\n\t\t\t\t// select removed\n\t\t\t\t// console.error(\"select removed link text\", oPos);\n\t\t\t\tthis._mSelect(oView,oPos, true);\n\t\t\t}\n\t\t\t\n\t\t\t//ORIG: IE has issue with this focus (causing jumps to top of the document?)\n\t\t\t\t// oView.focus();\n\t\t\t// NEW\n\t\t\t\t// No need to focus (anyway it was done in mSelect)\n\t\t\t\n\t\t\treturn true;\n\t\t}\n\n\t// ============================================\n\t// tooltip stuff\n\t// ============================================\n\t\n\n\t\tmShowTooltip(oView,oTarget) {\n\t\t\t// Based on tooltip https://prosemirror.net/examples/tooltip/\n\t\t\t\n\t\t\t// Do not show if menu bar is open\n\t\t\t\tif (this.menuBar.isOpen) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t// Get selection from the event\n\t\t\t\n\t\t\t\tlet oSel = this._mGetMarkPosFromDomEvent(oView, oTarget);\n\n\t\t\t// Is there anything at all (like oView.state.selection.empty)\n\t\t\t\n\t\t\t\tif (oSel.to <= oSel.from) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t// Append fresh tooltip element to dom\n\t\t\t\t\n\t\t\t\t// this.aDomEdit.parentNode.appendChild(this.linkTooltip);\n\t\t\t\tdocument.body.appendChild(this.linkTooltip);\n\n\t\t\t// Update new target referrence for the tool tip\n\t\t\t\t\t\t\t\t\n\t\t\t\t\n\t\t\t\tthis.linkTooltipOpen = oTarget;\n\t\t\t\t// Clear any pending close timer\n\t\t\t\tif (this.linkTooltipTimer != null) {\n\t\t\t\t\tclearTimeout(this.linkTooltipTimer)\n\t\t      \t\tthis.linkTooltipTimer = null\n\t\t      \t}\n\n\t\t    // Update tooltip events\n\t\t    \n\t\t\t\t// Remove existing event handlers\n\t\t\t\tthis.linkTooltip.removeEventListener('click', this.fnLinkTooltipEventClick);\n\t\t\t\tthis.linkTooltip.removeEventListener('mouseover', this.fnLinkTooltipEventOver);\n\t\t\t\tthis.linkTooltip.removeEventListener('mouseout', this.fnLinkTooltipEventOut);\n\t\t\t\toTarget.removeEventListener('mouseout', this.fnLinkTooltipOpenEventOut);\n\n\t\t\t\t// Define new event handlers\n\t\t\t\tthis.fnLinkTooltipEventClick = this._mEventTooltipClick.bind(this, oView, oTarget);\n\t\t\t\tthis.fnLinkTooltipEventOver = this._mEventTooltipOpen.bind(this, oTarget)\n\t\t\t\tthis.fnLinkTooltipEventOut = this._mEventTooltipOpen.bind(this, null);\n\t\t\t\tthis.fnLinkTooltipOpenEventOut = this._mEventTooltipOpen.bind(this,null);\n\n\t\t\t\t// Assign new event Handlers\n\t\t\t\tthis.linkTooltip.addEventListener('click', this.fnLinkTooltipEventClick);\n\t\t\t\tthis.linkTooltip.addEventListener('mouseover', this.fnLinkTooltipEventOver);\n\t\t\t\tthis.linkTooltip.addEventListener('mouseout', this.fnLinkTooltipEventOut);\n\t\t\t\toTarget.addEventListener('mouseout', this.fnLinkTooltipOpenEventOut);\n\n\t\t\t// Show tooltip element\n\t\t\n\t\t\t\tthis.linkTooltip.style.display = \"\"\n\t\t\t\n\t\t\t// Set dom textcontent\n\t\t\t\n\t\t\t\tthis.linkTooltip.textContent = oTarget.getAttribute(\"href\");\n\n\t\t\t// Postion \t\n\t\t\n\t\t\t\tthis._mPos(this.linkTooltip, oView, oSel);\n\t\t\t\n\t\t}\n\n\n\t\t\n\t\t_mPos(oElm, oView, oSel, opt_DefaultToTop_, opt_menu_) {\n\n\t\t\t// console.log(\"fix:\",oElm.offsetParent);\n\t\t\t// Get Selection Rect\n\n\t\t\t\t\t// tests with selection\n\t\t\t\t\t//oSel = oView.state.selection;\t\t\t\t\n\n\t\t\t\t\t// Get coords from selection (contract selection to workaround start/end of the line mismatch)\n\t\t\t\t\tlet cntr = 1; // contract selection to workaround line breaks (i.e. get coords at from+1 and to-1)\n\t\t\t\t\tlet fromSel = oView.coordsAtPos(oSel.from+cntr); \n\t\t\t\t\tlet toSel = oView.coordsAtPos(oSel.to-cntr);\n\n\t\t\t\t\t// Correct Zero-Width start/end points (line breaks, node boundaries)\n\n\t\t\t\t\t// let fromSelZero = oView.coordsAtPos(oSel.from+1); \n\t\t\t\t\t// let toSelZero = oView.coordsAtPos(oSel.to-1);\n\n\t\t\t\t\t// //if (oSel.to-oSel.from>1) {\n\t\t\t\t\t// \tif (fromSel.bottom==fromSelZero.top && toSel.top==toSelZero.bottom) {\n\t\t\t\t\t// \t\tconsole.error(\"left/right edge\");\n\t\t\t\t\t// \t\tif (fromSel.left<toSel.left) {\n\t\t\t\t\t// \t\t\tconsole.error(\"-> is right edge ?\");\n\t\t\t\t\t// \t\t} else {\n\t\t\t\t\t// \t\t\tconsole.error(\"-> is left edge ?\");\n\t\t\t\t\t// \t\t}\n\t\t\t\t\t// \t} else {\n\t\t\t\t\t// \t\tif (fromSel.bottom==fromSelZero.top) {\n\t\t\t\t\t// \t\t\tconsole.error(\"left edge\");\n\t\t\t\t\t// \t\t}\n\t\t\t\t\t// \t\tif (toSel.top==toSelZero.bottom) {\n\t\t\t\t\t// \t\t\tconsole.error(\"right edge\");\n\t\t\t\t\t// \t\t}\n\t\t\t\t\t// \t}\n\n\t\t\t\t\t// //}\n\n\t\t\t\t\t// console.log(\"----------------------------\");\n\t\t\t\t\t// console.log(\"selection\", oSel, oSel.from, oSel.to);\n\t\t\t\t\t// console.log(\"position\", fromSel, toSel);\n\t\t\t\t\t// console.log(\"position\", fromSelZero, toSelZero);\n\t\t\t\t\t// console.log(\"js text [\"+ window.getSelection().toString()+\"]\");\n\t\t\t\t\t// console.log(\"----------------------------\");\n\n\t\t\t\t\t// return;\n\n\t\t\t\t\t// set top and bottom\n\t\t\t\t\tlet oTargetRec = { top: fromSel.top, bottom: toSel.bottom, left: fromSel.left, right: toSel.right }\n\t\t\t\t\n\t\t\t\t// THIS MIGHT NOT BE NEED if we find workaround for invisible start of the selection at break points\n\t\t\t\t//\t\n\t\t\t\t\tif (oTargetRec.top != toSel.top) {\n\t\t\t\t\t\t// correct left end right\n\t\t\t\t\t\t//console.error(\"fix left right\");\n\t\t\t\t\t\t// We need loop to find new line (Tests with the range.getBoundingClientRect() were ok but it was not possible to get always correct document.range)\n\t\t\t\t\t\tlet breakSel = null\n\t\t\t\t\t\tbreakloop:\n\t\t\t\t\t\tfor (var i = oSel.from+1; i < oSel.to; i++) {\n\t\t\t\t\t\t\tbreakSel = oView.coordsAtPos(i);\n\t\t\t\t\t\t\t// console.warn(\"\\t-> \", i, oTargetRec.top, breakSel.top);\n\t\t\t\t\t\t\tif (oTargetRec.top != breakSel.top) {\n\t\t\t\t\t\t\t\t// new row is first left\n\t\t\t\t\t\t\t\t//console.info(\"\\t-> \", i, oTargetRec.top, breakSel.top);\n\t\t\t\t\t\t\t\toTargetRec.left = breakSel.left;\n\t\t\t\t\t\t\t\tbreak breakloop;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// previose is last right\n\t\t\t\t\t\t\toTargetRec.right = breakSel.right;\n\t\t\t\t\t\t};\n\t\t\t\t\t} \n\t\t\t\t//\n\t\t\t\n\t\t\t \n\t\t\t// Position variables\n\t\t\t\n\t\t\t\tlet oPos = {\n\t\t\t\t\t// bParent: oElm.offsetParent.getBoundingClientRect(), // dialog parent - we shouldn't need this\n\t\t\t\t\tbDialog: oElm.getBoundingClientRect(),\n\t\t\t\t\tbTarget: oTargetRec,\n\t\t\t\t\twScreen: window.innerWidth,\n\t\t\t\t\thScreen: window.innerHeight,\n\t\t\t\t\thScroll: (window.pageYOffset || document.documentElement.scrollTop)  - (document.documentElement.clientTop || 0) // Adjust top position according to window scroll position (container is not absolute)\n\t\t\t\t}     \n\t\t\t\t\n\t\t\t\t//console.log(\"oPos\", oPos);\n\n\t\t\n\t\t\t// Position at DOM Center top or bottom based on screen available\n\t\t\t\n\t\t\t\t// Vertical\n\t\t\t\t\n\t\t\t\t\t// console.warn(\"this ios\", this.isIOS());\n\n\t\t\t\t\tif (opt_DefaultToTop_) {\t\t\t\t\t\n\t\t\t\t\t\t// Postion to Top\n\t\t\t\t\t\tif ((oPos.bTarget.top - 5 - oPos.bDialog.height) < 0) {\n\t\t\t\t\t\t\t//console.warn(\"move to bottom\", (oPos.bTarget.top - 5 - oPos.bDialog.height), oPos.hScroll);\n\t\t\t\t\t\t\toPos.top = oPos.hScroll + oPos.bTarget.bottom + 5;\n\t\t\t\t\t\t\tif (opt_menu_) {\n\t\t\t\t\t\t\t\toElm.classList.remove(\"menubar-top\");\n\t\t\t\t\t\t\t\toElm.classList.add(\"menubar-bottom\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// oElm.className = this.linkClassBottom;\n\t\t\t\t\t\t\t\toElm.classList.remove(this.linkClassTop);\n\t\t\t\t\t\t\t\toElm.classList.add(this.linkClassBottom);\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// console.warn(\"move to top\", (oPos.from.bottom + 5 + oPos.bDialog.height), oPos.hScreen, oPos.top);\n\t\t\t\t\t\t\t// oPos.top = oPos.hScroll + oPos.from.top - oPos.bDialog.height - 5 +\"px\";\t\n\t\t\t\t\t\t\toPos.top = oPos.hScroll + oPos.bTarget.top - oPos.bDialog.height - 5;\n\t\t\t\t\t\t\tif (opt_menu_) {\n\t\t\t\t\t\t\t\toElm.classList.remove(\"menubar-bottom\");\n\t\t\t\t\t\t\t\toElm.classList.add(\"menubar-top\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// oElm.className = this.linkClassTop;\n\t\t\t\t\t\t\t\toElm.classList.remove(this.linkClassBottom);\n\t\t\t\t\t\t\t\toElm.classList.add(this.linkClassTop);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\t\t\t\t\t\n\t\t\t\t\t\t// Postion to Bottom\n\t\t\t\t\t\tif ((oPos.bTarget.bottom + 5 + oPos.bDialog.height) > oPos.hScreen) {\n\t\t\t\t\t\t\t// console.warn(\"move to top\", (oPos.from.bottom + 5 + oPos.bDialog.height), oPos.hScreen, oPos.top);\n\t\t\t\t\t\t\t// oPos.top = oPos.hScroll + oPos.from.top - oPos.bDialog.height - 5 +\"px\";\t\n\t\t\t\t\t\t\toPos.top = oPos.hScroll + oPos.bTarget.top - oPos.bDialog.height - 5;\n\t\t\t\t\t\t\t//oElm.className = this.linkClassTop;\n\t\t\t\t\t\t\toElm.classList.remove(this.linkClassBottom);\n\t\t\t\t\t\t\toElm.classList.add(this.linkClassTop);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// console.warn(\"move to bottom\", (oPos.from.bottom + 5 + oPos.bDialog.height), oPos.hScreen, oPos.top);\n\t\t\t\t\t\t\toPos.top = oPos.hScroll + oPos.bTarget.bottom + 5;\n\t\t\t\t\t\t\t//oElm.className = this.linkClassBottom;\n\t\t\t\t\t\t\toElm.classList.remove(this.linkClassTop);\n\t\t\t\t\t\t\toElm.classList.add(this.linkClassBottom);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t        \n\t        \t// Horizontal        \n\t        \t\n\t\t        \t// IF LINK SPREADS OVER LINES - DEPRECATED as misleading... \n\t\t\t        \t// if (oPos.to.top > oPos.bTarget.top && oPos.from.left>oPos.to.right) {\n\t\t\t        \t\n\t\t\t        \t// \t// Add tooltip to leading or trailing part\n\t\t\t        \t// \tif (this.linkTooltip.className == this.linkTooltip_classTop) {\n\t\t\t        \t// \t\t//console.warn(\"anchor is broken center and leading part\");\n\t\t\t\t        // \t\toPos.left = oPos.from.left+((oPos.bTarget.right-oPos.from.left)/2);\n\t\t\t\t        // \t\toPos.left = (oPos.left - oPos.bParent.left);\n\t\t\t        \t// \t} else {\n\t\t\t\t        // \t\t//console.warn(\"anchor is broken center and trailing part\");\n\t\t\t\t        // \t\toPos.left = oPos.bTarget.left+((oPos.to.right-oPos.bTarget.left)/2);\n\t\t\t\t        // \t\toPos.left = (oPos.left - oPos.bParent.left);\n\t\t\t        \t// \t}\n\t\t\t        \t// } else {\n\t\t\t        \t\t// Center tool tip\n\t\t\t        \t\t\t//console.log(\"?\",((oPos.bTarget.left + oPos.bTarget.right) / 2), oPos.bTarget.left + 3);\t\t\t        \t\t\n\t\t\t\t\t\t\t\t// DEPRECATED: (why select max?) oPos.left = Math.max(((oPos.bTarget.left + oPos.bTarget.right) / 2), oPos.bTarget.left + 3);\n\t\t\t        \t\t\toPos.left = ((oPos.bTarget.left + oPos.bTarget.right) / 2);\n\t\t\t        \t\t// dialog parent - we shouldn't need this\n\t\t\t        \t\t\t// DEPRECATED: oPos.left = (oPos.left - oPos.bParent.left);\n\t\t\t        \t//}\n\t\t        \t// initial arrow left position\n\t\t        \t\toPos.arrow = 50; //%\n\t\t        \t// offscreen horizontal\n\t\t\t        \tif ( oPos.left - (oPos.bDialog.width/2) - 5 < 0 ) {\n\t\t\t        \t\t// move to left start and shift arrow\n\t\t\t        \t\tlet left_shift = (oPos.left - (oPos.bDialog.width/2) - 5);\n\t\t\t        \t\t//console.log(\"left_shift:\", left_shift, oPos.bDialog.width);\n\t\t\t        \t\tif (Math.abs(left_shift*2)+10 >= oPos.bDialog.width) {\n\t\t\t        \t\t\t// if arrow is out of the box move back by arrow width (min left)\n\t\t\t        \t\t\tleft_shift += 10; // should be: left_shift = -((oPos.bDialog.width/2)-10)\n\t\t\t        \t\t} \n\t\t\t        \t\toPos.arrow = ((0.5 + (left_shift / oPos.bDialog.width))*100);\n\t\t\t        \t\t//ORIG: oPos.arrow = ((0.5 + ((oPos.left - (oPos.bDialog.width/2) - 5) / oPos.bDialog.width))*100);\n\t\t\t        \t\t//console.log(\"move arrow to left: \", oPos.arrow);\n\t\t\t        \t\toPos.left -= (oPos.left - (oPos.bDialog.width/2) - 5);\t\n\t\t\t        \t} else if ( oPos.left + (oPos.bDialog.width/2) + 5 > oPos.wScreen ) {\n\t\t\t        \t\tlet right_shift = (oPos.wScreen-(oPos.left + (oPos.bDialog.width/2) + 5));\n\t\t\t        \t\t// console.log(\"right_shift:\", right_shift, oPos.bDialog.width);\n\t\t\t        \t\tif (Math.abs(right_shift*2)+10 >= oPos.bDialog.width) {\n\t\t\t        \t\t\t// if arrow is out of the box move back by arrow width (max right)\n\t\t\t        \t\t\tright_shift += 10;  // should be: right_shift = -((oPos.bDialog.width/2)-10)\n\t\t\t        \t\t} \t\t\t        \t\t\n\t\t\t        \t\toPos.arrow = ((0.5 - (right_shift / oPos.bDialog.width))*100);\n\t\t\t        \t\t//console.log(\"move arrow to right: \", oPos.arrow);\n\t\t\t        \t\toPos.left += (oPos.wScreen-(oPos.left + (oPos.bDialog.width/2) + 5));\n\t\t\t        \t}\n\n\t\t\t// Set position for the arrow\n\t\t\t\t// oPos.arrow = Math.min(Math.max(oPos.arrow, 2.5), 97.5);\n\t\t\t\toElm.setAttribute(\"style\", \"--tooltip-left: \"+oPos.arrow+\"%\");\n\t\t    \n\t\t    // Set dom position\n\t\t\t\t\n\t\t\t\toElm.style.top = oPos.top +\"px\";\t\n\t\t\t\toElm.style.left = oPos.left+ \"px\";\n\n\t\t}\n\n\t\t_mCloseTooltip(dom_, opt_force_) {\n\t\t\t//return false;\n\n\t\t\tif (opt_force_) {\n\t\t\t\t// FORCE CLOSE\n\n\t\t\t\t// Cancel close timer\n\t\t\t\tif (this.linkTooltipTimer != null) {\n\t\t\t\t\tclearTimeout(this.linkTooltipTimer)\n\t\t      \t\tthis.linkTooltipTimer = null\n\t\t      \t}\n\t\t      \t// remove event handler\n\t\t\t\tthis.linkTooltip.removeEventListener('click', this.fnLinkTooltipEventClick);\n\t\t\t\tthis.linkTooltip.removeEventListener('mouseover', this.fnLinkTooltipEventOver);\n\t\t\t\tthis.linkTooltip.removeEventListener('mouseout', this.fnLinkTooltipEventOut);\n\t\t\t\tthis.linkTooltipOpen.removeEventListener('mouseout', this.fnLinkTooltipOpenEventOut);\n\t\t\t\t// remove element\n\t\t\t\t//this.linkTooltip.remove()\n\t\t\t\tthis.linkTooltip.parentNode.removeChild(this.linkTooltip);\n\t\t\t\t// reset\n\t\t\t\tthis.linkTooltipOpen = null;\n\n\t\t\t} else {\n\t\t\t\t// EVENT BASED CLOSE\n\t\t\t\t\n\t\t\t\t// Set timed close\n\t\t\t\tthis.linkTooltipTimer = setTimeout(() => {\n\t\t\t\t\tif (this.linkTooltipOpen != dom_) {\n\t\t\t\t\t\t// remove event handler\n\t\t\t\t\t\tthis.linkTooltip.removeEventListener('click', this.fnLinkTooltipEventClick);\n\t\t\t\t\t\tthis.linkTooltip.removeEventListener('mouseover', this.fnLinkTooltipEventOver);\n\t\t\t\t\t\tthis.linkTooltip.removeEventListener('mouseout', this.fnLinkTooltipEventOut);\n\t\t\t\t\t\tthis.linkTooltipOpen.removeEventListener('mouseout', this.fnLinkTooltipOpenEventOut);\n\t\t\t\t\t\t// remove element\n\t\t\t\t\t\t// this.linkTooltip.remove()\n\t\t\t\t\t\tthis.linkTooltip.parentNode.removeChild(this.linkTooltip);\n\t\t\t\t\t\t// reset\n\t\t\t\t\t\tthis.linkTooltipOpen = null;\n\t\t\t\t\t}\n\n\t\t\t\t}, 200)\n\n\t\t\t}\n\t\t}\n\n\t\t_mEventTooltipOpen(dom_) {\n\t\t\t\n\t\t\t// Cancel close timer\n\t\t\tif (this.linkTooltipTimer != null) {\n\t\t\t\tclearTimeout(this.linkTooltipTimer)\n\t      \t\tthis.linkTooltipTimer = null\n\t      \t}\n\t      \t// Close or Keep open\n\t\t\tif (dom_ == null) {\n\t\t\t\t// console.log(\"close...\")\n\t\t\t\tthis._mCloseTooltip(null);\n\t\t\t} else {\n\t\t\t\t// console.log(\"keep open...\");\n\t\t      \tthis.linkTooltipOpen = dom_;\n\t      \t}\n\t\t}\n\n\t\t_mEventTooltipClick(oView,oTarget) {\n\n\n\t\t\t// console.error(\"BLOCK Tooltip from now on...\")\n\t\t\t// console.log(\"event\", oView,e.target);\n\t\t\t\n\t\t\t// Close tooltop\n\t\t\t\tthis._mCloseTooltip(null,true);\n\t\t\t// Open dialog from dom event\n\t\t\t\tlet oPos = this._mGetMarkPosFromDomEvent(oView, oTarget);\n\t\t\t\tthis._mShowDialogFromDomEvent(oView,oPos); \n\t\t}\n\n\n\t// ============================================\n\t// Link stuff\n\t// ============================================\n\n\t\t// ============================================\n\t\t// DOM event based\n\t\t// ============================================\n\t\t\n\t\t_mIsLinkFromDomEvent(oView, e)\n\t\t{\n\t\t\n\t\t\t// False if dialog is open\n\t\t\t\tif (this.linkDialog.isOpen)\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t\t\t\n\n\t\t\t// Open hove tooltip if:\n\t\t\t\tif (e.target.nodeName==\"A\") { \n\t\t\t\t\treturn e.target; \n\t\t\t\t}\n\n\t\t\t// Parent can be link\n\t\t\t\t\n\t\t\t\t// Target lookup\n\t\t\t\t\tlet inLnk = false;\n\t\t\t\t\n\t\t\t\t// FROM DOM\n\t\t\t\t\tif (e.path) {\n\t\t\t\t\t\t// From Event Path\n\t\t\t\t\t\taloop:\n\t\t\t\t\t\tfor (var i = 0; i < e.path.length; i++) {\n\t\t\t\t\t\t\tif (e.path[i].nodeName == \"A\") {\n\t\t\t\t\t\t\t\tinLnk = e.path[i];\n\t\t\t\t\t\t\t\tbreak aloop;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// From target parent\n\t\t\t\t\t\tlet current = e.target;\n\t\t\t\t\t\tploop:\n\t\t\t\t\t\twhile (current.parentNode && current != e.currentTarget){\n\t\t\t\t\t\t\t // do stuff with node\n\t\t\t\t\t\t\t if (current.nodeName == \"A\") {\n\t\t\t\t\t\t\t \tinLnk = current;\n\t\t\t\t\t\t\t \tbreak ploop;\n\t\t\t\t\t\t\t }\n\t\t\t\t\t\t\t // update\n\t\t\t\t\t\t\t current = current.parentNode\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t// FROM SEL?\n\t\t\t\t\t//let oSel = this._mGetMarkPosFromDomEvent(oView,e.target);\n\t\t\t\t\t//this._mIsLink(oView,oSel) \n\t\t\t\t\t// ... we would need to compare target from-to with link from-to\n\t\t\t\t\n\n\t\t\t// Do not open\n\t\t\treturn inLnk;\n\t\t}\n\n\t\t_mGetMarkPosFromDomEvent(oView, oTarget) {\n\n\t\t\t// DOM Element\n\t\t\tlet link_ = oTarget;\n\t\t\t// get start position of the target\n\t\t\tlet pos_ = oView.posAtDOM(link_);\t\t\t\n\t\t\t// Get postion from Cursor at the beging of link\n\t\t\tlet _oCursor = oView.state.doc.resolve(pos_);\n\t\t\tlet _oMarkType = oView.state.schema.marks['link'];\n\t\t\tlet oPos = this._mMarkExtend(_oCursor, _oMarkType);\n\t\t\t// correct extended position\n\t\t\tif (oPos.from == oPos.to) {\n\t\t\t\t// link is at the beging of the parent node. replace from by don start position\n\t\t\t\toPos.from = pos_;\n\t\t\t}\n\n\t\t\treturn oPos;\n\t\t}\n\t\t\n\n\t\t// ============================================\n\t\t// State based\n\t\t// ============================================\n\t\t\n\t\t_mIsLink(oView, optPseudoSelection, optAny)\n\t\t{\n\t\t// todo -> special case: selection between two links!\n\t\t\tlet oSelection = optPseudoSelection || oView.state.selection;\n\t\t\t// to speed up things check first cursor only movement\n\t\t\tif ( oSelection.empty ) { return this._mRangeHasLink(oView) }\n\n\t\t\t// now check selection\n\t\t\tlet {from, to} = oSelection;\n\t\t\t// set a range of one char\n\t\t\tlet o = {\n\t\t\t\tstart: { from: from, to: from + 1 },\n\t\t\t\tend: { from: to - 1, to: to }\n\t\t\t}\n\t\t\treturn (optAny)? (this._mRangeHasLink(oView, o.start) || this._mRangeHasLink(oView, o.end)) : (this._mRangeHasLink(oView, o.start) && this._mRangeHasLink(oView, o.end));\n\t\t}\n\t\t_mRangeHasLink(oView, o)\n\t\t{\n\t\t\tlet isLink = false;\n\t\t\tlet oState = oView.state;\n\t\t\tlet oMarkType = oState.schema.marks.link;\n\t\t\tlet oDoc = oState.doc;\n\t\t\tif ( o ) { isLink = oDoc.rangeHasMark(o.from, o.to, oMarkType); }\n\t\t\telse { isLink = oMarkType.isInSet(oState.storedMarks || oState.selection.$cursor.marks()) }\n\t\t\treturn isLink;\n\t\t}\n\t\t_mGetMark(oState, vMarkName, optPseudoSelection)\n\t\t{\n\t\t\tlet o = false;\n\t\t\tlet oSelection = (optPseudoSelection)? optPseudoSelection : oState.selection;\n\t\t\toState.doc.nodesBetween(oSelection.from, oSelection.to, function(oNode, oPos)\n\t\t\t{\n\t\t\t\tlet aMark = oNode.marks;\n\t\t\t\taMark.every( function(oMark)\n\t\t\t\t{\n\t\t\t\t\tif ( oMark.type.name === vMarkName ) { o = oMark; return false; }\n\t\t\t\t\treturn true;\n\t\t\t\t})\n\t\t\t\treturn true;\n\t\t\t});\n\t\t\treturn o;\n\t\t}\n\t\t_mGetMarkPos(oState, vMarkName)\n\t\t{\n\t\t\tlet oCursor = oState.doc.resolve(oState.selection.from);\n\t\t\tlet oMarkType = oState.schema.marks[vMarkName];\n\t\t\treturn this._mMarkExtend(oCursor, oMarkType);\n\t\t}\n\t\t_mMarkExtend (oCursor, oMarkType)\n\t\t{\n\t\t\tlet oParent = oCursor.parent;\n\t\t\tlet oPos = {\n\t\t\t\toIndex: { vStart: oCursor.index(), vEnd: oCursor.indexAfter() },\n\t\t\t\toMark: { vStart: oCursor.start(), vEnd: oCursor.start() }\n\t\t\t}\n\t\t\tlet oI = oPos.oIndex;\n\t\t\tlet oM = oPos.oMark;\n\n\t\t\tconst hasMark = i => \n\t\t\toMarkType.isInSet(oParent.child(i).marks)\n\n\t\t\t// Clicked outside edge of tag.\t\t\t\t\n\t\t\t\t// ORIG:\n\t\t\t\t\t// if (oI.vStart === oParent.childCount) { oI.vStart--; }\n\t\t\t\t\t// while (oI.vStart > 0 && hasMark(oI.vStart)) { oI.vStart--; }\n\t\t\t\t\t// while ( oI.vEnd < oParent.childCount && hasMark(oI.vEnd)) { oI.vEnd++ }\n\t\t\t\t// NEW (fix adjecent links)\n\n\t\t\t\t\t// console.warn('\\t->start:'+oI.vStart+', '+oI.vEnd);\n\n\t\t\t\t\tif (oI.vStart === oParent.childCount) { oI.vStart--; }\n\n\t\t\t\t\t// ORIG - fix start at parent or adjecent nodes\n\t\t\t\t\t\t// if (oI.vStart == 0) {\n\t\t\t\t\t\t// \tconsole.warn('\\t->start:', oI.vStart, oI.vEnd, hasMark(oI.vEnd))\n\t\t\t\t\t\t// \toI.vEnd = 0;\n\t\t\t\t\t\t// }\n\t\t\t\t\t// NEW - fix keep the same node\n\t\t\t\t\t\toI.vEnd = oI.vStart;\n\n\n\t\t\t\t\tlet _nodeStart = null;\n\t\t\t\t\twhile (oI.vStart > 0 && hasMark(oI.vStart) && (_nodeStart==null || _nodeStart==oParent.child(oI.vStart))) { \n\t\t\t\t\t\t//console.error(\"fix start:\",_nodeStart,oParent.child(oI.vStart));\n\t\t\t\t\t\t_nodeStart = oParent.child(oI.vStart);\n\t\t\t\t\t\toI.vStart--; \n\t\t\t\t\t}\n\t\t\t\t\tlet _nodeEnd = null;\n\t\t\t\t\twhile ( oI.vEnd < oParent.childCount && hasMark(oI.vEnd) && (_nodeEnd==null || _nodeEnd==oParent.child(oI.vEnd))) { \n\t\t\t\t\t\t//console.error(\"fix end:\",_nodeEnd,oParent.child(oI.vEnd));\n\t\t\t\t\t\t_nodeEnd = oParent.child(oI.vEnd);\n\t\t\t\t\t\toI.vEnd++ \n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t//let vSize = (hasMark(0)) ? oParent.child(0).nodeSize : 0;\n\t\t\tfor (let i = 0; i < oI.vEnd; i++)\t\n\t\t\t{\n\t\t\t\tlet vSize = oParent.child(i).nodeSize;\t\t\t\t\n\t\t\t\tif (i <= oI.vStart) oM.vStart += vSize;\n\t\t\t\toM.vEnd += vSize;\n\t\t\t\t//console.log(i + ': ', vSize + ' (size), ' + oM.vStart +' (start), ' + oM.vEnd + ' (end)');\n\t\t\t}\n\n\t\t\t// if (oM.vStart==oM.vEnd && vSize) {\n\t\t\t// \toM.vEnd +=vSize\n\t\t\t// }\n\t\t\t// console.error(\"pos: \",oM.vStart,oM.vEnd);\n\n\t\t\treturn { from: oM.vStart, to: oM.vEnd };\n\t\t}\n\n\t\t// SELECT \n\t\t_mSelect(oView, oPos, opt_scroll_) {\n\n\t\t\t// DEPRECATED: Get link postion from Target\n\t\t\t\t//let oPos = this._mGetMarkPosFromDomEvent(oView, e);\n\t\t\t// Create Text Selection\n\t\t\t\tlet $s = oView.state.doc.resolve(oPos.from)\n\t\t\t\tlet $e = oView.state.doc.resolve(oPos.to)\n\t\t\t\t//let txt = $e.parent.textBetween(0, $e.end() - $s.start(), ' '); // link text\n\t\t\t\tlet sel = new TextSelection.between($s, $e)\t\t\t\n\t\t\t// Focus editor\n\t\t\t\toView.focus({\n\t\t\t\t  preventScroll: true // this might be not yet supported by all browsers. also IE is using setActive to preventSrcoll (see prosemirror-view/index.js -> focus())\n\t\t\t\t});\n\t\t\t// Dispatch transaction (select link)\n\t\t\t\tif (opt_scroll_) {\n\t\t\t\t\toView.dispatch(oView.state.tr.setSelection(sel).scrollIntoView());\n\t\t\t\t} else {\n\t\t\t\t\toView.dispatch(oView.state.tr.setSelection(sel))\n\t\t\t\t}\n\n\t\t\t// Return success\n\t\t\treturn true;\n\n\t\t}\n\n\t// ============================================\n\t// dialog stuff\n\t// ============================================\n\t\n\t\t// change these - create dialog from here...\n\t\t\n\t\t_setCaretPosition(ctrl, pos) {\t\t    \n\t\t    if(ctrl != null) {\n\t\t        // Modern browsers\n\t\t\t\tif (ctrl.setSelectionRange) {\n\t\t\t\tctrl.focus();\n\t\t\t\tctrl.setSelectionRange(pos, pos);\n\n\t\t\t\t// IE8 and below\n\t\t\t\t} else if (ctrl.createTextRange) {\n\t\t\t\tvar range = ctrl.createTextRange();\n\t\t\t\trange.collapse(true);\n\t\t\t\trange.moveEnd('character', pos);\n\t\t\t\trange.moveStart('character', pos);\n\t\t\t\trange.select();\n\t\t\t\t}\n\n\t\t\t\tctrl.blur();\n\t\t\t\tctrl.focus();\n\t\t    }\n\t\t}\n\t\n\n\t\tinitLinkDialog()\n\t\t{\n\n\t\t\t// NEW\n\t\t    this.linkDialog = {\n\t\t\t\t\t    \t\tisOpen: false,\n\t\t\t\t\t\t\t\tp: document.createElement(\"div\"),\n\t\t\t\t\t\t\t\ti: document.createElement(\"input\"),\n\t\t\t\t\t\t\t\tc: document.createElement(\"button\"),\n\t\t\t\t\t\t\t\t// u: document.createElement(\"button\"),\n\t\t\t\t\t\t\t}\n\t\t\tthis.linkDialog.p.className = this.linkClassTop;\n\t\t\tthis.linkDialog.i.setAttribute(\"placeholder\", \"Link\\u2026\"); //URL, mailto:E-mail, phone:Tel. čislo, etc...\n\t\t\tthis.linkDialog.p.appendChild(this.linkDialog.i);\n\t\t\t\t// DODO: [link-2-file] implement uplaod for links\n\t\t\t\t// this.linkDialog.u.appendChild(getIcon(icons.upload,\"simpleeditor-menu-tooltip-icon\"));\n\t\t\t\t// this.linkDialog.p.appendChild(this.linkDialog.u);\n\t\t\tthis.linkDialog.c.appendChild(getIcon(icons.cancel,\"simpleeditor-menu-tooltip-icon\"));\t\t\t\n\t\t\tthis.linkDialog.p.appendChild(this.linkDialog.c);\n\n\n\t\t\t// console.log(this.linkDialog);\n\n\t\t\t\n\t\t}\n\t\n\n\t\tmShowDialog(oView, fn, oV)\n\t\t{\n\t\t\t// command puts oState, fnDispatch, oView\n\t\t\tif ( oV && oV.dispatch ) { oView = oV; }\n\n\t\t\tlet o = this.linkDialog;\n\t\t\t// already opened\n\t\t\t//console.error(\"check if is open but the same instance\")\n\t\t\tif ( o.isOpen ) { return; }\n\n\t\t\t// add to dom\n\t\t\t// this.aDomEdit.parentNode.appendChild(o.p);\n\t\t\tdocument.body.appendChild(o.p);\n\n\t\t\t// state changes with every update don't assign it in constructor\n\t\t\tlet oState = oView.state;\n\n\t\t\t// extend selection\n\t\t\tlet oPos = oState.selection;\n\t\t\t//if (!oState.selection.empty) { // we can now view link with cursor inside via keymap link cmd\n\t\t\t\tthis._mIsLink(oView, oPos) && ( oPos = this._mGetMarkPos(oState, 'link') );\n\t\t\t\tif (oPos.from == oPos.to) {\n\t\t\t\t\t// link is at the begingng\n\t\t\t\t\t// console.log(\"fix get parent postion\",oState.selection.$from, oPos.from)\n\t\t\t\t\tlet sFrom = oState.selection.$from;\n\t\t\t\t\toPos.from = sFrom.pos-sFrom.parentOffset;\n\t\t\t\t\t//console.log(\"fix get parent postion\",oState.selection.$from, oPos.from)\n\t\t\t\t}\n\t\t\t//}\n\t\t\t\n\t\t\tthis._mFillDialog(o, oState, oPos)\n\t\t\tthis._mPos(o.p, oView, oPos, true)\n\t\t\tthis._mOpenDialog(2, oPos);\n\n\t\t\t// remove event handler\n\t\t\to.c.removeEventListener('click', this.fnLinkDialogEvent);\n\t\t\to.i.removeEventListener('keyup', this.fnLinkDialogEvent);\n\t\t\t// set event handler\n\t\t\tthis.fnLinkDialogEvent = this._mEventDialog.bind(this, oView);\n\t\t\to.c.addEventListener('click', this.fnLinkDialogEvent);\n\t\t\to.i.addEventListener('keyup', this.fnLinkDialogEvent);\n\t\t}\n\n\t\t_mShowDialogFromDomEvent(oView, PseudoSelection)\n\t\t{\n\n\t\t\tlet o = this.linkDialog;\n\t\t\t// already opened\n\t\t\t// console.error(\"check if is open but the same instance\")\n\t\t\tif ( o.isOpen ) { return; }\n\n\t\t\t// add to dom\n\t\t\t// this.aDomEdit.parentNode.appendChild(o.p);\n\t\t\tdocument.body.appendChild(o.p);\n\n\t\t\t// state changes with every update don't assign it in constructor\n\t\t\tlet oState = oView.state;\n\n\t\t\tthis._mFillDialog(o, oState, PseudoSelection)\n\t\t\tthis._mPos(o.p, oView, PseudoSelection, true)\n\t\t\tthis._mOpenDialog(1,PseudoSelection);\n\n\t\t\t// remove event handler\n\t\t\to.c.removeEventListener('click', this.fnLinkDialogEvent);\n\t\t\to.i.removeEventListener('keyup', this.fnLinkDialogEvent);\n\t\t\t// set event handler\n\t\t\tthis.fnLinkDialogEvent = this._mEventDialog.bind(this, oView);\n\t\t\to.c.addEventListener('click', this.fnLinkDialogEvent);\n\t\t\to.i.addEventListener('keyup', this.fnLinkDialogEvent);\n\t\t}\n\n\t\t_mEventDialog(oView, e)\n\t\t{\t\t\n\t\t\t//console.log(\"close per event type: \",e.type);\n\n\t\t\t// prevent default click behaviour\n\t\t\te.preventDefault();\n\n\t\t\t// select action\n\t\t\tif (e.type == \"click\") {\t\t\t\n\t\t\t\tlet oPos =  this.selection; //{ from: oState.selection.from, to: oState.selection.to };\n\t\t\t\t// get whole mark positions if selection is not empty\n\t\t\t\t// if (!oView.state.selection.empty) {\n\t\t\t\t// \tthis._mIsLink(oView) && ( oPos = this._mGetMarkPos(oView.state, 'link') );\n\t\t\t\t// }\n\t\t\t\t//console.log(\"\\t-> dont close dialog\", oPos);\n\t\t\t\tthis._mSelect(oView,oPos);\n\t\t\t\t// close dialog\n\t\t\t\tthis._mCloseDialog(true);\t\t\t\n\t\t\t} else if (e.type == \"keyup\") {\n\t\t\t\tif (e.keyCode === 13) { //ENTER\n\t\t    \t\t//console.log(\"set link\");\n\t\t    \t\tthis._mCloseDialog(false, oView);\n\t\t    \t} else if (e.keyCode === 27) { //Esc\n\t\t    \t\t// close dialog and focus editor\n\t\t\t\t\t\t// this._mCloseDialog(true);\n\t\t\t\t\t\t// oView.focus();\n\t\t\t\t\t// same as close\n\t\t\t\t\t\tlet oPos =  this.selection; //{ from: oState.selection.from, to: oState.selection.to };\n\t\t\t\t\t\t//console.log(\"\\t-> create selection\", oPos);\n\t\t\t\t\t\tthis._mSelect(oView,oPos);\n\t\t\t\t\t\t// close dialog\n\t\t\t\t\t\tthis._mCloseDialog(true);\n\t\t    \t}\n\t    \t}\n\n\t\t}\n\t\t_mFillDialog(o, oState, optPseudoSelection)\n\t\t{\n\t\t\t// default setting\n\t\t\tlet oAttr = {\n\t\t\t\thref: '',\n\t\t\t\ttarget: '_blank'\n\t\t\t}\n\t\t\t// get attribute\n\t\t\tlet oMark = this._mGetMark(oState, 'link', optPseudoSelection)\n\t\t\toMark && ( oAttr = oMark.attrs );\n\n\t\t\t// fill dialog\n\t\t\t\t// o.address &&  (o.address.innerHTML = oAttr.href);\n\t\t\t\t// o.open.title = \"open \" + oAttr.href;\n\t\t\t\t// o.open.href = oAttr.href;\n\t\t\t\t// o.url.value = oAttr.href;\n\t\t\t\t// o.isTarget.checked = oAttr.target === '_blank';\n\t\t\t\n\t\t\t// NEW\n\t\t\t\t// add class before pos\n\t\t\t\to.p.classList.remove('dialog');\n\t\t\t\to.p.classList.add('dialog');\n\n\t\t\t\to.i.value = oAttr.href;\t\t\t\n\t\t\t\t\n\t\t}\n\t\t_mOpenDialog(n,oSelection)\n\t\t{\n\t\t\t// n=1 from tooltip, 2= from command\n\t\t\t\n\t\t\t// close edit menu\n\t\t\tthis.closeMenu();\n\n\t\t\tthis.selection = oSelection;\n\t\t\tlet o = this.linkDialog;\n\t\t\t// if ( o.isOpen ) { return; }\n\t\t\to.isOpen = true;\n\t\t\t\t// ORIG\n\t\t\t\t// o = o.p.classList;\n\t\t\t\t// o.remove('dialog');\n\t\t\t\t// o.add('dialog');\n\t\t\tthis._setCaretPosition(this.linkDialog.i,0);\n\t\t}\n\t\t_mCloseDialog(optDestroy_, oView)\n\t\t{\t\t\n\t\t\n\t\t\tlet o = this.linkDialog;\n\t\t\tif ( ! o.isOpen ) { return; }\n\t\t\t\n\t\t\t//console.log(\"remove dialog\");\n\t\t\t\n\t\t\to.isOpen = false;\n\t\t\to = o.p.classList;\n\t\t\to.remove('dialog');\n\n\t\t\t// remove event handler\n\t\t\tthis.linkDialog.c.removeEventListener('click', this.fnLinkDialogEvent);\n\t\t\tthis.linkDialog.i.removeEventListener('keyup', this.fnLinkDialogEvent);\n\t\t\t\n\t\t\tif (optDestroy_) {\n\t\t\t\t// destroy not set value and don't alter selection\n\t\t\t\t// Null oSel\n\t\t\t\tthis.selection = null;\n\t\t\t\t// remove dialog\n\t\t\t\t//this.linkDialog.p.remove();\n\t\t\t\tthis.linkDialog.p.parentNode.removeChild(this.linkDialog.p);\n\n\t\t\t\t//console.log(\"close and don't set value\");\n\t\t\t} else {\n\t\t\t\t// set value\n\t\t\t\t//console.log(\"set link\", this.selection); \n\t\t\t\t//set link\n\t\t\t\tthis.mSetLink(oView);\n\t\t\t\t// Null oSel\n\t\t\t\tthis.selection = null;\n\t\t\t\t// remove dialog\n\t\t\t\t//this.linkDialog.p.remove();\n\t\t\t\tthis.linkDialog.p.parentNode.removeChild(this.linkDialog.p);\n\t\t\t\t// Focus view - set with mSetLink\n\t\t\t\t// oView.focus();\n\t\t\t\t//console.log(\"close and set value\");\n\t\t\t}\t\t\n\t\t}\n}","import {keymap} from \"prosemirror-keymap\"\nimport {history} from \"prosemirror-history\"\nimport {baseKeymap} from \"prosemirror-commands\"\nimport {Plugin} from \"prosemirror-state\"\nimport {dropCursor} from \"prosemirror-dropcursor\"\nimport {gapCursor} from \"prosemirror-gapcursor\"\nimport {menuBar} from \"se-menu-basic\"\n\nimport {buildMenuItems} from \"./menu\"\nimport {buildKeymap} from \"./keymap\"\nimport {buildInputRules} from \"./inputrules\"\nimport {extensionPlugin} from \"./extension\"\n\n// MORE CUSTOM widgets -> if, then add to extension view: \n  // UPLOAD: https://prosemirror.net/examples/upload/\n  // LINT: https://prosemirror.net/examples/lint/\n  // FOOTNOTES: https://prosemirror.net/examples/footnote/\n  // TOOLTIP: https://prosemirror.net/examples/tooltip/\n  // BLOCKS: https://prosemirror.net/examples/schema/\n  // WIDGETS: https://pboysen.github.io, https://github.com/PierBover/prosemirror-cookbook\n  // TABLES: https://discuss.prosemirror.net/t/table-demo/584/15\n  \n\nexport {buildMenuItems, buildKeymap, buildInputRules}\n\n// !! This module exports helper functions for deriving a set of basic\n// menu items, input rules, or key bindings from a schema. These\n// values need to know about the schema for two reasons—they need\n// access to specific instances of node and mark types, and they need\n// to know which of the node and mark types that they know about are\n// actually present in the schema.\n//\n// The `customSetup` plugin ties these together into a plugin that\n// will automatically enable this basic functionality in an editor.\n\n// :: (Object) → [Plugin]\n// A convenience plugin that bundles together a simple menu with basic\n// key bindings, input rules, and styling for the example schema.\n// Probably only useful for quickly setting up a passable\n// editor—you'll need more control over your settings in most\n// real-world situations.\n//\n//   options::- The following options are recognized:\n//\n//     schema:: Schema\n//     The schema to generate key bindings and menu items for.\n//\n//     mapKeys:: ?Object\n//     Can be used to [adjust](#example-setup.buildKeymap) the key bindings created.\n//\n//     menuBar:: ?bool\n//     Set to false to disable the menu bar.\n//\n//     history:: ?bool\n//     Set to false to disable the history plugin.\n//\n//     floatingMenu:: ?bool\n//     Set to false to make the menu bar non-floating.\n//\n//     menuContent:: [[MenuItem]]\n//     Can be used to override the menu content.\nexport function setup(options, uploaderClass) {\n  \n  // Define plugings\n    \n    // Basic plugins\n    let plugins = [\n      buildInputRules(options.schema),\n      keymap(buildKeymap(options.schema, options.mapKeys)),\n      keymap(baseKeymap),\n      dropCursor(),\n      gapCursor()\n    ]\n\n    // Menu Bar plugin\n    let menuPlugin = menuBar({floating: options.floatingMenu !== false, content: options.menuContent || buildMenuItems(options.schema).fullMenu});\n    plugins.push(menuPlugin)\n\n    // History plugin\n    if (options.history !== false) { plugins.push(history()) }\n\n    // Extension pluging\n    plugins.push(extensionPlugin(options.schema,menuPlugin,uploaderClass))\n\n  // Return plugins \n    return plugins.concat(new Plugin({\n      props: {\n        attributes: {class: \"simpleeditor\"} //ProseMirror-example-setup-style\"}\n      }\n    }))\n}\n"],"names":["const","let","i","MenuItem","NodeSelection","toggleMark","icons","wrapInList","blockTypeItem","joinUpItem","liftItem","undoItem","redoItem","textblockTypeInputRule","wrappingInputRule","InputRule","smartQuotes","ellipsis","emDash","inputRules","undo","redo","$from","liftListItem","cmd_","undoInputRule","joinUp","joinDown","lift","selectParentNode","setBlockType","chainCommands","exitCode","Fragment","Slice","splitListItem","sinkListItem","tr","PluginKey","Plugin","DecorationSet","Decoration","deco","widget_rect","brect","pset","widget_svg","getIcon","el_","remove_decorations","decorations","el_child_","wrap_pos","TextSelection","this","oPos","keymap","baseKeymap","dropCursor","gapCursor","menuBar","history"],"mappings":";;;;;;;;;;;;;;;;AAAAA,IAAM,MAAM,GAAG,sBAAqB;AACpC;AACO,SAAS,UAAU,CAAC,OAAO,EAAE;AACpC,EAAEC,IAAI,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,EAAC;AACxE,EAAE,OAAO,CAAC,SAAS,GAAG,OAAM;AAC5B;AACA,EAAEA,IAAI,YAAY,aAAG,GAAK,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,IAAE,KAAK,KAAE,GAAE;AACtE,EAAE,UAAU,sBAAO,MAAM,CAAC,gBAAgB,CAAC,WAAW,EAAE,YAAY,IAAC,EAAE,EAAE,EAAC;AAC1E,EAAEA,IAAI,KAAK,eAAS;AACpB,IAAI,MAAM,CAAC,mBAAmB,CAAC,WAAW,EAAE,YAAY,EAAC;AACzD,IAAI,IAAI,OAAO,CAAC,UAAU,IAAE,OAAO,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,IAAC;AACnE,IAAG;AACH;AACA,EAAEA,IAAI,SAAS,GAAG,GAAE;AACpB,EAAE,KAAKA,IAAI,IAAI,IAAI,OAAO,CAAC,MAAM,IAAE,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE,IAAC;AAChF;AACA,EAAEA,IAAI,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,EAAC;AACrD,EAAE,YAAY,CAAC,IAAI,GAAG,SAAQ;AAC9B,EAAE,YAAY,CAAC,SAAS,GAAG,MAAM,GAAG,UAAS;AAC7C,EAAE,YAAY,CAAC,WAAW,GAAG,KAAI;AACjC,EAAEA,IAAI,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,EAAC;AACrD,EAAE,YAAY,CAAC,IAAI,GAAG,SAAQ;AAC9B,EAAE,YAAY,CAAC,SAAS,GAAG,MAAM,GAAG,UAAS;AAC7C,EAAE,YAAY,CAAC,WAAW,GAAG,SAAQ;AACrC,EAAE,YAAY,CAAC,gBAAgB,CAAC,OAAO,EAAE,KAAK,EAAC;AAC/C;AACA,EAAEA,IAAI,IAAI,GAAG,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,EAAC;AAChE,EAAE,IAAI,OAAO,CAAC,KAAK,IAAE,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,GAAG,OAAO,CAAC,QAAK;AAC/F,EAAE,SAAS,CAAC,OAAO,WAAC,OAAS;AAC7B,IAAI,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC,WAAW,CAAC,KAAK,EAAC;AACtE,GAAG,EAAC;AACJ,EAAEA,IAAI,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,EAAC;AAC/D,EAAE,OAAO,CAAC,SAAS,GAAG,MAAM,GAAG,WAAU;AACzC,EAAE,OAAO,CAAC,WAAW,CAAC,YAAY,EAAC;AACnC,EAAE,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,GAAG,CAAC,EAAC;AACnD,EAAE,OAAO,CAAC,WAAW,CAAC,YAAY,EAAC;AACnC;AACA,EAAEA,IAAI,GAAG,GAAG,OAAO,CAAC,qBAAqB,GAAE;AAC3C,EAAE,OAAO,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,MAAM,CAAC,WAAW,GAAG,GAAG,CAAC,MAAM,IAAI,CAAC,IAAI,KAAI;AACpE,EAAE,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,CAAC,MAAM,CAAC,UAAU,GAAG,GAAG,CAAC,KAAK,IAAI,CAAC,IAAI,KAAI;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIA,IAAI,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,EAAC;AACnD,IAAI,SAAS,CAAC,IAAI,GAAG,OAAM;AAC3B,IAAI,SAAS,CAAC,QAAQ,GAAG,IAAI,CAAC;AAC9B,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;AAChC;AACA;AACA,IAAIA,IAAI,MAAM,eAAS;AACvB,MAAMA,IAAI,MAAM,GAAG,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,SAAS,EAAC;AACvD,MAAM,IAAI,MAAM,EAAE;AAClB,QAAQ,KAAK,GAAE;AACf;AACA,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACzD,UAAU,OAAO,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC/C,SACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,MAAK;AACL;AACA,EAAE,IAAI,CAAC,gBAAgB,CAAC,QAAQ,YAAE,GAAK;AACvC,IAAI,CAAC,CAAC,cAAc,GAAE;AACtB,IAAI,MAAM,GAAE;AACZ,GAAG,EAAC;AACJ;AACA,EAAE,IAAI,CAAC,gBAAgB,CAAC,SAAS,YAAE,GAAK;AACxC,IAAI,IAAI,CAAC,CAAC,OAAO,IAAI,EAAE,EAAE;AACzB,MAAM,CAAC,CAAC,cAAc,GAAE;AACxB,MAAM,KAAK,GAAE;AACb,KAAK,MAAM,IAAI,CAAC,CAAC,OAAO,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE;AAC3E,MAAM,CAAC,CAAC,cAAc,GAAE;AACxB,MAAM,MAAM,GAAE;AACd,KAAK,MAAM,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC,EAAE;AAC/B,MAAM,MAAM,CAAC,UAAU,aAAO;AAC9B,QAAQ,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAE,KAAK,KAAE;AAC9D,OAAO,EAAE,GAAG,EAAC;AACb,KAAK;AACL,GAAG,EAAC;AACJ;AACA,EAAEA,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAC;AAC9B,EAAE,IAAI,KAAK,IAAE,KAAK,CAAC,KAAK,KAAE;AAC1B,CAAC;AACD;AACA,SAAS,SAAS,CAAC,MAAM,EAAE,SAAS,EAAE;AACtC,EAAEA,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,EAAC;AACzC,EAAE,KAAKA,IAAI,IAAI,IAAI,MAAM,EAAE;AAC3B,IAAIA,IAAI,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,SAAS,CAAC,CAAC,EAAE,EAAC;AAClD,IAAIA,IAAI,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,KAAK,CAAC,QAAQ,CAAC,KAAK,EAAC;AAC5D,IAAI,IAAI,GAAG,EAAE;AACb,MAAM,aAAa,CAAC,GAAG,EAAE,GAAG,EAAC;AAC7B,MAAM,OAAO,IAAI;AACjB,KAAK;AACL,IAAI,MAAM,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC,KAAK,EAAC;AACrC,GAAG;AACH,EAAE,OAAO,MAAM;AACf,CAAC;AACD;AACA,SAAS,aAAa,CAAC,GAAG,EAAE,OAAO,EAAE;AACrC;AACA,EAAEA,IAAI,MAAM,GAAG,GAAG,CAAC,WAAU;AAC7B,EAAEA,IAAI,GAAG,GAAG,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,EAAC;AAC7D,EAAE,GAAG,CAAC,KAAK,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,UAAU,GAAG,GAAG,CAAC,WAAW,GAAG,CAAC,IAAI,KAAI;AAChE,EAAE,GAAG,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,SAAS,GAAG,CAAC,IAAI,KAAI;AAC5C,EAAE,GAAG,CAAC,SAAS,GAAG,uBAAsB;AACxC,EAAE,GAAG,CAAC,WAAW,GAAG,QAAO;AAC3B,EAAE,UAAU,sBAAO,MAAM,CAAC,WAAW,CAAC,GAAG,IAAC,EAAE,IAAI,EAAC;AACjD,CAAC;AACD;AACA;AACO,IAAM,KAAK,GAiBhB,cAAW,CAAC,OAAO,EAAE,EAAE,IAAI,CAAC,OAAO,GAAG,QAAO,GAAE;AACjD;AACE;AACA;AACF;AACE;AACA;gBACA,sBAAK,GAAG,EAAE,EAAE,OAAO,GAAG,CAAC,KAAK,GAAE;AAChC;AACE;AACA;gBACA,sCAAa,MAAM,EAAE,GAAE;AACzB;gBACE,8BAAS,KAAK,EAAE;AAClB,EAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC,QAAQ;AACvC,MAAM,OAAO,kBAAgB;AAC7B,EAAI,OAAO,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAI,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AAC5F,EAAC;AACH;gBACE,wBAAM,KAAK,EAAE;AACf,EAAI,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,KAAK;AAC/D,EACD;AACD;AACA;AACO,IAAM,SAAS;;;;;;;;;sBACpB,4BAAS;AACX,IAAIA,IAAI,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,EAAC;AAC/C,IAAI,KAAK,CAAC,IAAI,GAAG,OAAM;AACvB,IAAI,KAAK,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,MAAK;AAC1C,IAAI,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,IAAI,GAAE;AAC1C,IAAI,KAAK,CAAC,YAAY,GAAG,MAAK;AAC9B,IAAI,OAAO,KAAK;AAChB;;;EAR+B;;ACnK/B;AACA;AACA,SAAS,SAAS,CAAC,KAAK,EAAE,QAAQ,EAAE;AACpC;AACA,EAAEA,IAAI,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,MAAK;AACnC,EAAE,KAAKA,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACzC,IAAIA,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,EAAC;AAC9B,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,KAAK,EAAE,KAAK,EAAE,QAAQ,CAAC,IAAE,OAAO,MAAI;AACzE,GAAG;AACH,EAAE,OAAO,KAAK;AACd,CAAC;AACD;AACA,SAAS,WAAW,CAAC,GAAG,EAAE,MAAM,EAAE,IAAI,EAAE;AACxC,4BAA0C;AAC1C,WAAoB,GAAG,MAAM,CAAC,CAAC;IAAtB;IAAO,kBAAgB;AAChC,IAAIA,IAAI,GAAG,GAAG,KAAK,CAAC,KAAK,IAAI,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,MAAK;AACtE,IAAI,GAAG,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,YAAE,MAAQ;AACjD,MAAM,IAAI,GAAG,IAAE,OAAO,OAAK;AAC3B,MAAM,GAAG,GAAG,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,EAAC;AAChE,KAAK,EAAC;AACN,IAAI,IAAI,GAAG,IAAE,YAAO,QAAI;AACxB;;EARE,KAAKA,IAAIC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE;;;;GAQrC;AACH,EAAE,OAAO,KAAK;AACd,CAAC;AACD;AACA,SAAS,aAAa,CAAC,KAAK,EAAE,QAAQ,EAAE;AACxC;AACA;AACA,IAAID,IAAI,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;AAC/C;AACA,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5C;AACA,MAAM,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;AACnF,QAAQ,OAAO,KAAK,CAAC;AACrB,OAAO;AACP,KAAK;AACL;AACA,WAAgC,GAAG,KAAK,CAAC;IAAhC;IAAO;IAAS,wBAAyB;AAClD,IAAI,IAAI,CAAC,KAAK,IAAI,CAAC,OAAO,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,GAAG,EAAE,MAAM,EAAE,QAAQ,CAAC,IAAE,OAAO,OAAK;AACtF;AACA;AACA,IAAI,IAAI,CAAC,KAAK,EAAE;AAChB,MAAMA,IAAI,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AAC7E;AACA,MAAM,IAAI,OAAO,EAAE,IAAI,EAAE;AACzB,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACjD;AACA,UAAU,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;AACzF,YAAY,OAAO,KAAK,CAAC;AACzB,WAAW;AACX,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA,IAAI,OAAO,IAAI;AACf,CAAC;AACD;AACA;AACA,AAAO,SAAS,cAAc,CAAC,KAAK,EAAE,QAAQ,EAAE;AAChD;AACA,EAAEA,IAAI,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,MAAK;AACnC,EAAE,KAAKA,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACzC,IAAIA,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,EAAC;AAC9B,IAAI,IAAI,OAAO,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,WAAW,EAAE;AAC7D;AACA,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE;AACpE,QAAQ,OAAO,KAAK,CAAC;AACrB,OAAO,MAAM;AACb,QAAQ,OAAO,IAAI,CAAC;AACpB,OAAO;AACP,KAAK,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,KAAK,EAAE;AACjD;AACA,MAAM,OAAO,IAAI;AACjB,KAAK;AACL,GAAG;AACH,EAAE,OAAO,KAAK;AACd,CAAC;AACD;AACA,SAAS,eAAe,CAAC,QAAQ,EAAE;AACnC,EAAE,OAAO,IAAIE,oBAAQ,CAAC;AACtB,IAAI,KAAK,EAAE,cAAc;AACzB,IAAI,KAAK,EAAE,OAAO;AAClB,IAAI,uBAAM,CAAC,KAAK,EAAE;AAClB,MAAM,OAAO,SAAS,CAAC,KAAK,EAAE,QAAQ,CAAC;AACvC,KAAK;AACL,IAAI,iBAAG,CAAC,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE;AACxB,aAAoB,GAAG,KAAK,CAAC;MAAlB;MAAM;MAAqB,IAAE,KAAK,GAAG,KAAI;AACpD,MAAM,IAAI,KAAK,CAAC,SAAS,YAAYC,8BAAa,IAAI,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,IAAI,QAAQ;AAC3F,UAAQ,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,QAAK;AAC1C,MAAM,UAAU,CAAC;AACjB,QAAQ,KAAK,EAAE,cAAc;AAC7B,QAAQ,MAAM,EAAE;AAChB,UAAU,GAAG,EAAE,IAAI,SAAS,CAAC,CAAC,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;AAC5F,UAAU,KAAK,EAAE,IAAI,SAAS,CAAC,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC,CAAC;AAC7E,UAAU,GAAG,EAAE,IAAI,SAAS,CAAC,CAAC,KAAK,EAAE,aAAa;AAClD,8BAA8B,KAAK,EAAE,KAAK,GAAG,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC;AAC/F,SAAS;AACT;AACA,QAAQ,2BAAQ,CAAC,IAAI,EAAE;AACvB;AACA,cAAcH,IAAI,EAAE,GAAG,EAAE,CAAC;AAC1B;AACA;AACA;AACA,cAAcA,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;AACzE;AACA;AACA,cAAcA,IAAI,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC;AACrC,cAAcA,IAAI,IAAI,GAAG,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC;AAC3C,cAAc,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,GAAG,EAAE,KAAC,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC,EAAC;AACzD;AACA,cAAc,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAC;AAC/B,cAAc,IAAI,CAAC,KAAK,GAAE;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,UAAU,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE;AACnD,gBAAgB,IAAI,GAAG,GAAG,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,EAAE,OAAO,CAAC,CAAC;AACjF;AACA;AACA,gBAAgB,IAAI,GAAG,IAAI,IAAI,EAAE,EAAE,MAAM,EAAE;AAC3C;AACA;AACA,gBAAgB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;AAC3C,+BAA+B,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;AACjF,+BAA+B,OAAO,CAAC,OAAO,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACrE,eAAe,EAAE,YAAY;AAC7B;AACA,gBAAgB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AAClF,eAAe,CAAC,CAAC;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,EAAC;AACR,KAAK;AACL,GAAG,CAAC;AACJ,CAAC;AACD;AACA;AACA;AACA;AACA,SAAS,UAAU,CAAC,IAAI,EAAE;AAC1B,EAAE,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC;AAC9B,EAAE,OAAO,IAAI,OAAO,CAAC,UAAU,MAAM,EAAE,IAAI,EAAE;AAC7C,IAAI,MAAM,CAAC,MAAM,GAAG,YAAY,EAAE,OAAO,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC;AAClE,IAAI,MAAM,CAAC,OAAO,GAAG,YAAY,EAAE,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC;AAChE;AACA,IAAI,UAAU,CAAC,YAAY;AAC3B;AACA,MAAM,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE,CAAC;AAC9C,MAAM,OAAO,CAAC,GAAG,CAAC,qBAAqB,EAAE,CAAC,EAAC;AAC3C,MAAM,IAAI,CAAC,EAAE,CAAC,EAAE;AAChB,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AAChC,OAAO;AACP;AACA,MAAM,OAAO,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;AACxC,KAAK,EAAE,IAAI,CAAC,CAAC;AACb,GAAG,CAAC;AACJ,CAAC;AACD;AACA,SAAS,OAAO,CAAC,GAAG,EAAE,OAAO,EAAE;AAC/B,EAAEA,IAAI,aAAa,GAAG;AACtB,IAAI,KAAK,EAAE,OAAO,CAAC,KAAK;AACxB,IAAI,GAAG,EAAE,GAAG;AACZ,IAAG;AACH,EAAE,KAAKA,IAAI,IAAI,IAAI,OAAO,IAAE,aAAa,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,IAAI,IAAC;AAC/D,EAAE,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,IAAI,OAAO,CAAC,MAAM,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM;AACrE,MAAI,aAAa,CAAC,OAAO,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC,aAAG,gBAAS,GAAG,CAAC,KAAK,OAAC;AAC7E;AACA,EAAE,OAAO,IAAIE,oBAAQ,CAAC,aAAa,CAAC;AACpC,CAAC;AACD;AACA,AAAO,SAAS,UAAU,CAAC,KAAK,EAAE,IAAI,EAAE;AACxC,SAA8B,GAAG,KAAK,CAAC;EAAhC;EAAM;EAAO;EAAI,sBAAwB;AAChD,EAAE,IAAI,KAAK,IAAE,OAAO,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,WAAW,IAAI,KAAK,CAAC,KAAK,EAAE,GAAC;AACpE,SAAO,OAAO,KAAK,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,EAAE,EAAE,EAAE,IAAI,GAAC;AACpD,CAAC;AACD;AACA,SAAS,QAAQ,CAAC,QAAQ,EAAE,OAAO,EAAE;AACrC,EAAEF,IAAI,aAAa,GAAG;AACtB,IAAI,uBAAM,CAAC,KAAK,EAAE,EAAE,OAAO,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE;AACxD,IAAI,MAAM,EAAEI,8BAAU,CAAC,QAAQ,CAAC,gBAAM,gBAAS,aAAa,CAAC,KAAK,EAAE,QAAQ,IAAC,EAAE;AAC/E;AACA,IAAI,uBAAM,CAAC,KAAK,EAAE;AAClB,MAAM,OAAO,aAAa,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;AAC5C;AACA,KAAK;AACL,IAAG;AACH,EAAE,KAAKJ,IAAI,IAAI,IAAI,OAAO,IAAE,aAAa,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,IAAI,IAAC;AAC/D,EAAE,OAAO,OAAO,CAACI,8BAAU,CAAC,QAAQ,CAAC,EAAE,aAAa,CAAC;AACrD,CAAC;AACD;AACA,SAAS,QAAQ,CAAC,QAAQ,EAAE;AAC5B,EAAE,OAAO,IAAIF,oBAAQ,CAAC;AACtB,IAAI,KAAK,EAAE,cAAc;AACzB,IAAI,IAAI,EAAEG,iBAAK,CAAC,IAAI;AACpB,IAAI,uBAAM,CAAC,KAAK,EAAE,EAAE,OAAO,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE;AACxD,IAAI,MAAM,EAAED,8BAAU,CAAC,QAAQ,CAAC,gBAAM,iBAAU,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,IAAI,cAAc,CAAC,KAAK,EAAE,QAAQ,CAAC;AAC1G,cAAc,cAAc,CAAC,KAAK,EAAE,QAAQ,CAAC,IAAI,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE,IAAC,EAAE;AACjF,IAAI,uBAAM,CAAC,KAAK,EAAE;AAClB;AACA;AACA;AACA;AACA;AACA,QAAQ,QAAQ,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,IAAI,cAAc,CAAC,KAAK,EAAE,QAAQ,CAAC;AAC1E,cAAc,cAAc,CAAC,KAAK,EAAE,QAAQ,CAAC,IAAI,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE;AAC9E,WAAW;AACX,KAAK;AACL;AACA,IAAI,iBAAG,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,QAAQ,EAAE;AACzC;AACA;AACA,QAAQJ,IAAI,OAAO,GAAG,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;AAC9D;AACA;AACA,QAAQ,IAAI,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE;AACzC;AACA;AACA,UAAU,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;AACxC,UAAU,OAAO,IAAI;AACrB,SAAS;AACT;AACA,QAAQ,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG,CAAC;AACJ,CAAC;AACD;AACA,SAAS,YAAY,CAAC,QAAQ,EAAE,OAAO,EAAE;AACzC,EAAE,OAAO,OAAO,CAACM,gCAAU,CAAC,QAAQ,EAAE,OAAO,CAAC,KAAK,CAAC,EAAE,OAAO,CAAC;AAC9D,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AAAO,SAAS,cAAc,CAAC,MAAM,EAAE;AACvC,EAAEN,IAAI,CAAC,GAAG,EAAE,EAAE,KAAI;AAClB,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,MAAM;AAChC,MAAI,CAAC,CAAC,YAAY,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAEK,iBAAK,CAAC,MAAM,CAAC,IAAC;AACzE,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,EAAE;AAC5B,MAAI,CAAC,CAAC,QAAQ,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAEA,iBAAK,CAAC,EAAE,CAAC,IAAC;AACjE,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,SAAS;AACnC,MAAI,CAAC,CAAC,eAAe,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAEA,iBAAK,CAAC,SAAS,CAAC,IAAC;AAC/E,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI;AAC9B,MAAI,CAAC,CAAC,UAAU,GAAG,QAAQ,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,EAAEA,iBAAK,CAAC,IAAI,CAAC,IAAC;AACrE,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI;AAC9B,MAAI,CAAC,CAAC,UAAU,GAAG,QAAQ,CAAC,IAAI,IAAC;AACjC;AACA,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK;AAC/B,MAAI,CAAC,CAAC,WAAW,GAAG,eAAe,CAAC,IAAI,IAAC;AACzC,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,WAAW;AACrC,MAAI,CAAC,CAAC,cAAc,GAAG,YAAY,CAAC,IAAI,EAAE;AAC1C,MAAM,KAAK,EAAE,cAAc;AAC3B,MAAM,IAAI,EAAEA,iBAAK,CAAC,UAAU;AAC5B,KAAK,IAAC;AACN,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,YAAY;AACtC,MAAI,CAAC,CAAC,eAAe,GAAG,YAAY,CAAC,IAAI,EAAE;AAC3C,MAAM,KAAK,EAAE,cAAc;AAC3B,MAAM,IAAI,EAAEA,iBAAK,CAAC,WAAW;AAC7B,KAAK,IAAC;AACN,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,EAAE;AACtC;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC,CAAC,cAAc,GAAGE,yBAAa,CAAC,IAAI,EAAE;AAC3C,MAAM,KAAK,EAAE,cAAc;AAC3B,MAAM,IAAI,EAAEF,iBAAK,CAAC,UAAU;AAC5B,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,EAAC;AAC9B,GAAG;AACH,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,SAAS;AACnC,MAAI,CAAC,CAAC,aAAa,GAAGE,yBAAa,CAAC,IAAI,EAAE;AAC1C,MAAM,KAAK,EAAE,cAAc;AAC3B,MAAM,KAAK,EAAE,OAAO;AACpB,KAAK,IAAC;AACN,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU;AACpC,MAAI,CAAC,CAAC,aAAa,GAAGA,yBAAa,CAAC,IAAI,EAAE;AAC1C,MAAM,KAAK,EAAE,cAAc;AAC3B,MAAM,KAAK,EAAE,MAAM;AACnB,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,IAAC;AAC9B,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAI,KAAKP,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE;AACvE,QAAM,CAAC,CAAC,UAAU,IAAI,CAAC,CAAC,CAAC,GAAGO,yBAAa,CAAC,IAAI,EAAE;AAChD,QAAQ,KAAK,EAAE,aAAa,IAAI,CAAC,CAAC;AAClC;AACA,QAAQ,IAAI,EAAEF,iBAAK,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC;AACnC,QAAQ,KAAK,EAAE,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AAC7B,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,MAAC;AAChC,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,eAAe,EAAE;AAC3C,IAAIL,IAAI,EAAE,GAAG,KAAI;AACjB,IAAI,CAAC,CAAC,oBAAoB,GAAG,IAAIE,oBAAQ,CAAC;AAC1C,MAAM,KAAK,EAAE,wBAAwB;AACrC,MAAM,KAAK,EAAE,iBAAiB;AAC9B;AACA;AACA;AACA,MAAM,uBAAM,CAAC,KAAK,EAAE,EAAE,OAAO,cAAc,CAAC,KAAK,EAAE,EAAE,CAAC,EAAE;AACxD,MAAM,iBAAG,CAAC,KAAK,EAAE,QAAQ,EAAE,EAAE,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,oBAAoB,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,EAAC,EAAE;AACnF,KAAK,EAAC;AACN,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIF,IAAI,GAAG,aAAG,cAAO,GAAG,CAAC,MAAM,WAAC,YAAK,IAAC,KAAC;AACvC;AACA,IAAI,CAAC,CAAC,QAAQ,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,EAAC;AACtG,IAAI,CAAC,CAAC,UAAU,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC,UAAU,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,EAAC;AACrG;AACA,IAAI,CAAC,CAAC,SAAS,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,cAAc,EAAE,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC,cAAc,EAAEQ,sBAAU;AACzF,wBAAwBC,oBAAQ,CAAC,CAAC,EAAC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,IAAI,KAAK,EAAE,EAAE;AACjB,MAAM,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAACC,oBAAQ,EAAEC,oBAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,EAAC;AACvF,KAAK,MAAM;AACX,MAAM,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,SAAS,EAAC;AAC/D,KAAK;AACL;AACA,EAAE,OAAO,CAAC;AACV,CAAC;AACD;AACA,SAAS,KAAK,GAAG;AACjB,MAAM,IAAI,OAAO,SAAS,IAAI,WAAW,IAAE,OAAO,OAAK;AACvD,MAAMX,IAAI,KAAK,GAAG,SAAS,CAAC,UAAS;AACrC,MAAM,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC;AAC9F,CAAC;;ACxcD;AACA;AACA;AACA,AAAO,SAAS,cAAc,CAAC,QAAQ,EAAE;AACzC;AACA,EAAE,OAAOY,4CAAsB,CAAC,UAAU,EAAE,QAAQ,CAAC;AACrD,CAAC;AACD;AACA;AACA;AACA;AACA,AAAO,SAAS,eAAe,CAAC,QAAQ,EAAE;AAC1C,EAAE,OAAOC,uCAAiB,CAAC,aAAa,EAAE,QAAQ,YAAE,iBAAU,CAAC,KAAK,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAC;AACjF,qCAA4B,KAAK,EAAE,IAAI,WAAK,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,CAAC,IAAC,CAAC;AAC5F,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,AAAO,SAAS,cAAc,CAAC,QAAQ,EAAE;AACzC,EAAE,OAAOA,uCAAiB,CAAC,gBAAgB,EAAE,QAAQ,CAAC;AACtD,CAAC;AACD;AACA;AACA;AACA;AACA,AAAO,SAAS,aAAa,CAAC,QAAQ,EAAE;AACxC,EAAE,OAAOD,4CAAsB,CAAC,OAAO,EAAE,QAAQ,CAAC;AAClD,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,AAAO,SAAS,WAAW,CAAC,QAAQ,EAAE,QAAQ,EAAE;AAChD,EAAE,OAAOA,4CAAsB,CAAC,IAAI,MAAM,CAAC,QAAQ,GAAG,QAAQ,GAAG,QAAQ,CAAC;AAC1E,gCAAgC,QAAQ,YAAE,iBAAU,CAAC,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,IAAC,CAAC;AACnF,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,aAAa,CAAC,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE;AACnD,EAAE,OAAO,IAAIE,+BAAS,CAAC,MAAM,YAAG,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAK;AAC7D;AACA;AACA,IAAId,IAAI,MAAM,GAAG,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,EAAC;AACzC,IAAIA,IAAI,KAAK,GAAG,QAAQ,YAAY,QAAQ,GAAG,QAAQ,CAAC,KAAK,CAAC,GAAG,SAAQ;AACzE;AACA;AACA,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAE,OAAO,MAAI;AACjE;AACA;AACA,IAAID,IAAM,SAAS,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;AAClD,IAAIA,IAAM,WAAW,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;AACrF,IAAI,IAAI,SAAS,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE;AAC3D;AACA,MAAM,OAAO,IAAI,CAAC;AAClB,KAAK;AACL,IAAI,IAAI,SAAS,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,GAAG,WAAW,CAAC,MAAM,EAAE;AACzD;AACA,MAAM,OAAO,IAAI,CAAC;AAClB,KAAK;AACL;AACA;AACA,IAAIC,IAAI,KAAK,GAAG,EAAE,CAAC;AACnB,IAAI,QAAQ,QAAQ,CAAC,IAAI;AACzB,MAAM,KAAK,MAAM;AACjB,QAAQ,KAAK,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,IAAI,EAAE,IAAI,EAAE,SAAS,CAAC,WAAW,EAAE,GAAG,EAAE,IAAI,EAAE,WAAW,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC;AAClH,MAAM,MAAM;AACZ,KAAK;AACL;AACA;AACA,IAAID,IAAM,KAAK,GAAG,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACzC,IAAIA,IAAM,UAAU,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;AAChC,IAAIA,IAAM,IAAI,GAAG;AACjB,MAAM,IAAI,EAAE,KAAK;AACjB,MAAM,EAAE,EAAE,GAAG;AACb,MAAK;AACL;AACA;AACA,IAAIC,IAAI,EAAE,IAAI,KAAK,CAAC,EAAE,CAAC;AACvB,IAAI,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,QAAQ,EAAC;AACzD,IAAI,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,KAAK,EAAC;AACnD,IAAI,EAAE,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,EAAC;AACrC;AACA;AACA,IAAI,OAAO,EAAE,CAAC;AACd,GAAG,CAAC;AACJ,CAAC;AACD;AACA;AACA;AACA;AACA,AAAO,SAAS,QAAQ,CAAC,QAAQ,EAAE,UAAU,EAAE;AAC/C;AACA,EAAE,IAAI,UAAU,EAAE;AAClB;AACA,IAAI,OAAO,aAAa,CAAC,gLAAgL;AACzM,kCAAkC,QAAQ,YAAE,iBAAU,CAAC,IAAI,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,GAAG,EAAE,OAAO,CAAC,KAAK,CAAC,EAAE,IAAC,CAAC;AAChG,GAAG,MAAM;AACT;AACA,IAAI,OAAO,aAAa,CAAC,qLAAqL;AAC9M,kCAAkC,QAAQ,YAAE,iBAAU,CAAC,IAAI,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,GAAG,EAAE,OAAO,CAAC,KAAK,CAAC,EAAE,IAAC,CAAC;AAChG,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA,AAAO,SAAS,eAAe,CAAC,MAAM,EAAE;AACxC;AACA,EAAEA,IAAI,KAAK,GAAGe,iCAAW,CAAC,MAAM,CAACC,8BAAQ,EAAEC,4BAAM,CAAC,EAAE,KAAI;AACxD,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,IAAE,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAC;AACtE,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,YAAY,IAAE,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAC;AACzE,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,WAAW,IAAE,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAC;AACvE,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,IAAE,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAC;AACrE,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,IAAE,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAC;AAC3G,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,IAAE,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAC;AAC1D,EAAE,OAAOC,gCAAU,CAAC,QAAC,KAAK,CAAC,CAAC;AAC5B,CAAC;;AC1JDnB,IAAM,GAAG,GAAG,OAAO,SAAS,IAAI,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,MAAK;AACpF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AAAO,SAAS,WAAW,CAAC,MAAM,EAAE,OAAO,EAAE;AAC7C,EAAEC,IAAI,IAAI,GAAG,EAAE,EAAE,KAAI;AACrB,EAAE,SAAS,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE;AAC1B,IAAI,IAAI,OAAO,EAAE;AACjB,MAAMA,IAAI,MAAM,GAAG,OAAO,CAAC,GAAG,EAAC;AAC/B,MAAM,IAAI,MAAM,KAAK,KAAK,IAAE,QAAM;AAClC,MAAM,IAAI,MAAM,IAAE,GAAG,GAAG,SAAM;AAC9B,KAAK;AACL,IAAI,IAAI,CAAC,GAAG,CAAC,GAAG,IAAG;AACnB,GAAG;AACH;AACA;AACA;AACA,EAAE,IAAI,CAAC,OAAO,EAAEmB,uBAAI,EAAC;AACrB,EAAE,IAAI,CAAC,aAAa,EAAEC,uBAAI,EAAC;AAC3B;AACA;AACA;AACA,IAAI,IAAI,CAAC,WAAW,WAAE,KAAK,EAAE,QAAQ,EAAK;AAC1C;AACA;AACA,UAAUpB,IAAI,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,MAAK;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,KAAKA,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACjD,YAAYA,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,EAAC;AACtC,YAAYA,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,EAAC;AACpC;AACA;AACA,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,IAAI,WAAW,EAAE;AAC9C;AACA,uBAAgC,GAAG,KAAK,CAAC;gBAApB;gBAAO,kBAAsB;AAClD,gBAAgBA,IAAI,KAAK,GAAGqB,OAAK,CAAC,UAAU,CAAC,GAAG,YAAE,eAAQ,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,MAAM,CAAC,KAAK,CAAC,YAAS,EAAC;AAC5H,gBAAgB,IAAI,KAAK,EAAE;AAC3B;AACA;AACA;AACA;AACA;AACA,kBAAkB,IAAI,KAAK,CAAC,SAAS,CAAC,KAAK,IAAI,IAAI,CAAC,UAAU,GAAG,CAAC;AAClE,iCAAiC,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,YAAY,IAAI,CAAC;AAC1E,iCAAiC,KAAK,CAAC,UAAU,IAAI,CAAC;AACtD,kCAAkC,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,IAAI,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC;AACxJ,gCAAgC;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,IAAI,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,EAAE;AACnE;AACA,wBAAwBrB,IAAI,IAAI,GAAGsB,kCAAY,CAAC,IAAI,CAAC,IAAI,EAAC;AAC1D,wBAAwB,OAAO,IAAI,CAAC,KAAK,EAAE,QAAQ,CAAC;AACpD,uBAAuB,MAAM,IAAI,KAAK,EAAE,CAAC,EAAE;AAC3C;AACA,wBAAwBtB,IAAIuB,MAAI,GAAGD,kCAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC3D,wBAAwB,OAAOC,MAAI,CAAC,KAAK,EAAE,QAAQ,CAAC;AACpD,uBAAuB,AAEA;AACvB,mBAAmB;AACnB;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,WAAW;AACX;AACA;AACA,UAAU,OAAOC,mCAAa,CAAC,KAAK,EAAE,QAAQ,CAAC;AAC/C,KAAK,EAAC;AACN;AACA;AACA,EAAE,IAAI,CAAC,OAAO,EAAEJ,uBAAI,EAAC;AACrB;AACA,EAAE,IAAI,CAAC,aAAa,EAAEK,0BAAM,EAAC;AAC7B,EAAE,IAAI,CAAC,eAAe,EAAEC,4BAAQ,EAAC;AACjC,EAAE,IAAI,CAAC,iBAAiB,EAAEC,wBAAI,EAAC;AAC/B,EAAE,IAAI,CAAC,QAAQ,EAAEC,oCAAgB,EAAC;AAClC;AACA,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,MAAM;AAChC,MAAI,IAAI,CAAC,OAAO,EAAExB,8BAAU,CAAC,IAAI,CAAC,IAAC;AACnC,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,EAAE;AAC5B,MAAI,IAAI,CAAC,OAAO,EAAEA,8BAAU,CAAC,IAAI,CAAC,IAAC;AACnC,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,SAAS;AACnC,MAAI,IAAI,CAAC,OAAO,EAAEA,8BAAU,CAAC,IAAI,CAAC,IAAC;AACnC,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI;AAC9B,MAAI,IAAI,CAAC,OAAO,EAAEA,8BAAU,CAAC,IAAI,CAAC,IAAC;AACnC;AACA,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,WAAW;AACrC,MAAI,IAAI,CAAC,cAAc,EAAEE,gCAAU,CAAC,IAAI,CAAC,IAAC;AAC1C,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,YAAY;AACtC,MAAI,IAAI,CAAC,cAAc,EAAEA,gCAAU,CAAC,IAAI,CAAC,IAAC;AAC1C,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,EAAE;AACtC;AACA,IAAI,IAAI,CAAC,QAAQ,EAAEuB,gCAAY,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,EAAC;AACnE,GAAG;AACH,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,EAAE;AACtC,IAAI7B,IAAI,EAAE,GAAG,IAAI,EAAE,GAAG,GAAG8B,iCAAa,CAACC,4BAAQ,YAAG,KAAK,EAAE,QAAQ,EAAK;AACtE,MAAM,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,oBAAoB,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,CAAC,cAAc,EAAE,EAAC;AAC3E,MAAM,OAAO,IAAI;AACjB,KAAK,EAAC;AACN,IAAI,IAAI,CAAC,WAAW,EAAE,GAAG,EAAC;AAC1B,IAAI,IAAI,CAAC,aAAa,EAAE,GAAG,EAAC;AAC5B,IAAI,IAAI,GAAG,IAAE,IAAI,CAAC,YAAY,EAAE,GAAG,IAAC;AACpC,GAAG;AACH;AACA;AACA,IAAI,IAAI,CAAC,OAAO,WAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAK;AAC5C;AACA;AACA;AACA;AACA;AACA,YAAY/B,IAAI,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,MAAK;AAC7C;AACA;AACA;AACA,YAAYA,IAAI,UAAU,GAAG,KAAK,CAAC,UAAU,CAAC;AAC9C,YAAYA,IAAI,OAAO,GAAG,IAAI,CAAC;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd,kBAAkB,KAAK,CAAC,MAAM,IAAI,UAAU,EAAE,IAAI,IAAI,UAAU,CAAC,MAAM,IAAI,QAAQ;AACnF,qBAAqB,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,WAAW;AAC1D,qBAAqB,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;AACpH,kBAAkB;AAClB;AACA;AACA;AACA,kBAAkBA,IAAI,SAAS,GAAG,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;AAC3F;AACA;AACA;AACA,oBAAoBD,IAAM,aAAa,GAAG,kLAAkL,CAAC;AAC7N,oBAAoBC,IAAI,aAAa,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,aAAa,CAAC,CAAC;AACzE,oBAAoB,IAAI,aAAa,EAAE,IAAI,CAAC;AAC5C,sBAAsB,aAAa,CAAC,MAAM,CAAC,GAAG,SAAS,CAAC;AACxD,qBAAqB,MAAM;AAC3B,sBAAsBD,IAAM,WAAW,GAAG,yLAAyL,CAAC;AACpO,sBAAsB,aAAa,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,WAAW,CAAC,CAAC;AACrE,sBAAsB,IAAI,aAAa,EAAE,IAAI,CAAC;AAC9C,wBAAwB,aAAa,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC;AACxD,uBAAuB;AACvB,qBAAqB;AACrB;AACA;AACA,oBAAoB,IAAI,aAAa,EAAE,IAAI,CAAC;AAC5C;AACA;AACA,wBAAwBC,IAAI,IAAI,GAAG,EAAE,IAAI,EAAE,KAAK,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE,KAAK,CAAC,GAAG,EAAE,EAAC;AAC1E;AACA;AACA;AACA;AACA;AACA,0BAA0BA,IAAI,QAAQ,GAAGgC,yBAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;AACjG;AACA,0BAA0BhC,IAAI,UAAU,GAAGgC,yBAAQ,CAAC,KAAK,CAAC;AAC1D;AACA,0BAA0BjC,IAAM,WAAW,aAAI,IAAI,EAAE,GAAG,EAAK;AAC7D,4BAA4B,IAAI,GAAG,CAAC,CAAC,EAAE;AACvC;AACA,8BAA8B,UAAU,GAAG,UAAU,CAAC,MAAM,CAACiC,yBAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AAClF,8BAA8B,OAAO,KAAK,CAAC;AAC3C,6BAA6B;AAC7B,4BAA2B;AAC3B,0BAA0B,QAAQ,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;AAC5D;AACA,0BAA0B,UAAU,GAAGA,yBAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;AAC3G;AACA,4BAA4BhC,IAAI,UAAU,GAAG,IAAI,CAAC;AAClD,4BAA4BA,IAAI,UAAU,GAAG,IAAI,CAAC;AAClD,4BAA4BA,IAAI,QAAQ,GAAG,IAAI,CAAC;AAChD,4BAA4B,OAAO,aAAa,CAAC,MAAM,CAAC;AACxD,8BAA8B,KAAK,SAAS;AAC5C,gCAAgC,UAAU,GAAG,gCAAgC,CAAC;AAC9E,gCAAgC,QAAQ,GAAG,0BAA0B,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;AACvF,8BAA8B,MAAM;AACpC,8BAA8B,KAAK,OAAO;AAC1C,gCAAgC,UAAU,GAAG,gCAAgC,CAAC;AAC9E,gCAAgC,QAAQ,GAAG,2BAA2B,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,0BAA0B,CAAC;AACnH,8BAA8B,MAAM;AACpC,6BAA6B;AAC7B,4BAA4B,UAAU,GAAGgC,yBAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAEA,yBAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9K;AACA,0BAA0B,UAAU,GAAG,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;AACrE;AACA,0BAA0B,OAAO,GAAG,KAAK,CAAC,EAAE,CAAC;AAC7C,0BAA0B,IAAI,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,GAAG,EAAE,EAAE;AACtD,4BAA4B,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,IAAIC,sBAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;AAChG,2BAA2B,MAAM;AACjC,4BAA4B,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,IAAIA,sBAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;AAChG,2BAA2B;AAC3B;AACA,0BAA0B,OAAO,CAAC,YAAY,CAAC,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAC;AAClH;AACA,0BAA0B,QAAQ,CAAC,OAAO,CAAC,cAAc,EAAE,EAAC;AAC5D,0BAA0B,OAAO,IAAI,CAAC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,eAAe;AACf;AACA;AACA;AACA,cAAc,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,UAAU,EAAE,IAAI,IAAI,UAAU,CAAC,MAAM,IAAI,QAAQ,EAAE;AAClJ;AACA,kBAAkBlC,IAAM,UAAU,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC;AAClF,kBAAkBC,IAAI,gBAAgB,GAAG,CAAC,CAAC;AAC3C,kBAAkBA,IAAI,YAAY,GAAG,CAAC,UAAU,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;AACzE,kBAAkB,IAAI,YAAY,EAAE,IAAI,EAAE;AAC1C,oBAAoB,YAAY,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;AAC3E,mBAAmB,MAAM;AACzB,oBAAoB,gBAAgB,GAAG,CAAC,CAAC;AACzC,mBAAmB;AACnB,kBAAkB,IAAI,YAAY,EAAE,IAAI,EAAE;AAC1C;AACA,sBAAsBD,IAAM,WAAW,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;AAC3G,sBAAsBA,IAAM,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,gBAAgB,CAAC;AACvF,sBAAsBA,IAAM,QAAQ,GAAG,KAAK,CAAC,GAAG,CAAC,gBAAgB,CAAC;AAClE,sBAAsBA,IAAM,KAAK,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,GAAG,IAAI,EAAE,IAAI,EAAE,SAAS,CAAC,WAAW,EAAE,GAAG,EAAE,IAAI,EAAE,WAAW,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC;AACvI,sBAAsBA,IAAM,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AAC1E;AACA;AACA,sBAAsB,OAAO,GAAG,KAAK,CAAC,EAAE;AACxC,uBAAuB,UAAU,CAAC,UAAU,EAAE,QAAQ,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC;AAChF,uBAAuB,OAAO,CAAC,UAAU,EAAE,QAAQ,EAAE,KAAK,EAAC;AAC3D,mBAAmB;AACnB,iBAAiB;AACjB;AACA;AACA,YAAY,KAAKC,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACnD,cAAcA,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,EAAC;AACxC,cAAcA,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,EAAC;AACtC,cAAc,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,WAAW,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC,EAAE;AACjF;AACA,kBAAkBA,IAAI,MAAM,GAAGkC,mCAAa,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;AACjE,kBAAkB,OAAO,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;AACjD,eAAe,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,EAAE;AACvD;AACA,kBAAkBlC,IAAI,IAAI,GAAG,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;AAClE;AACA;AACA,kBAAkB,OAAO,IAAI,CAAC,KAAK,EAAE,QAAQ,CAAC;AAC9C,eAAe;AACf;AACA,aAAa;AACb;AACA;AACA,cAAc,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,QAAQ,EAAE;AACtE;AACA;AACA;AACA;AACA;AACA,kBAAkB,OAAO,GAAG,KAAK,CAAC,EAAE,CAAC;AACrC,kBAAkBA,IAAI,MAAM,GAAG,IAAI,CAAC;AACpC,kBAAkBA,IAAI,OAAO,GAAG,IAAI,CAAC;AACrC,kBAAkBA,IAAI,eAAe,GAAG,IAAI,CAAC;AAC7C;AACA;AACA,kBAAkB,IAAI,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE;AAC7C;AACA,oBAAoB,OAAO,KAAK,CAAC;AACjC,mBAAmB,MAAM,IAAI,KAAK,CAAC,MAAM,CAAC,SAAS,GAAG,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,IAAI,YAAY,EAAE;AAChH;AACA,sBAAsB,MAAM,IAAI,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;AAC5F,sBAAsB,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;AAC9F,mBAAmB,MAAM;AACzB;AACA,oBAAoB,MAAM,IAAI,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1D,oBAAoB,eAAe,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;AACnE,oBAAoB,IAAI,eAAe,GAAG,IAAI,EAAE;AAChD;AACA;AACA,sBAAsBA,IAAI,SAAS,GAAGgC,yBAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,CAAC;AAC3F,sBAAsB,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;AACzD,sBAAsB,QAAQ,CAAC,OAAO,CAAC,CAAC;AACxC;AACA,sBAAsB,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;AACzG,sBAAsB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,cAAc,EAAE,CAAC,CAAC;AAC1F,sBAAsB,OAAO,IAAI,CAAC;AAClC,qBAAqB,MAAM;AAC3B,sBAAsB,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;AAC9F;AACA,qBAAqB;AACrB,mBAAmB;AACnB;AACA;AACA,kBAAkB,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;AAChD,kBAAkB,QAAQ,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC,CAAC;AACrD,kBAAkB,OAAO,IAAI,CAAC;AAC9B;AACA,eAAe;AACf;AACA;AACA,YAAY,IAAI,OAAO,EAAE,IAAI,EAAE;AAC/B;AACA;AACA,cAAc,QAAQ,CAAC,OAAO,CAAC,CAAC;AAChC,aAAa;AACb;AACA,KAAK,EAAC;AACN;AACA,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,SAAS,EAAE;AACrC;AACA,IAAI,IAAI,CAAC,OAAO,EAAEV,kCAAY,CAAC,IAAI,CAAC,EAAC;AACrC,IAAI,IAAI,CAAC,OAAO,EAAEa,kCAAY,CAAC,IAAI,CAAC,EAAC;AACrC,IAAI,IAAI,CAAC,KAAK,WAAE,KAAK,EAAE,QAAQ,EAAK;AACpC;AACA;AACA;AACA;AACA,UAAUnC,IAAI,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,MAAK;AAC3C,UAAU,KAAKA,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACjD,YAAYA,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,EAAC;AACtC,YAAYA,IAAI,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,EAAC;AACpC;AACA;AACA,YAAY,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,WAAW,EAAE;AAC7C,qBAA8B,GAAG,KAAK,CAAC;cAApB;cAAO,kBAAsB;AAChD,cAAcA,IAAI,KAAK,GAAGqB,OAAK,CAAC,UAAU,CAAC,GAAG,YAAE,eAAQ,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,MAAM,CAAC,KAAK,CAAC,YAAS,EAAC;AAC1H,cAAc,IAAI,KAAK,EAAE;AACzB;AACA;AACA;AACA;AACA,kBAAkBrB,IAAI,IAAI,GAAGmC,kCAAY,CAAC,IAAI,CAAC,IAAI,EAAC;AACpD,kBAAkB,IAAI,CAAC,KAAK,EAAE,QAAQ,EAAC;AACvC,kBAAkB,OAAO,IAAI,CAAC;AAC9B,eAAe;AACf,aAAa;AACb;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,QAAQ,OAAO,IAAI,CAAC;AACpB;AACA,KAAK,EAAC;AACN,GAAG;AACH,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,SAAS;AACnC,MAAI,IAAI,CAAC,cAAc,EAAEN,gCAAY,CAAC,IAAI,CAAC,IAAC;AAC5C,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU;AACpC,MAAI,IAAI,CAAC,eAAe,EAAEA,gCAAY,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAC;AAC3E,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE;AACnC;AACA,IAAI,KAAK7B,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACzE,MAAM,IAAI,CAAC,aAAa,GAAG,CAAC,EAAE6B,gCAAY,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,EAAC;AACvF,KAAK;AACL,GAAG;AACH,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,eAAe,EAAE;AAC3C,IAAI7B,IAAI,EAAE,GAAG,KAAI;AACjB,IAAI,IAAI,CAAC,OAAO,YAAG,KAAK,EAAE,QAAQ,EAAK;AACvC,MAAM,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC,oBAAoB,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,CAAC,cAAc,EAAE,EAAC;AAC3E,MAAM,OAAO,IAAI;AACjB,KAAK,EAAC;AACN,GAAG;AACH;AACA;AACA;AACA,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE;AAChC,IAAI,IAAI,CAAC,cAAc,YAAG,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAK;AACpD,QAAQ,IAAI,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,IAAI,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC;AAC/E,cAAc,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,UAAU,CAAC,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;AAChG,YAAY;AACZ,UAAUA,IAAI,OAAO,GAAG,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;AAChE;AACA,UAAU,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;AACxC;AACA,SAAS;AACT;AACA,QAAQ,OAAO,IAAI,CAAC;AACpB,KAAK,CAAC,CAAC;AACP,GAAG;AACH;AACA,EAAE,OAAO,IAAI;AACb,CAAC;AACD;AACA,SAAS,SAAS,CAAC,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE;AAChD,EAAE,OAAO,SAAS,KAAK,EAAE,QAAQ,EAAE;AACnC,WAAoB,GAAG,KAAK,CAAC;IAApB;IAAO,kBAAsB;AACtC,IAAIA,IAAI,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC,GAAG,YAAE,eAAQ,IAAI,CAAC,aAAU,EAAC;AAC9D,IAAI,IAAI,CAAC,KAAK,EAAE;AAChB,MAAM,OAAO,KAAK;AAClB,KAAK;AACL,IAAI,IAAI,CAAC,QAAQ,IAAE,OAAO,MAAI;AAC9B,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,IAAI,IAAI,QAAQ;AACpD;AACA;AACA,QAAM,OAAO,KAAK,GAAC;AACnB;AACA;AACA,QAAM,OAAO,WAAW,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,GAAC;AACnE,GAAG;AACH,CAAC;AACD;AACA,SAAS,WAAW,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE;AAChE,WAA0B,GAAG,KAAK,CAAC;IAA1B;IAAO;IAAK,oBAAuB;AAC5C,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,IAAE,OAAO,OAAK;AACzF,IAAIA,IAAI,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAC;AACpC,IAAIA,IAAI,IAAI,GAAG,IAAI,CAAC;AACpB,IAAI,IAAI,WAAW,CAAC,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AAC/C,KAAK,MAAM;AACX;AACA,MAAM,IAAI,GAAG,GAAG,CAAC;AACjB,MAAM,OAAO,KAAK,CAAC;AACnB,KAAK;AACL;AACA,IAAI,IAAI,QAAQ,EAAE;AAClB;AACA,MAAM,IAAI,QAAQ,EAAE;AACpB;AACA;AACA;AACA,YAAYA,IAAI,QAAQ,GAAGgC,yBAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;AACnF;AACA,YAAYhC,IAAI,UAAU,GAAGgC,yBAAQ,CAAC,KAAK,CAAC;AAC5C;AACA,YAAYjC,IAAM,WAAW,aAAI,IAAI,EAAE,GAAG,EAAK;AAC/C;AACA,cAAc,IAAI,GAAG,CAAC,CAAC,EAAE;AACzB,gBAAgB,UAAU,GAAG,UAAU,CAAC,MAAM,CAACiC,yBAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACpE,gBAAgB,OAAO,KAAK,CAAC;AAC7B,eAAe;AACf,cAAa;AACb,YAAY,QAAQ,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;AAC9C;AACA,YAAY,UAAU,GAAGA,yBAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;AAC7F;AACA;AACA;AACA,YAAYhC,IAAI,EAAE,GAAG,OAAO,IAAI,KAAK,CAAC,EAAE,CAAC;AACzC,YAAY,IAAI,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,GAAG,EAAE,EAAE;AACxC,cAAc,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,IAAIiC,sBAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;AACxE,aAAa,MAAM;AACnB,cAAc,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,IAAIA,sBAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;AACxE,aAAa;AACb,YAAY,EAAE,CAAC,YAAY,CAAC,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAC;AACvF,YAAY,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,GAAG,EAAE,EAAC;AAC7C,YAAY,QAAQ,CAAC,EAAE,CAAC,cAAc,EAAE,EAAC;AACzC;AACA,OAAO,MAAM;AACb;AACA;AACA,UAAU,IAAI,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,EAAE;AAClC;AACA;AACA,YAAYjC,IAAI,KAAK,GAAGgC,yBAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,CAAC;AAC7E,YAAYhC,IAAIoC,IAAE,GAAG,OAAO,IAAI,KAAK,CAAC,EAAE,CAAC;AACzC,YAAYA,IAAE,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,IAAIH,sBAAK,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;AACpE,YAAYG,IAAE,CAAC,YAAY,CAAC,KAAK,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAACA,IAAE,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAAC;AACvF,YAAY,QAAQ,CAACA,IAAE,CAAC,cAAc,EAAE,EAAC;AACzC,SAAS;AACT;AACA,OAAO;AACP,KAAK;AACL,IAAI,OAAO,IAAI;AACf;;AChiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACArC,IAAM,kBAAkB,GAAG,IAAIsC,0BAAS,CAAC,WAAW,EAAC;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AAAO,SAAS,eAAe,CAAC,MAAM,EAAE,UAAU,EAAE,aAAa,EAAE;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAACrC,IAAI,UAAU,GAAG,IAAI,eAAe,CAAC,MAAM,EAAE,UAAU,EAAE,aAAa,EAAC;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAACA,IAAI,WAAW,GAAG,IAAIsC,uBAAM;AAC7B,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,GAAG,EAAE,kBAAkB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,KAAK,EAAE;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,mBAAI,CAAC,MAAM,EAAE,QAAQ,EAAE;AACrC,eAAe,OAAOC,6BAAa,CAAC,KAAK;AACzC,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,qBAAK,CAAC,EAAE,EAAE,GAAG,EAAE,QAAQ,EAAE,eAAe,EAAE;AACxD;AACA;AACA;AACA,aAAa,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,OAAO,EAAE,EAAE,CAAC,GAAG;AAC7C,iBAAiB;AACjB,gBAAgB,QAAQ,YAAE,UAAY;AACtC;AACA,sBAAsB,IAAI,OAAO,QAAQ,CAAC,IAAI,IAAI,WAAW,IAAI,QAAQ,CAAC,IAAI,IAAI,aAAa,EAAE;AACjG,uBAAuB,UAAU,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;AACjE,uBAAuB;AACvB,sBAAsB;AACtB,gBAAgB;AAChB,gBAAe;AACf;AACA;AACA,aAAavC,IAAI,MAAM,GAAG,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC3C;AACA;AACA,aAAa,IAAI,MAAM,IAAI,MAAM,CAAC,GAAG,EAAE;AACvC;AACA;AACA;AACA;AACA,gBAAgBA,IAAI,YAAY,GAAG,GAAG,CAAC;AACvC,gBAAgBA,IAAI,aAAa,GAAG,GAAG,CAAC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgBA,IAAI,MAAM,GAAG,QAAQ,CAAC,eAAe,CAAC,4BAA4B,EAAE,KAAK,CAAC,CAAC;AAC3F,mBAAmB,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;AACjE,mBAAmB,MAAM,CAAC,YAAY,CAAC,SAAS,EAAE,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;AAC5F,mBAAmB,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AACxD,mBAAmB,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,4BAA4B,CAAC,CAAC;AAC7E,mBAAmB,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,8BAA8B,CAAC,CAAC;AACrF,gBAAgBA,IAAI,YAAY,GAAG,QAAQ,CAAC,eAAe,CAAC,4BAA4B,EAAE,GAAG,CAAC,CAAC;AAC/F,gBAAgBA,IAAI,WAAW,GAAG,QAAQ,CAAC,eAAe,CAAC,4BAA4B,EAAE,MAAM,CAAC,CAAC;AACjG,mBAAmB,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AAC1D,mBAAmB,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AAC1D,mBAAmB,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;AACzE,mBAAmB,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;AAC3E,mBAAmB,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;AACzE,mBAAmB,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;AACjE,mBAAmB,YAAY,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;AACzD,mBAAmB,MAAM,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;AACpD;AACA;AACA,gBAAgBA,IAAI,IAAI,GAAGwC,0BAAU,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,EAAE,CAAC,EAAE,EAAE,MAAM,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,EAAE,aAAa,EAAE,SAAS,YAAE,KAAO;AAChI;AACA,iBAAiB,OAAO,IAAI,CAAC;AAC7B,iBAAiB,EAAE,EAAE,CAAC;AACtB;AACA;AACA,gBAAgB,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,EAAC;AAC7C;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE;AAC/C;AACA;AACA;AACA,eAAexC,IAAIyC,MAAI,GAAGD,0BAAU,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,KAAK,EAAE,2BAA2B,CAAC,CAAC,CAAC,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,CAAC;AACjK,eAAe,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAACC,MAAI,CAAC,EAAC;AAC5C;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,SAAS,EAAE;AACpE;AACA;AACA;AACA,eAAe,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,EAAE,IAAI,MAAM,CAAC,KAAK,CAAC,KAAE,CAAC,EAAC;AACzF,eAAe,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,gBAAS,IAAI,CAAC,IAAI,IAAI,MAAM,CAAC,SAAS,CAAC,IAAI,KAAK,IAAI,CAAC,EAAE,CAAC,QAAQ,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,KAAE,CAAC,EAAC;AACtJ;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE;AAChD;AACA;AACA;AACA,eAAe,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,EAAE,IAAI,MAAM,CAAC,KAAK,CAAC,KAAE,CAAC,EAAC;AACzF;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,OAAO,EAAE;AAClD;AACA;AACA;AACA;AACA,gBAAgBzC,IAAI,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,EAAE,IAAI,MAAM,CAAC,OAAO,CAAC,KAAE,CAAC,CAAC;AACtF;AACA,gBAAgB,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE;AACpC;AACA,kBAAkBA,IAAI,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;AACtD,kBAAkBA,IAAI0C,aAAW,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;AAC3E,kBAAkB1C,IAAI,IAAI,EAAE,IAAI,CAAC;AACjC;AACA,kBAAkBA,IAAI,QAAQ,GAAG;AACjC;AACA;AACA,oBAAoB,CAAC,EAAE,GAAG,IAAI,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC;AAC1C,oBAAoB,CAAC,EAAE,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC;AACzC,oBAAoB,CAAC,EAAE,GAAG,IAAI,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC;AAC1C;AACA;AACA,mBAAmB,CAAC;AACpB;AACA;AACA,kBAAkB,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,EAAE,IAAI,EAAE;AAChD;AACA;AACA;AACA,qBAAqB,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE;AACvI,4BAA4B,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACzD,sBAAsB,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACnD,4BAA4B,MAAM;AAClC,4BAA4B,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACzD,sBAAsB,IAAI,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACnD,4BAA4B;AAC5B;AACA;AACA,qBAAqB,UAAU,CAAC,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAChF,qBAAqB,UAAU,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC5D;AACA;AACA,qBAAqB0C,aAAW,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC5D,qBAAqBA,aAAW,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC7D;AACA;AACA,qBAAqB,UAAU,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;AACzD;AACA;AACA,oBAAoB,IAAI,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,qBAAqB,EAAE;AACxE;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB1C,IAAI,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,qBAAqB,EAAE,CAAC;AAClF;AACA;AACA,sBAAsB,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC;AACzC,sBAAsB,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC;AAC1C;AACA;AACA,qBAAqB,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,EAAE;AAC7C;AACA;AACA;AACA,uBAAuB,UAAU,CAAC,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAClF,uBAAuB,UAAU,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC9D;AACA;AACA,uBAAuB0C,aAAW,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;AAC5E,uBAAuBA,aAAW,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC9D,uBAAuBA,aAAW,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC/D;AACA;AACA,uBAAuB,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,EAAE;AAC/C;AACA;AACA,yBAAyB,UAAU,CAAC,KAAK,CAAC,gBAAgB,GAAG,WAAW,CAAC;AACzE,yBAAyB,UAAU,CAAC,KAAK,CAAC,kBAAkB,GAAG,QAAQ,CAAC;AACxE,yBAAyB,UAAU,CAAC,KAAK,CAAC,cAAc,GAAG,SAAS,CAAC;AACrE;AACA;AACA,yBAAyB1C,IAAI,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC;AACzD;AACA;AACA,yBAAyB,IAAI,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;AAC9D;AACA;AACA;AACA,2BAA2B,IAAI,YAAY,GAAG,IAAI,KAAK,EAAE,CAAC;AAC1D,2BAA2B,YAAY,CAAC,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC;AACjE;AACA,2BAA2B,YAAY,CAAC,MAAM,GAAG,WAAW;AAC5D;AACA;AACA;AACA,6BAA6B,IAAI,eAAe,IAAI,IAAI,EAAE;AAC1D,uCAAuC,IAAI,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,YAAY,KAAK,CAAC,EAAE;AACzF,2CAA2C,IAAI,CAAC,OAAO,EAAE,CAAC;AAC1D,2CAA2C,OAAO;AAClD,wCAAwC;AACxC,oCAAoC,MAAM,IAAI,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,IAAI,CAAC,EAAE;AAC7E,uCAAuC,IAAI,CAAC,OAAO,EAAE,CAAC;AACtD,uCAAuC,OAAO;AAC9C,oCAAoC;AACpC;AACA;AACA,6BAA6B,IAAI,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC;AAC7C,6BAA6B,IAAI,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC;AAC7C;AACA;AACA,6BAA6B,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AAC3E,6BAA6B,MAAM,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;AAC9D,6BAA6B,MAAM,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;AAC/D;AACA;AACA,6BAA6B,IAAI,CAAC,GAAG,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC;AACtD,6BAA6B,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;AACvD;AACA;AACA,6BAA6B,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE;AAC/I,oCAAoC,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC;AAChD,8BAA8B,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC;AAC1C,oCAAoC;AACpC,6BAA6B,IAAI,KAAK,GAAG,EAAE,CAAC;AAC5C,6BAA6B,IAAI,MAAM,GAAG,EAAE,CAAC;AAC7C;AACA;AACA,6BAA6B,IAAI,OAAO,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;AACnE,6BAA6B,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACrD,6BAA6B,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC7E,6BAA6B,OAAO,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,MAAM,GAAG,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;AAC7F,6BAA6B,OAAO,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9E,6BAA6B,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACvD;AACA;AACA,6BAA6B,MAAM,GAAG,MAAM,CAAC,SAAS,EAAE,CAAC;AACzD;AACA;AACA,6BAA6B,UAAU,CAAC,KAAK,CAAC,eAAe,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC;AAClF;AACA;AACA,6BAA6B,MAAM,GAAG,IAAI,CAAC;AAC3C,6BAA6B,YAAY,GAAG,IAAI,CAAC;AACjD;AACA,4BAA4B,CAAC;AAC7B,2BAA2B,YAAY,CAAC,OAAO,GAAG,WAAW;AAC7D;AACA,4BAA4B,UAAU,CAAC,KAAK,CAAC,eAAe,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC;AACjF,4BAA4B,CAAC;AAC7B;AACA,0BAA0B,MAAM;AAChC;AACA,0BAA0B,UAAU,CAAC,KAAK,CAAC,eAAe,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC;AAC/E,0BAA0B;AAC1B,wBAAwB;AACxB;AACA,sBAAsB;AACtB,qBAAqB;AACrB;AACA,mBAAmB,MAAM;AACzB;AACA;AACA;AACA,qBAAqB0C,aAAW,CAAC,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAC7D;AACA,qBAAqB,UAAU,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;AACzD;AACA,qBAAqB,IAAI,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,qBAAqB,EAAE;AACzE,sBAAsB1C,IAAI2C,OAAK,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,qBAAqB,EAAE,CAAC;AACnF,sBAAsB,IAAI,GAAGA,OAAK,CAAC,KAAK,CAAC;AACzC,sBAAsB,IAAI,GAAGA,OAAK,CAAC,MAAM,CAAC;AAC1C,sBAAsB,IAAI,IAAI,EAAE,CAAC,IAAI,IAAI,EAAE,CAAC,EAAE;AAC9C,uBAAuB,UAAU,CAAC,YAAY,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AAClF,uBAAuB,UAAU,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC9D,uBAAuBD,aAAW,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAC9D,uBAAuBA,aAAW,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC/D,wBAAwB;AACxB,uBAAuB;AACvB,mBAAmB;AACnB;AACA;AACA;AACA;AACA,mBAAmB,IAAI,QAAQ,GAAG,IAAI,CAAC;AACvC,mBAAmB,IAAI,SAAS,GAAG,CAAC,CAAC;AACrC,AACA,mBAAmB,IAAI,OAAO,GAAG,QAAQ,CAAC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB1C,IAAI,UAAU,GAAG,QAAQ,CAAC,eAAe,CAAC,4BAA4B,EAAE,MAAM,CAAC,CAAC;AACnG,mBAAmB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC;AACvG,mBAAmB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;AACxE,mBAAmB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;AAC9E,mBAAmB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC;AAC3E,mBAAmB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,0BAA0B,CAAC,CAAC;AACtF,mBAAmB,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,qBAAqB,CAAC,OAAO,CAAC,0DAA0D,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AACpK,mBAAmB,UAAU,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;AACtD,iBAAiB;AACjB;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,QAAQ,EAAE;AACnD;AACA;AACA,eAAeA,IAAI4C,MAAI,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,EAAE,IAAI,MAAM,CAAC,QAAQ,CAAC,KAAE,CAAC,CAAC;AACtF,eAAe,IAAIA,MAAI,CAAC,MAAM,EAAE,CAAC,EAAE;AACnC,gBAAgB5C,IAAI6C,YAAU,GAAGD,MAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;AACpD,gBAAgB,IAAIC,YAAU,IAAI,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,IAAI,EAAE;AAC/D,iBAAiB,IAAI,MAAM,GAAGA,YAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;AACvD,iBAAiB,IAAI,MAAM,EAAE;AAC7B,kBAAkB,IAAI,CAAC,GAAG,MAAM,CAAC,cAAc,EAAE,CAAC;AAClD,kBAAkB,IAAI,GAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC;AACtD,mDAAmD,IAAI,KAAK,CAAC,GAAG,CAAC,EAAE;AACnE,uDAAuD,GAAG,GAAG,GAAG,CAAC;AACjE,oDAAoD;AACpD,mDAAmD,IAAI,GAAG,GAAG,CAAC,EAAE,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC;AAC3E,mDAAmD,IAAI,GAAG,GAAG,GAAG,EAAE,EAAE,GAAG,GAAG,GAAG,CAAC,CAAC;AAC/E,mDAAmD,IAAI,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;AAC/E,mDAAmD,MAAM,CAAC,KAAK,CAAC,gBAAgB,GAAG,GAAG,CAAC;AACvF,gDAAgD;AAChD,iBAAiB;AACjB,gBAAgB;AAChB;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE;AACjD;AACA;AACA;AACA;AACA,eAAe7C,IAAI,WAAW,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,EAAE,IAAI,MAAM,CAAC,MAAM,CAAC,KAAE,CAAC,CAAC;AAC3F,eAAe,IAAI,WAAW,CAAC,MAAM,CAAC,CAAC,EAAE;AACzC,gBAAgB,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC;AAC/D,gBAAgB;AAChB;AACA;AACA;AACA;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,SAAS,EAAE;AACpD;AACA;AACA;AACA,eAAe,IAAI,MAAM,CAAC,SAAS,IAAI,IAAI,EAAE;AAC7C,gBAAgB,GAAG,GAAGuC,6BAAa,CAAC,KAAK,CAAC;AAC1C,gBAAgB,MAAM;AACtB,gBAAgB,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,gBAAS,IAAI,CAAC,IAAI,IAAI,MAAM,CAAC,SAAS,CAAC,IAAI,KAAK,IAAI,CAAC,EAAE,CAAC,QAAQ,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,KAAE,CAAC,EAAC;AACvJ,gBAAgB;AAChB;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE;AACjD;AACA;AACA;AACA,eAAe,IAAI,MAAM,CAAC,MAAM,IAAI,IAAI,EAAE;AAC1C,gBAAgB,GAAG,GAAGA,6BAAa,CAAC,KAAK,CAAC;AAC1C,gBAAgB,MAAM;AACtB,gBAAgB,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,EAAE,IAAI,MAAM,CAAC,MAAM,CAAC,KAAE,CAAC,EAAC;AAC3F,gBAAgB;AAChB;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE;AACtD;AACA;AACA,eAAevC,IAAI,kBAAkB,GAAG,EAAE,CAAC;AAC3C,eAAeA,IAAI,WAAW,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,IAAI,IAAI,cAAW,CAAC,CAAC;AACxF,eAAe,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5D;AACA,iBAAiBA,IAAI,GAAG,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC;AAC7D,iBAAiB,IAAI,GAAG,GAAG,IAAI,EAAE;AACjC,gCAAgCA,IAAI,SAAS,GAAG,IAAI,CAAC;AACrD,gCAAgC,KAAK,IAAI,CAAC,GAAG,GAAG,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACrF,kCAAkC,SAAS,GAAG,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;AAChE,kCAAkC,IAAI,SAAS,CAAC,OAAO,IAAI,QAAQ,EAAE;AACrE,mCAAmC,SAAS,CAAC,mBAAmB,CAAC,WAAW,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC;AAC9G,mCAAmC;AACnC,iCAAiC,AACjC,gCAAgC;AAChC;AACA,gBAAgB,kBAAkB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;AACxD,gBAAgB,AAChB,eAAe,IAAI,kBAAkB,CAAC,MAAM,EAAE,CAAC,EAAE;AACjD,gBAAgB,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;AACrD,gBAAgB,kBAAkB,GAAG,IAAI,CAAC;AAC1C,gBAAgB;AAChB;AACA,eAAeA,IAAI,cAAc,GAAG,EAAE,CAAC;AACvC,eAAeA,IAAI,gBAAgB,GAAGwC,0BAAU,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,KAAK,EAAE,yBAAyB,CAAC,CAAC,CAAC,EAAE,EAAE,cAAc,EAAE,IAAI,EAAE,aAAa,EAAE,CAAC,CAAC;AAC7L,eAAe,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,gBAAgB,CAAC,EAAC;AACxD;AACA,cAAc,MAAM,IAAI,MAAM,KAAK,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,iBAAiB,IAAI,MAAM,CAAC,aAAa,CAAC,EAAE;AAC9H;AACA;AACA,cAAcxC,IAAI,KAAK,GAAG,EAAE,CAAC;AAC7B;AACA;AACA,cAAc,IAAI,MAAM,CAAC,SAAS,EAAE;AACpC;AACA,eAAeA,IAAI,cAAc,GAAG,IAAI,CAAC;AACzC,eAAeA,IAAI,aAAa,GAAG,IAAI,CAAC;AACxC,eAAe,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE;AACpD,gBAAgB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAClE,iBAAiB,aAAa,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;AACxD,iBAAiB,cAAc,GAAGwC,0BAAU,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,KAAK,EAAE,yBAAyB,CAAC,CAAC,CAAC,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC,CAAC;AACvL,iBAAiB,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;AAC5C,iBAAiB,AACjB,gBAAgB,MAAM;AACtB,gBAAgB,aAAa,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;AACrD,gBAAgB,cAAc,GAAGA,0BAAU,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,EAAE,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,KAAK,EAAE,yBAAyB,CAAC,CAAC,CAAC,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC,CAAC;AAChL,gBAAgB,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;AAC3C,gBAAgB;AAChB,eAAe;AACf;AACA;AACA,cAAc,IAAI,MAAM,CAAC,iBAAiB,EAAE;AAC5C,eAAexC,IAAI,oBAAoB,GAAG,EAAE,CAAC;AAC7C,8BAA8BA,IAAI,sBAAsB,GAAGwC,0BAAU,CAAC,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,CAAC,iBAAiB,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,KAAK,EAAE,kCAAkC,CAAC,CAAC,CAAC,EAAE,EAAE,oBAAoB,EAAE,IAAI,EAAE,mBAAmB,CAAC,CAAC,CAAC;AACtP;AACA,eAAe,KAAK,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;AAClD,eAAe;AACf;AACA;AACA;AACA,cAAc,IAAI,MAAM,CAAC,aAAa,EAAE;AACxC,AAoBA,+BAA+BxC,IAAI,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;AACpF,+BAA+B,SAAS,CAAC,YAAY,CAAC,OAAO,EAAE,yBAAyB,CAAC,CAAC;AAC1F,+BAA+B,SAAS,CAAC,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,CAAC;AAClF;AACA;AACA,+BAA+B,SAAS,CAAC,gBAAgB,CAAC,WAAW,EAAE,UAAU,CAAC,wBAAwB,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;AAC3J;AACA;AACA,iBAAiBA,IAAI,iBAAiB,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;AAC9D,gCAAgCA,IAAI,kBAAkB,GAAGwC,0BAAU,CAAC,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,EAAE,CAAC,GAAG,EAAE,iBAAiB,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,eAAe,GAAG,IAAI,EAAE,CAAC,CAAC,EAAE,eAAe,EAAE,IAAI,EAAE,SAAS,YAAE,KAAO;AACpO;AACA,iCAAiC,OAAO,IAAI,CAAC;AAC7C,iCAAiC,EAAE,EAAC;AACpC,iBAAiB,KAAK,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;AAChD;AACA,eAAe;AACf;AACA;AACA,cAAc,IAAI,MAAM,CAAC,SAAS,EAAE;AACpC;AACA;AACA,eAAexC,IAAI,oBAAoB,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,IAAI,IAAI,gBAAa,CAAC,CAAC;AACnG;AACA;AACA,eAAe,IAAI,oBAAoB,CAAC,MAAM,EAAE,CAAC,EAAE;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,IAAI,IAAI,cAAW,CAAC,CAAC,CAAC;AAC3F;AACA;AACA,oCAAoCA,IAAI,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AACnF,gCAAgC,UAAU,CAAC,YAAY,CAAC,OAAO,EAAE,2BAA2B,CAAC,CAAC;AAC9F;AACA;AACA;AACA;AACA;AACA,iCAAiCA,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AAC/E;AACA,iCAAiC,MAAM,CAAC,WAAW,CAAC8C,mBAAO,CAACzC,iBAAK,CAAC,KAAK,CAAC,gCAAgC,CAAC,CAAC,CAAC;AAC3G,iCAAiC,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AAChE;AACA,iCAAiC,UAAU,CAAC,QAAQ,CAAC,MAAM,EAAE,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,EAAE,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC5K;AACA;AACA,iCAAiCL,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AAC/E;AACA,iCAAiC,MAAM,CAAC,WAAW,CAAC8C,mBAAO,CAACzC,iBAAK,CAAC,KAAK,CAAC,gCAAgC,CAAC,CAAC,CAAC;AAC3G,iCAAiC,MAAM,CAAC,gBAAgB,CAAC,WAAW,EAAE,UAAU,CAAC,oBAAoB,CAAC,IAAI,CAAC,UAAU,CAAC,4BAA4B,CAAC,CAAC,IAAI,EAAE,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1N,iCAAiC,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AAChE;AACA;AACA,iCAAiCL,IAAI,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;AAC9E;AACA,iCAAiC,KAAK,CAAC,WAAW,CAAC8C,mBAAO,CAACzC,iBAAK,CAAC,EAAE,CAAC,gCAAgC,CAAC,CAAC,CAAC;AACvG,iCAAiC,KAAK,CAAC,gBAAgB,CAAC,WAAW,EAAE,UAAU,CAAC,oBAAoB,CAAC,IAAI,CAAC,UAAU,CAAC,eAAe,EAAE,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;AACrK,iCAAiC,UAAU,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;AAC/D;AACA;AACA,gCAAgCL,IAAI,aAAa,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;AACzE,iCAAiCA,IAAI,cAAc,GAAGwC,0BAAU,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,EAAE,UAAU,EAAE,CAAC,GAAG,EAAE,aAAa,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,WAAW,GAAG,IAAI,EAAE,CAAC,CAAC,EAAE,eAAe,EAAE,IAAI,EAAE,SAAS,YAAE,KAAO;AACtN;AACA,kCAAkC,OAAO,IAAI,CAAC;AAC9C,kCAAkC,EAAE,EAAC;AACrC,kBAAkB,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;AAC7C;AACA;AACA,8BAA8B,UAAU,CAAC,UAAU;AACnD,+BAA+B,IAAI;AACnC,gCAAgC,UAAU,CAAC,YAAY,CAAC,OAAO,EAAE,iCAAiC,CAAC,CAAC;AACpG,gCAAgC,CAAC,MAAM,CAAC,EAAE;AAC1C;AACA,gCAAgC;AAChC,+BAA+B,EAAE,GAAG,CAAC,CAAC;AACtC;AACA,gBAAgB;AAChB;AACA,eAAe;AACf;AACA;AACA,eAAe,IAAI,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE;AACpC,gBAAgB,GAAG,GAAG,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;AAC7C,gBAAgB;AAChB;AACA,cAAc,MAAM,IAAI,MAAM,IAAI,MAAM,CAAC,UAAU,EAAE;AACrD;AACA;AACA;AACA,eAAe,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,IAAI,IAAI,sBAAmB,CAAC,CAAC,CAAC;AAChG;AACA,cAAc,MAAM;AACpB;AACA;AACA;AACA,eAAexC,IAAI+C,KAAG,GAAG,IAAI,CAAC;AAC9B,eAAe/C,IAAIgD,oBAAkB,GAAG,EAAE,CAAC;AAC3C,eAAehD,IAAIiD,aAAW,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,YAAE,eAAQ,IAAI,CAAC,IAAI,IAAI,OAAI,CAAC,CAAC;AACjF,eAAe,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAGA,aAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5D,gBAAgB,QAAQA,aAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI;AAChD,iBAAiB,KAAK,WAAW;AACjC;AACA,mBAAmBF,KAAG,GAAGE,aAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC;AAC3D,mBAAmB,IAAIF,KAAG,GAAG,IAAI,EAAE;AACnC,kCAAkC/C,IAAIkD,WAAS,GAAG,IAAI,CAAC;AACvD,kCAAkC,KAAK,IAAI,CAAC,GAAGH,KAAG,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACvF,oCAAoCG,WAAS,GAAGH,KAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;AAClE,oCAAoC,IAAIG,WAAS,CAAC,OAAO,IAAI,QAAQ,EAAE;AACvE,qCAAqCA,WAAS,CAAC,mBAAmB,CAAC,WAAW,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC;AAChH,qCAAqC;AACrC,mCAAmC,AACnC,kCAAkC;AAClC;AACA,mBAAmBF,oBAAkB,CAAC,IAAI,CAACC,aAAW,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3D,iBAAiB,MAAM;AACvB,iBAAiB,KAAK,aAAa,CAAC;AACpC,iBAAiB,KAAK,mBAAmB;AACzC;AACA,mBAAmBD,oBAAkB,CAAC,IAAI,CAACC,aAAW,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3D,iBAAiB,MAAM;AACvB,iBAAiB,KAAK,eAAe;AACrC;AACA,mBAAmBF,KAAG,GAAGE,aAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC;AAC3D,mBAAmB,IAAIF,KAAG,GAAG,IAAI,EAAE;AACnC,oBAAoBA,KAAG,CAAC,mBAAmB,CAAC,WAAW,CAAC,UAAU,CAAC,wBAAwB,CAAC,CAAC;AAC7F,oBAAoB;AACpB;AACA,mBAAmBC,oBAAkB,CAAC,IAAI,CAACC,aAAW,CAAC,CAAC,CAAC,CAAC,CAAC;AAC3D,iBAAiB,MAAM;AACvB,iBAAiB,KAAK,WAAW;AACjC;AACA;AACA;AACA,oBAAoB,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;AACjE;AACA,oBAAoBF,KAAG,GAAG,UAAU,CAAC,IAAI,CAAC,OAAO,CAACE,aAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC;AAC/E;AACA,oBAAoB,IAAIF,KAAG,EAAE,IAAI,IAAIA,KAAG,CAAC,QAAQ,EAAE,CAAC,IAAIA,KAAG,CAAC,WAAW,CAAC,MAAM,IAAI,CAAC,EAAE;AACrF;AACA,qBAAqBC,oBAAkB,CAAC,IAAI,CAACC,aAAW,CAAC,CAAC,CAAC,CAAC,CAAC;AAC7D,qBAAqB;AACrB,iBAAiB,MAAM;AACvB;AACA,iBAAiB;AACjB,gBAAgB,AAChB;AACA;AACA,eAAe,IAAID,oBAAkB,CAAC,MAAM,EAAE,CAAC,EAAE;AACjD,gBAAgB,GAAG,GAAG,GAAG,CAAC,MAAM,CAACA,oBAAkB,CAAC,CAAC;AACrD,gBAAgB;AAChB;AACA,cAAc;AACd;AACA;AACA,YAAY,OAAO,GAAG;AACtB,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB,YAAG,YAAY,EAAE,QAAQ,EAAE,QAAQ,EAAK;AAC5E;AACA;AACA,cAAcjD,IAAM,YAAY,GAAG,YAAY,CAAC,IAAI,WAAE,OAAO,WAAK,OAAO,CAAC,UAAU,KAAK,OAAI,CAAC,CAAC;AAC/F;AACA;AACA;AACA,cAAcC,IAAI,EAAE,GAAG,QAAQ,CAAC,GAAE;AAClC;AACA;AACA,cAAcA,IAAI,UAAU,GAAG,EAAE,CAAC;AAClC;AACA;AACA;AACA,eAAe,IAAI,YAAY,GAAG,IAAI,EAAE;AACxC;AACA;AACA;AACA,gBAAgBA,IAAI,oBAAoB,GAAG,EAAE,CAAC;AAC9C;AACA;AACA,gBAAgB,KAAK,IAAI,CAAC,GAAG,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AACnE,iBAAiB,KAAK,IAAI,CAAC,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;AAC7E,kBAAkB,YAAY,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,OAAO,CAAC,SAAS,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE;AACzG;AACA,oBAAoB,oBAAoB,GAAG,UAAU,CAAC,cAAc,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AAC/F;AACA,oBAAoB,KAAK,IAAI,GAAG,IAAI,oBAAoB,EAAE;AAC1D,wBAAwB,IAAI,UAAU,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;AAC5D,yBAAyB,UAAU,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAAC;AAC7F,yBAAyB,MAAM;AAC/B,yBAAyB,UAAU,CAAC,GAAG,CAAC,GAAG,oBAAoB,CAAC,GAAG,CAAC,CAAC;AACrE,yBAAyB;AACzB,qBAAqB;AACrB,mBAAmB,CAAC,CAAC;AACrB,kBAAkB;AAClB,iBAAiB,AACjB;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA,oBAAyC,GAAG,QAAQ,CAAC;cAAnC;cAAM;cAAO;cAAI,sBAA4B;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,KAAK,KAAK,CAAC,MAAM,CAAC,UAAU,KAAK,CAAC,EAAE;AAClF;AACA;AACA;AACA,eAAe,IAAI,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,KAAK,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,YAAY,CAAC,EAAE;AAChI;AACA,gBAAgB,IAAI,OAAO,UAAU,CAAC,SAAS,CAAC,IAAI,WAAW,EAAE;AACjE,iBAAiB,UAAU,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;AAC5C,iBAAiB;AACjB,gBAAgB,UAAU,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,mBAAmB,EAAE,GAAG,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;AAC5H;AACA,gBAAgB;AAChB;AACA;AACA;AACA,eAAe,IAAI,KAAK,CAAC,KAAK,IAAI,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,WAAW,EAAE;AAC9E;AACA,gBAAgB,IAAI,OAAO,UAAU,CAAC,SAAS,CAAC,IAAI,WAAW,EAAE;AACjE,iBAAiB,UAAU,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;AAC5C,iBAAiB;AACjB,gBAAgB,UAAU,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,WAAW,EAAE,GAAG,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;AACpH,gBAAgB;AAChB;AACA,cAAc;AACd;AACA,aAAa,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,KAAK,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,QAAQ,EAAE;AACxF;AACA;AACA;AACA,eAAe,IAAI,KAAK,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,EAAE;AACnG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,IAAI,OAAO,UAAU,CAAC,SAAS,CAAC,IAAI,WAAW,EAAE;AAClE,kBAAkB,UAAU,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;AAC7C,kBAAkB;AAClB,iBAAiB,UAAU,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,eAAe,EAAE,GAAG,EAAE,CAAC,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AAChJ;AACA;AACA,gBAAgB;AAChB;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA,eAAe,IAAI,UAAU,CAAC,WAAW,KAAK,MAAM,IAAI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;AAC9F;AACA;AACA,gBAAgB,EAAE,GAAG,UAAU,CAAC,kBAAkB,CAAC,QAAQ,EAAE,UAAU,EAAE,EAAE,CAAC,CAAC;AAC7E;AACA;AACA,iBAAiB,OAAO,EAAE,CAAC;AAC3B,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,KAAK,EAAE;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,iCAAW,CAAC,KAAK,EAAE;AACpC;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;AACxC;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,eAAe,EAAE;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,6BAAS,CAAC,IAAI,EAAE,CAAC,EAAE;AAC/B;AACA;AACA,aAAa,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,OAAO,KAAK,CAAC,EAAE;AACnE;AACA;AACA,aAAaA,IAAI,IAAI,GAAG,UAAU,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AAChE;AACA,aAAa,KAAK,IAAI,GAAG;AACzB;AACA,cAAc,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACjD;AACA,cAAc,OAAO,IAAI,CAAC;AAC1B,cAAc;AACd;AACA;AACA,aAAa,OAAO,IAAI,CAAC;AACzB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,2BAAQ,CAAC,IAAI,EAAE,CAAC,EAAE;AAC9B;AACA;AACA,oBAA+B,GAAG,IAAI,CAAC,KAAK,CAAC;aAA3B;aAAO,sBAA8B;AACvD;AACA;AACA,aAAa,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,YAAY,EAAE;AAC9F;AACA,cAAc,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,KAAK,KAAK,CAAC,MAAM,CAAC,UAAU,KAAK,CAAC,EAAE;AACnF;AACA,wBAAwB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,UAAU,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1F,wBAAwB;AACxB,oBAAoB;AACpB;AACA;AACA,aAAa,OAAO,IAAI,CAAC;AACzB;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,yBAAO,CAAC,IAAI,EAAE,CAAC,EAAE;AAChC;AACA;AACA,oBAAqC,GAAG,IAAI,CAAC,KAAK,CAAC;aAAjC;aAAM;aAAO,sBAA8B;AAC7D;AACA;AACA,aAAa,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,IAAI,YAAY,EAAE;AAC9F;AACA,cAAc,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,KAAK,KAAK,CAAC,MAAM,CAAC,UAAU,KAAK,CAAC,EAAE;AACnF;AACA,eAAe,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,iBAAiB,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AAC5I,eAAe;AACf,cAAc;AACd;AACA;AACA,aAAa,OAAO,IAAI,CAAC;AACzB;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,mBAAI,CAAC,UAAU,EAAE;AACpC;AACA,wBAAwB,UAAU,CAAC,IAAI,GAAG,UAAU,CAAC;AACrD;AACA;AACA;AACA,oCAAoC,OAAO,IAAI,eAAe,CAAC,UAAU,EAAE,UAAU,CAAC;AACtF,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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"}